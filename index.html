<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã€283å­¦åœ’ç·¨ã€‘AIè¨˜è€…ä»˜ããƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&family=Noto+Serif+JP:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
    <style>
        body { font-family: 'Inter', 'Noto Sans JP', sans-serif; background-color: #f0f2f5; }
        .setup-card, .display-card { background-color: #fff; padding: 24px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-bottom: 24px; }
        #main-bracket-container { display: flex; justify-content: center; padding: 20px; font-size: 12px; overflow-x: auto; border: 1px solid #e5e7eb; background-color: #f9fafb; border-radius: 8px;}
        .bracket-half { display: flex; }
        .bracket-half.right { flex-direction: row-reverse; }
        .bracket-final { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 0 10px; flex-shrink: 0; min-width: 60px; }
        .bracket-final .final-matchup { border: 2px solid #f59e0b; background-color: #fffbeb; border-radius: 6px; padding: 5px; margin-top: 10px; }
        .bracket-final .winner-box { font-weight: bold; color: #b45309; text-align: center; padding: 10px 20px; white-space: nowrap; font-size: 1.25rem; }
        .bracket-final .final-title { font-weight: 600; color: #4b5563; margin-bottom: 10px; writing-mode: vertical-rl; letter-spacing: 2px; }
        .round { display: flex; flex-direction: column; justify-content: space-around; flex-shrink: 0; width: 180px; padding: 0 10px; }
        .matchup { margin: 8px 0; position: relative; display: flex; flex-direction: column; justify-content: center; flex-grow: 1; transition: all 0.3s; padding: 4px; }
        /* === ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è©¦åˆã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆã™ã‚‹ã‚¹ã‚¿ã‚¤ãƒ« === */
        .player-match-highlight {
            border: 3px solid #f59e0b !important;
            box-shadow: 0 0 15px rgba(245, 158, 11, 0.7);
            border-radius: 8px;
            background-color: #fffbeb;
        }
        .team-slot { display: flex; align-items: center; background-color: #ffffff; border: 1px solid #e5e7eb; border-radius: 4px; margin-bottom: 4px; transition: background-color 0.3s; position: relative; }
        .team-slot:last-of-type { margin-bottom: 0; }
        .team-name { flex-grow: 1; padding: 6px 8px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .team-name .rank { font-weight: bold; margin-right: 4px; }
        .team-name .rank-A { color: #ef4444; }
        .team-name .rank-B { color: #f97316; }
        .team-name .rank-C { color: #eab308; }
        .team-name .rank-D { color: #3b82f6; }
        .team-name .rank-E { color: #6b7280; }
        .team-name.seed { font-weight: bold; color: #ca8a04; }
        .score-input { width: 40px; padding: 6px 4px; border-left: 1px solid #e5e7eb; text-align: center; background-color: #fff; }
        .win-btn { background-color: #d1d5db; color: #fff; border: none; padding: 6px 8px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; cursor: pointer; font-weight: bold; transition: background-color 0.2s; }
        .team-slot:not(.empty) .win-btn { background-color: #3b82f6; }
        .team-slot:not(.empty):hover .win-btn { background-color: #2563eb; }
        .team-slot.winner { background-color: #dbeafe; border-color: #93c5fd; font-weight: 600; }
        .team-slot.loser { background-color: #f3f4f6; opacity: 0.6; }
        .team-slot.empty .team-name { color: #9ca3af; }
        .team-slot.empty .score-input, .team-slot.empty .win-btn, .team-slot.empty .details-btn { display: none; }
        .matchup::after { content: ''; position: absolute; top: 50%; width: 10px; height: 2px; background-color: #cbd5e1; }
        .bracket-half.left .matchup::after { right: -10px; }
        .bracket-half.right .matchup::after { left: -10px; }
        .round.subsequent-round .matchup::before { content: ''; position: absolute; top: -8px; height: calc(100% + 16px); width: 2px; background-color: #cbd5e1; }
        .bracket-half.left .round.subsequent-round .matchup::before { right: -10px; }
        .bracket-half.right .round.subsequent-round .matchup::before { left: -10px; }
        .hidden { display: none; }
        .news-article { border-left: 4px solid #3b82f6; cursor: pointer; transition: background-color 0.2s; }
        #modal-bg { background-color: rgba(0,0,0,0.5); }
        .confirm-modal, .details-modal, .save-load-modal, .newspaper-modal, .manager-modal, .gameover-modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.5); display: flex; align-items: center; justify-content: center; z-index: 100; }
        .confirm-modal-content, .details-modal-content, .save-load-modal-content, .newspaper-modal-content, .manager-modal-content, .gameover-modal-content { background-color: white; padding: 24px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
        .details-modal-content { width: 95%; max-width: 1000px; max-height: 90vh; overflow-y: auto;}
        .save-load-modal-content { width: 95%; max-width: 500px; }
        .newspaper-modal-content { width: 95%; max-width: 800px; max-height: 95vh; overflow-y: auto; }
        .manager-modal-content { max-width: 500px; width: 95%; }
        .gameover-modal-content { text-align: center; }
        .confirm-modal-content { text-align: center; }
        .loader { text-align: center; padding: 20px; font-style: italic; color: #6b7280; }
        .details-btn { background-color: #6b7280; color: white; font-size: 10px; padding: 2px 6px; border-radius: 4px; margin-left: auto; margin-right: 2px; }
        .details-btn:hover { background-color: #4b5563; }
        .matchup-footer { text-align: center; margin-top: 2px; display: flex; justify-content: center; align-items: center; gap: 4px;}
        .stats-table { width: 100%; border-collapse: collapse; font-size: 12px; }
        .stats-table th, .stats-table td { border: 1px solid #e5e7eb; padding: 4px 6px; text-align: center; }
        .stats-table th { background-color: #f3f4f6; }
        .stats-table input { width: 100%; border: none; text-align: center; background: transparent;}
        .stats-table input:focus { outline: 1px solid #3b82f6; }
        .modal-body-scroll { max-height: 70vh; overflow-y: auto; }
        #save-code-output { word-break: break-all; background-color: #f3f4f6; padding: 8px; border-radius: 4px; max-height: 200px; overflow-y: auto; user-select: all; }
        .bbs-comment { background-color: #ffffff; border: 1px solid #e5e7eb; padding: 8px 12px; border-radius: 8px; font-size: 14px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .match-summary-input { resize: none; height: 40px; }
        .article-error { background-color: #fee2e2; border-left: 4px solid #ef4444; color: #b91c1c; padding: 1rem; border-radius: 0.5rem; display: flex; justify-content: space-between; align-items: center; }
        .retry-btn { background-color: #ef4444; color: white; padding: 0.25rem 0.75rem; border-radius: 0.375rem; font-weight: 600; cursor: pointer; }
        .retry-btn:hover { background-color: #dc2626; }
        .namco-news-item { cursor: pointer; transition: background-color 0.2s; }
        .namco-news-tag { background-color: #f97316; color: white; font-size: 0.75rem; padding: 2px 8px; border-radius: 9999px; margin-left: 8px; }
        .newspaper-container { font-family: 'Noto Serif JP', serif; padding: 2rem; background-color: #fdfdf8; }
        .newspaper-early { filter: grayscale(100%); border: 2px solid #333; }
        .newspaper-late { border: 2px solid #a10e25; }
        .newspaper-header { text-align: center; border-bottom: 4px double #333; padding-bottom: 0.5rem; margin-bottom: 1rem; }
        .newspaper-title { font-size: 1.2rem; font-weight: 700; }
        .newspaper-date { font-size: 0.8rem; }
        .newspaper-content { display: flex; gap: 1.5rem; }
        .newspaper-main-headline { writing-mode: vertical-rl; text-orientation: mixed; font-size: 2.5rem; font-weight: 700; letter-spacing: 0.2em; border-right: 2px solid #333; padding-right: 1rem; margin-right: 1rem; }
        .newspaper-late .newspaper-main-headline { color: #a10e25; border-right-color: #a10e25;}
        .newspaper-body-content { flex-grow: 1; }
        .newspaper-sub-headline { font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; border-bottom: 1px solid #666; padding-bottom: 0.5rem; }
        .newspaper-late .newspaper-sub-headline { color: #333; }
        .newspaper-text { font-family: 'Noto Sans JP', sans-serif; column-count: 3; column-gap: 1.5rem; text-align: justify; font-size: 0.9rem; line-height: 1.8; }
        .newspaper-early .newspaper-text { column-count: 2; }
        .newspaper-score-box { border: 2px solid #333; padding: 1rem; text-align: center; margin-top: 1rem; }
        .newspaper-score-box h3 { font-weight: 700; margin-bottom: 0.5rem; font-size: 1.1rem; }
        .newspaper-score-box .score { font-size: 2rem; font-weight: 700; }
        .newspaper-late .newspaper-score-box { background-color: #fff8f8; border-color: #a10e25; }
        .newspaper-image-placeholder { width: 100%; height: 200px; background-color: #e0e0e0; margin: 1rem 0; display: flex; align-items: center; justify-content: center; font-family: 'Noto Sans JP', sans-serif; color: #888; border: 1px dashed #aaa; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div id="app-container" class="max-w-full mx-auto">
        <div class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800">283å­¦åœ’ã®ç”²å­åœ’ãƒ­ãƒ¼ãƒ‰</h1>
            <p id="tournament-year-display" class="text-gray-600 mt-2">ï¼ˆAIè¨˜è€…ï¼†ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ä»˜ãï¼‰</p>
        </div>

        <div id="setup" class="setup-card">
             <div class="w-full">
                 <h2 class="text-xl font-semibold text-gray-700 mb-4 border-b pb-2">ç™»å ´ãƒãƒ¼ãƒ  (64ãƒãƒ¼ãƒ )</h2>
                 <textarea id="teams-list" class="w-full h-96 p-3 border border-gray-300 rounded-lg" readonly></textarea>
             </div>
             <div class="mt-8 text-center">
                 <button id="resume-btn" class="bg-green-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-green-700 shadow-md mb-4 w-full md:w-auto">
                    å†é–‹ï¼ˆåˆã„è¨€è‘‰å…¥åŠ›ï¼‰
                 </button>
                 <button id="generate-btn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 shadow-md w-full md:w-auto">
                     æ–°ã—ã„å¤ã‚’å§‹ã‚ã‚‹
                 </button>
             </div>
        </div>

        <div id="tournament-display" class="hidden">
             <div id="namco-news-section" class="hidden display-card border-2 border-orange-400">
                 <h2 class="text-xl font-bold text-orange-600 mb-3 text-center">ãƒŠãƒ ã‚³ã‚°ãƒ«ãƒ¼ãƒ—ã‹ã‚‰ã®ãŠçŸ¥ã‚‰ã›</h2>
                 <div id="namco-news-content" class="space-y-2"></div>
             </div>
            <div class="flex justify-between items-start mb-4">
                <div>
                    <button id="generate-summary-btn" class="hidden bg-yellow-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-yellow-600 shadow-md">
                        ãƒ™ã‚¹ãƒˆ8ãƒã‚¤ãƒ©ã‚¤ãƒˆè¨˜äº‹ã‚’ç”Ÿæˆ
                    </button>
                    <button id="next-tournament-btn" class="hidden bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 shadow-md">
                        æ¬¡ã®å¤§ä¼šã¸é€²ã‚€
                    </button>
                </div>
               <div class="ml-auto">
                    <div class="flex items-center justify-end space-x-2">
                        <span id="save-feedback" class="text-gray-600 font-bold opacity-0 transition-opacity duration-500"></span>
                        <button id="save-btn" class="bg-sky-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-sky-700 shadow-md">ã‚»ãƒ¼ãƒ–</button>
                        <button id="reset-btn" class="bg-red-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-700 shadow-md">ãƒªã‚»ãƒƒãƒˆ</button>
                    </div>
                    <div id="skip-loader-container" class="h-6 text-right mt-1">
                         <span id="skip-loader" class="hidden text-sm text-gray-600 font-bold">è©¦åˆã‚’é€²è¡Œã—ã¦ã„ã¾ã™...</span>
                    </div>
                </div>
            </div>
            <div class="display-card">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆè¡¨</h2>
                <div class="bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 mb-4 rounded-md text-sm">
                    <p><b>æ“ä½œæ–¹æ³•:</b> 283å­¦åœ’ã®è©¦åˆã¯ã€ã‚¹ã‚³ã‚¢ã‚’å…¥åŠ›ã—ã¦å‹åˆ©ãƒœã‚¿ãƒ³ã€Œâ–¶ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®æŒ‡ç¤ºã«å¾“ã£ã¦é€²ã‚ã¾ã—ã‚‡ã†ï¼</p>
                </div>
                <div id="main-bracket-container"></div>
            </div>
            <div id="news-section" class="display-card">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">æ³¨ç›®ãƒ‹ãƒ¥ãƒ¼ã‚¹</h2>
                <div id="news-articles" class="space-y-4">
                    <p class="text-gray-500 text-center">ã¾ã ãƒ‹ãƒ¥ãƒ¼ã‚¹ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
                </div>
            </div>
             <div id="daiya-bbs-section" class="hidden display-card border-4 border-green-600">
                 <h2 id="daiya-bbs-title" class="text-2xl font-bold text-green-800 mb-4 text-center">ã€ç‰¹è¨­ã€‘ä»£çŸ¢æ± å¿œæ´æ²ç¤ºæ¿</h2>
                 <div id="daiya-bbs-comments" class="space-y-3">
                     <p class="text-gray-500 text-center">ã¾ã åå¿œã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
                 </div>
             </div>
             <div id="bbs-section" class="display-card">
                 <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">æ²ç¤ºæ¿ã®åå¿œ</h2>
                 <div id="bbs-comments" class="space-y-3">
                     <p class="text-gray-500 text-center">ã¾ã åå¿œã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
                 </div>
             </div>
        </div>
    </div>

    <div id="news-modal" class="fixed inset-0 z-50 hidden items-center justify-center">
        <div id="modal-bg" class="absolute inset-0"></div>
        <div class="relative bg-white rounded-lg shadow-xl max-w-2xl w-full m-4">
            <div class="p-6 modal-body-scroll">
                <h3 id="modal-title" class="text-2xl font-bold text-gray-900"></h3>
                <div id="modal-meta" class="text-gray-400 text-sm mt-2 flex items-center gap-4"></div>
                <p id="modal-body" class="mt-4 text-gray-600 whitespace-pre-wrap"></p>
            </div>
            <button id="modal-close" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>
    </div>
    
    <div id="confirm-modal" class="confirm-modal hidden">
        <div class="confirm-modal-content">
            <p id="confirm-modal-text" class="mb-4 text-lg"></p>
            <button id="confirm-ok" class="bg-red-600 text-white px-6 py-2 rounded-lg mr-2">ã¯ã„</button>
            <button id="confirm-cancel" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-lg">ã„ã„ãˆ</button>
        </div>
    </div>

    <div id="details-modal" class="details-modal hidden">
        <div class="details-modal-content">
            <h3 class="text-xl font-bold mb-4 text-center">è©¦åˆè©³ç´°å…¥åŠ›</h3>
            <div id="details-modal-body" class="space-y-6"></div>
            <div class="mt-6 text-center">
                <button id="details-save" class="bg-blue-600 text-white px-6 py-2 rounded-lg mr-2">ä¿å­˜</button>
                <button id="details-close" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-lg">é–‰ã˜ã‚‹</button>
            </div>
        </div>
    </div>
    
    <div id="save-load-modal" class="save-load-modal hidden">
        <div class="save-load-modal-content">
            <div class="flex border-b">
                <button id="save-tab-btn" class="px-4 py-2 font-semibold border-b-2 border-blue-500">ã‚»ãƒ¼ãƒ– (åˆã„è¨€è‘‰ã®ç™ºè¡Œ)</button>
                <button id="load-tab-btn" class="px-4 py-2 text-gray-500">ãƒ­ãƒ¼ãƒ‰ (åˆã„è¨€è‘‰ã®å…¥åŠ›)</button>
            </div>
            <div id="save-tab-content" class="py-4">
                <p class="text-sm mb-2">ç¾åœ¨ã®é€²è¡ŒçŠ¶æ³ã‚’ä¿å­˜ã™ã‚‹ãŸã‚ã®ã€Œåˆã„è¨€è‘‰ã€ã‚’ç™ºè¡Œã—ã¾ã™ã€‚ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>
                <button id="generate-save-code-btn" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">åˆã„è¨€è‘‰ã‚’ç™ºè¡Œ</button>
                <div id="save-code-area" class="hidden mt-4">
                    <p class="text-sm font-bold text-green-600">åˆã„è¨€è‘‰ãŒç™ºè¡Œã•ã‚Œã¾ã—ãŸã€‚ä»¥ä¸‹ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦å®‰å…¨ãªå ´æ‰€ã«ä¿ç®¡ã—ã¦ãã ã•ã„ã€‚</p>
                    <div class="flex items-center mt-2">
                        <div id="save-code-output" class="flex-grow text-xs"></div>
                        <button id="copy-save-code-btn" class="ml-2 bg-gray-200 px-3 py-1 rounded text-xs font-semibold hover:bg-gray-300">ã‚³ãƒ”ãƒ¼</button>
                    </div>
                    <p id="copy-feedback" class="text-xs text-green-600 mt-1 h-4"></p>
                </div>
            </div>
            <div id="load-tab-content" class="py-4 hidden">
                <p class="text-sm mb-2">ä¿å­˜ã—ãŸã€Œåˆã„è¨€è‘‰ã€ã‚’ä»¥ä¸‹ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚</p>
                <textarea id="load-code-input" placeholder="åˆã„è¨€è‘‰ã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘" class="w-full h-32 p-2 border rounded mb-2"></textarea>
                <button id="load-from-code-btn" class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700">ã“ã®ãƒ‡ãƒ¼ã‚¿ã§å†é–‹ã™ã‚‹</button>
            </div>
             <div class="mt-4 text-right">
                <button id="save-load-close" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-lg">é–‰ã˜ã‚‹</button>
            </div>
        </div>
    </div>

    <div id="newspaper-modal" class="newspaper-modal hidden">
        <div class="newspaper-modal-content">
            <div id="newspaper-modal-body"></div>
            <div class="mt-4 text-center">
                <button id="newspaper-close" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-lg">é–‰ã˜ã‚‹</button>
            </div>
        </div>
    </div>

    <div id="manager-modal" class="manager-modal hidden">
        <div class="manager-modal-content">
            <div class="flex items-start gap-4">
                <div>
                    <div class="w-16 h-16 bg-pink-200 rounded-full flex items-center justify-center text-3xl shadow-inner">ğŸ“</div>
                    <p class="text-center font-bold text-sm mt-1 text-pink-700">ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼</p>
                </div>
                <div class="flex-1">
                    <h3 id="manager-modal-title" class="text-lg font-bold text-gray-800 mb-3 border-b pb-2"></h3>
                    <p id="manager-modal-body" class="text-gray-700 leading-relaxed"></p>
                </div>
            </div>
            <div class="mt-6 text-right">
                <button id="manager-modal-close" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 shadow-md">ç¢ºèª</button>
            </div>
        </div>
    </div>

    <div id="gameover-modal" class="gameover-modal hidden">
        <div class="gameover-modal-content">
            <h3 class="text-2xl font-bold text-red-600 mb-4">GAME OVER</h3>
            <p id="gameover-modal-text" class="mb-6 text-lg"></p>
            <button id="gameover-reset" class="bg-red-600 text-white px-6 py-2 rounded-lg">æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™</button>
        </div>
    </div>

    <script type="module">
        // --- DOM Elements ---
        const setupEl = document.getElementById('setup');
        const tournamentDisplayEl = document.getElementById('tournament-display');
        const teamsTextarea = document.getElementById('teams-list');
        const generateBtn = document.getElementById('generate-btn');
        const resumeBtn = document.getElementById('resume-btn');
        const resetBtn = document.getElementById('reset-btn');
        const nextTournamentBtn = document.getElementById('next-tournament-btn');
        const saveBtn = document.getElementById('save-btn');
        const saveFeedback = document.getElementById('save-feedback');
        const mainBracketContainer = document.getElementById('main-bracket-container');
        const newsContainer = document.getElementById('news-articles');
        const bbsCommentsContainer = document.getElementById('bbs-comments');
        const daiyaBbsSection = document.getElementById('daiya-bbs-section');
        const daiyaBbsTitle = document.getElementById('daiya-bbs-title');
        const daiyaBbsCommentsContainer = document.getElementById('daiya-bbs-comments');
        const namcoNewsSection = document.getElementById('namco-news-section');
        const namcoNewsContent = document.getElementById('namco-news-content');
        const tournamentYearDisplay = document.getElementById('tournament-year-display');
        const generateSummaryBtn = document.getElementById('generate-summary-btn');
        const skipLoader = document.getElementById('skip-loader');
        const newsModal = document.getElementById('news-modal');
        const modalBg = document.getElementById('modal-bg');
        const modalClose = document.getElementById('modal-close');
        const confirmModal = document.getElementById('confirm-modal');
        const detailsModal = document.getElementById('details-modal');
        const saveLoadModal = document.getElementById('save-load-modal');
        const saveTabBtn = document.getElementById('save-tab-btn');
        const loadTabBtn = document.getElementById('load-tab-btn');
        const saveTabContent = document.getElementById('save-tab-content');
        const loadTabContent = document.getElementById('load-tab-content');
        const generateSaveCodeBtn = document.getElementById('generate-save-code-btn');
        const loadFromCodeBtn = document.getElementById('load-from-code-btn');
        const saveLoadCloseBtn = document.getElementById('save-load-close');
        const copySaveCodeBtn = document.getElementById('copy-save-code-btn');
        const newspaperModal = document.getElementById('newspaper-modal');
        const newspaperModalBody = document.getElementById('newspaper-modal-body');
        const newspaperCloseBtn = document.getElementById('newspaper-close');
        const managerModal = document.getElementById('manager-modal');
        const managerModalTitle = document.getElementById('manager-modal-title');
        const managerModalBody = document.getElementById('manager-modal-body');
        const managerModalClose = document.getElementById('manager-modal-close');
        const gameoverModal = document.getElementById('gameover-modal');
        const gameoverModalText = document.getElementById('gameover-modal-text');
        const gameoverResetBtn = document.getElementById('gameover-reset');
        
        // --- State Management ---
        let tournamentState = {};
        let currentMatchIdForDetails = null;
        const PLAYER_TEAM = "283å­¦åœ’";
        let nextGameAction = null;

        // --- Team Master Data ---
        const TEAM_DATA = {
            "è¥¿æµ¦": { name_yomi: "ã«ã—ã†ã‚‰", type: "å…¬ç«‹", deviation: 52, best: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ16", last: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ16", info: "ä¸‰å¹´å‰ã«ã§ããŸæ–°è¨­æ ¡ã€‚æ­´å²ã¯æµ…ã„ãŒé©šç•°ã®èºé€²ãŒå…‰ã‚‹ã€‚" },
            "æœ¬å³¶è¶Šè°·": { name_yomi: "ã‚‚ã¨ã˜ã¾ã“ã—ãŒã‚„", type: "ç§ç«‹", deviation: 32, best: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ8", last: "åˆæˆ¦æ•—é€€", info: "è¿‘å¹´é‡çƒéƒ¨ã«åŠ›ã‚’å…¥ã‚Œã¦ã„ã‚‹æ–°èˆˆç§ç«‹ã€‚ãƒ—ãƒ­é‡çƒé¸æ‰‹ã‚’å¤–éƒ¨ã‚³ãƒ¼ãƒã«æ‹›è˜ã—ã¦ã„ã‚‹ã€‚" },
            "æµ·å ‚å­¦åœ’": { name_yomi: "ã‹ã„ã©ã†ãŒããˆã‚“", type: "ç§ç«‹", deviation: 40, best: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ8", last: "çœŒå¤§ä¼š2å›æˆ¦", info: "ã‹ã¤ã¦ã¯ç”²å­åœ’ã‚’å„ªå‹ã—çœŒå†…ã§æµ·å ‚ãƒ–ãƒ¼ãƒ ã‚’å·»ãèµ·ã“ã—ãŸã€‚ãŒã€ãã‚Œã‚‚30å¹´å‰ã®è©±ã§ã‚ã‚Šã€ä»Šã¨ãªã£ã¦ã¯ã‹ã¤ã¦ã®è¼ãã¯è¦‹ãˆãªã„å¤è±ªã¨åŒ–ã—ã¦ã„ã‚‹" },
            "åˆæ˜Ÿå­¦åœ’": { name_yomi: "ã¯ã¤ã¼ã—ãŒããˆã‚“", type: "ç§ç«‹", deviation: 58, best: "çœŒå¤§ä¼š2å›æˆ¦", last: "åˆæˆ¦æ•—é€€", info: "çœŒã«è¤‡æ•°ã‚ã‚‹ãƒŠãƒ ã‚³ã‚°ãƒ«ãƒ¼ãƒ—ã®è¨­ç«‹ã—ãŸå­¦æ ¡ã®ä¸€ã¤ã€‚é‡çƒéƒ¨ã¯è¨­ç«‹ã—ãŸã°ã‹ã‚Šã§ã€éƒ¨å“¡æ•°ã¯å¤šããªã„ã‚‚ã®ã®ã€ãã®ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ã¯é«˜ãã€‚æ¯å¹´ä¸Šä½ã«é£Ÿã„è¾¼ã‚“ã§ãã‚‹ã€‚é‡çƒéƒ¨ã‚ˆã‚Šã‚‚å­¦æ ¡ã¨ã—ã¦ã®ç‰¹è‰²ã§ã‚ã‚‹ã‚¢ã‚¤ãƒ‰ãƒ«ç§‘ç›®å½“ã¦ã«å—é¨“ã™ã‚‹äººãŒå¤šã„ã€‚" },
            "ç·‘å±±": { name_yomi: "ã¿ã©ã‚Šã‚„ã¾", type: "å…¬ç«‹", deviation: 45, best: "ãªã—", last: "ãªã—", info: "ä»Šå¹´åˆã‚ã¦é‡çƒéƒ¨ã‚’æ–°ã—ãå‰µç«‹ã—ãŸå…¬ç«‹æ ¡ã€‚å…¨å“¡1å¹´ç”Ÿã§çµŒé¨“ã¯æµ…ã„ãŒã€ã‚¬ãƒƒãƒ„ã§ä»–æ ¡ã«é£Ÿã‚‰ã„ã¤ããŸã„" },
            "765ç·åˆé«˜æ ¡": { name_yomi: "ãªã‚€ã“ãã†ã”ã†", type: "ç§ç«‹", deviation: 55, best: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ16", last: "çœŒå¤§ä¼š2å›æˆ¦", info: "åˆæ˜Ÿå­¦åœ’ã¨çµŒå–¶æ¯ä½“ã¯åŒã˜ãƒŠãƒ ã‚³ã‚°ãƒ«ãƒ¼ãƒ—ã§ã‚ã‚‹ãŒã“ã¡ã‚‰ã¯é‡çƒéƒ¨ã«åŠ›ã‚’å…¥ã‚Œã¦ã„ã‚‹ã€‚2å¹´å‰ã«ã¯çœŒã‚’åˆ¶è¦‡ã—ç”²å­åœ’ã§ã‚‚ãƒ™ã‚¹ãƒˆ16ã¾ã§é€²ã‚“ã çµŒé¨“ã‚‚ã‚ã‚Šã€å½“æ™‚1å¹´ç”Ÿã‹ã‚‰ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼ã ã£ãŸãƒ¡ãƒ³ãƒãƒ¼ãŒå†ã³ç”²å­åœ’ã‚’ç›®æŒ‡ã—ã€è–åœ°ã‚’çŸ¥ã‚‹ã‚‚ã®ã¨ã—ã¦ãƒãƒ¼ãƒ ã‚’å¼•ã£å¼µã£ã¦ã„ã‚‹ã€‚", popularity: true },
            "é·²å°¾": { name_yomi: "ã‚ã—ãŠ", type: "å…¬ç«‹", deviation: 53, best: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ16", last: "åˆæˆ¦æ•—é€€", info: "æ™®é€šã®å…¬ç«‹æ ¡ã€‚æ˜”ã¯åœ°åŒºä¸€ç•ªã®é€²å­¦æ ¡ã ã£ãŸãŒç«‹åœ°ã®æ‚ªã•ã¨å°‘å­åŒ–ã«ä¼´ã„åå·®å€¤ã‚‚ä½ä¸‹ã€è¿‘å¹´ã¯æ¯å¹´å®šå“¡å‰²ã‚Œã‚’èµ·ã“ã—ã¦ãŠã‚Šã€å»ƒæ ¡ã‚‚æ™‚é–“ã®å•é¡Œã§ã‚ã‚‹ã€‚é‡çƒéƒ¨ã‚‚ãƒ™ã‚¹ãƒˆ16ãŒéå»ã«ä¸€åº¦ãã‚Šã§ãƒ‘ãƒƒã¨ã—ãªã„ã€‚" },
            "283å­¦åœ’": { name_yomi: "ã¤ã°ã•ãŒããˆã‚“", type: "ç§ç«‹", deviation: 60, best: "ç”²å­åœ’1å›æˆ¦", last: "çœŒå„ªå‹(ç”²å­åœ’åˆæˆ¦æ•—é€€)", info: "ãƒŠãƒ ã‚³ã‚°ãƒ«ãƒ¼ãƒ—ãŒ15å¹´å‰ã«è¨­ç«‹ã—ãŸé«˜æ ¡ã€‚æ˜¨å¹´ã¯2å¹´ç”Ÿã‚¨ãƒ¼ã‚¹å§«å·ãŒæŠ•æ‰“ã«ã‚ãŸã‚Šãƒãƒ¼ãƒ ã‚’å¼•ã£å¼µã‚Šå‰µéƒ¨åˆã®å„ªå‹ã‚’æˆã—é‚ã’ãŸã€‚æ˜¨å¹´ã®ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼ã‚‚è¤‡æ•°æ®‹ã£ã¦ãŠã‚Šã€å¤§ä¼šé€£è¦‡ã«å‘ã‘ã€å‰å›ç‹è€…ãŒç‰™ã‚’ç ”ãã€‚", popularity: true },
            "åœŸç†ç‰å·¥æ¥­": { name_yomi: "ã©ã‚Šã‚‹ã“ã†ãã‚‡ã†", type: "å…¬ç«‹", deviation: 41, best: "çœŒå¤§ä¼š2å›æˆ¦", last: "åˆæˆ¦æ•—é€€", info: "çœŒã§å”¯ä¸€ã®å·¥æ¥­é«˜æ ¡ã€‚é‡çƒéƒ¨ã¯ã‚ã¾ã‚Šå¼·ããªã„ã€‚" },
            "å®Ÿè·µå­¦åœ’": { name_yomi: "ã˜ã£ã›ã‚“ãŒããˆã‚“", type: "ç§ç«‹", deviation: 63, best: "ç”²å­åœ’å‡ºå ´", last: "åˆæˆ¦æ•—é€€", info: "ç§ç«‹ã®é€²å­¦æ ¡ã€‚é‡çƒéƒ¨ã¯ã‚ã¾ã‚Šå¼·ããªã„ãŒã€ã‚µãƒƒã‚«ãƒ¼éƒ¨ãŒå¼·ãã€é‡çƒéƒ¨ã®å¤§ä¼šæ™‚ã«ã¯æœ‰å¿—ã§ã‚µãƒƒã‚«ãƒ¼éƒ¨ãŒå¿œæ´ã«é§†ã‘ä»˜ã‘ã‚ªãƒªã‚¸ãƒŠãƒ«ã®ã‚µãƒƒã‚«ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ«ã®å¿œæ´ã§ç››ã‚Šç«‹ã¦ã‚‹ã€‚ã“ã‚Œã‚’å®Ÿè·µå­¦åœ’ã®åç‰©ã¨ã—ã¦è¦‹ã«æ¥ã‚‹éš ã‚Œãƒ•ã‚¡ãƒ³ã‚‚å¤šã„ã€‚" },
            "æ­¦è”µé‡ç¬¬ä¸€": { name_yomi: "ã‚€ã•ã—ã®ã ã„ã„ã¡", type: "å…¬ç«‹", deviation: 55, best: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ8", last: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ8", info: "å…¬ç«‹é€²å­¦æ ¡ã€‚é‡çƒéƒ¨ã¯ã“ã“æ•°å¹´åˆæˆ¦æ•—é€€ãŒç¶šã„ã¦ã„ãŸãŒã€140kmå·¦è…•ã®æ¦›åã®å°é ­ã«ã‚ˆã‚Šæ˜¨å¹´ã®å¤ã¯å‰µéƒ¨åˆã®ãƒ™ã‚¹ãƒˆ8ã«é€²å‡ºã—ãŸã€‚2å¹´ç”Ÿã¨ãªã£ãŸæ¦›åã®é€Ÿçƒã¯å¥åœ¨ã§ã‚ã‚Šã€ä»Šå¹´ã‚‚æ­¦è”µé‡æ—‹é¢¨ã«æœŸå¾…ã—ãŸã„ã€‚" },
            "ä»£çŸ¢æ±": { name_yomi: "ã ã„ã‚„ã²ãŒã—", type: "å…¬ç«‹", deviation: 65, best: "ç”²å­åœ’3å›æˆ¦", last: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ4", info: "è€è‹¥ç”·å¥³å•ã‚ãšåœ°å…ƒæ°‘ã«æ„›ã•ã‚Œã‚‹å‰µç«‹93å¹´ã‚’è¿ãˆã‚‹ä¼çµ±æ ¡ã€‚è¿‘å¹´ã¯ä»–æ ¡ã®ç§ç«‹ã¨ã®é¸æ‰‹ç²å¾—ç«¶äº‰ã«ä¸€ã¤é…ã‚Œã‚’ã¨ã£ã¦ãŠã‚Šã€ç”²å­åœ’ã‹ã‚‰ã¯é ã–ã‹ã£ã¦ã„ã‚‹ãŒã€æ­´å²ã¯åšãã€ç”²å­åœ’ã«ã¯é€šç®—13å›å‡ºå ´ã—ã¦ã„ã‚‹ã€‚ãã®ãŸã‚å…¬ç«‹ã«ä¼¼åˆã‚ãšå¤šé¡ã®å¯„ä»˜ã«ã‚ˆã‚Šè¨­å‚™ã¯å……å®Ÿã—ã¦ã„ã‚‹ã€‚é ­ã‚‚ã‚ˆãã‚¹ãƒãƒ¼ãƒ„ã‚‚å¼·ã„ãŸã‚ã€çœŒæ°‘ã®æ†§ã‚Œã§ã‚ã‚‹ã€‚ä»£çŸ¢æ±ã®è©¦åˆãŒã‚ã‚‹éš›ã«ã¯çƒå ´ã«å¤šãã®OBãŒé§†ã‘ä»˜ã‘ã€å¤§å¿œæ´å›£ã‚’çµæˆã—ã€ç›¸æ‰‹ã‚’åœ§å€’ã™ã‚‹ã€‚è¿‘å¹´ã¯ãƒŠãƒ ã‚³ã‚°ãƒ«ãƒ¼ãƒ—ãŒçœŒå†…ã‚’ç‰›è€³ã‚Šã‹ã‘ã¦ã„ã‚‹ãŸã‚ã€å…¬ç«‹ã®å¸Œæœ›ã®æ˜Ÿã¨ã—ã¦ãƒ¡ãƒ‡ã‚£ã‚¢ã«å–ã‚Šä¸Šã’ã‚‰ã‚Œã‚‹ã“ã¨ã‚‚å¤šã„ã€‚", popularity: true },
            "é¢¨æ—å¤§å°¾": { name_yomi: "ãµã†ã‚Šã‚“ãŸã„ã³", type: "ç§ç«‹", deviation: 59, best: "ç”²å­åœ’2å›æˆ¦", last: "åˆæˆ¦æ•—é€€", info: "ç§ç«‹ã®é€²å­¦æ ¡ã€‚æ˜”ã¯é‡çƒéƒ¨ãŒå¼·ã‹ã£ãŸãŒç›£ç£ã®ä¸ç¥¥äº‹ã«ã‚ˆã‚Šä¸€åº¦ã¯å»ƒéƒ¨å±æ©Ÿã«ã¾ã§ãªã£ãŸã€‚æ˜”ã‚ˆã‚Šã¯å‹¢ã„ã¯ãªã„ãŒã€çµŒå–¶ä½“åˆ¶ã‚’ä¸€æ–°ã—ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ã‚¯ãƒªãƒ¼ãƒ³åŒ–ã«åŠªã‚ãŸçµæœã€éƒ¨å“¡æ•°ã‚‚å›å¾©ã—ã¦ããŸã€‚ãã‚ãã‚å¤è±ªã¨ã—ã¦ã€å¾©æ´»ã®ç‹¼ç…™ã‚’ã‚ã’ãŸã„ã€‚" },
            "é’é“": { name_yomi: "ã›ã„ã©ã†", type: "ç§ç«‹", deviation: 54, best: "ç”²å­åœ’æº–å„ªå‹", last: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ8", info: "28å¹´å‰ã«ç”²å­åœ’æº–å„ªå‹ã®çµŒé¨“ã‚‚ã‚ã‚‹å¼·è±ªæ ¡ã€‚æ¯å¹´ãƒ™ã‚¹ãƒˆ8ã¾ã§ã¯å®‰å®šã—ã¦å‡ºå ´ã™ã‚‹ãŒã€è¿‘å¹´ã¯ãã“ãŒå£ã¨ãªã‚Šçªç ´ã§ããšã«ã„ã‚‹ã€‚ä»Šå¹´ã“ãã¯ç”²å­åœ’ã¸ã€ã¨å­¦æ ¡å´ã®ã‚µãƒãƒ¼ãƒˆã‚‚åšã„ã€‚", popularity: true },
            "è–ç§€": { name_yomi: "ã›ã„ã—ã‚…ã†", type: "ç§ç«‹", deviation: 48, best: "ãªã—", last: "ãªã—", info: "é‡çƒéƒ¨å‰µéƒ¨ä¸€å¹´ç›®ã®æ–°ç±³é‡çƒéƒ¨ã€‚éƒ¨å“¡ã¯10äººã¨å°‘ãªã„ãŒä¸»å°†ã§3ç•ªã‚’æ‰“ã¤èŒ‚é‡ãŒæ”»å®ˆã§ãƒãƒ¼ãƒ ã‚’å¼•ã£å¼µã‚‹ã€‚" },
            "å¤§èˆ¹æ¸¡": { name_yomi: "ãŠãŠãµãªã¨", type: "å…¬ç«‹", deviation: 51, best: "ç”²å­åœ’å‡ºå ´", last: "åˆæˆ¦æ•—é€€", info: "ç”²å­åœ’å‡ºå ´ã»ã©ã§ã¯ãªã„ã‚‚ã®ã®ã€å…¬ç«‹æ ¡ã®ä¸­ã§ã¯ã‚Œã£ãã¨ã—ãŸå®ŸåŠ›ã‚’ã‚‚ã¤ä¸­å …æ ¡ã€‚ä»Šå¹´ã¯ãƒ—ãƒ­æ³¨ç›®å³è…•ã®æ–è—¤ã‚’æ“ã—ç”²å­åœ’åˆå‡ºå ´ã‚’ç‹™ã†ã€‚" },
            "ç¾åŸå­¦åœ’": { name_yomi: "ã¿ã—ã‚ãŒããˆã‚“", type: "ç§ç«‹", deviation: 61, best: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ4", last: "çœŒå¤§ä¼š2å›æˆ¦", info: "ãƒŠãƒ ã‚³ã‚°ãƒ«ãƒ¼ãƒ—ã‚’æ¯ä½“ã¨ã™ã‚‹é«˜æ ¡ã€‚ã“ã¡ã‚‰ã®é‡çƒéƒ¨ã¯ä¸­å …æ ¡ã¨ã—ã¦çœŒå†…ã§ãªãŠé¦³ã›ã¦ãŠã‚Šã€çµ„ã¿åˆã‚ã›æ¬¡ç¬¬ã§ã¯ç”²å­åœ’ã‚‚ç‹™ãˆã‚‹å®ŸåŠ›ã‚’æŒã£ã¦ã„ã‚‹ã€‚è¿‘å¹´ã¯ã»ã‹ã®é«˜æ ¡ã«ãƒªã‚½ãƒ¼ã‚¹ã‚’æŒã£ã¦ã„ã‹ã‚Œã€ãƒŠãƒ ã‚³ã‚°ãƒ«ãƒ¼ãƒ—ã®ä¸­ã ã¨ä½è¿·æ°—å‘³ã§ã‚ã‚‹ã€‚" },
            "æ±å¤§å­¦åœ’": { name_yomi: "ã¨ã†ã ã„ãŒããˆã‚“", type: "ç§ç«‹", deviation: 78, best: "çœŒå¤§ä¼š2å›æˆ¦", last: "åˆæˆ¦æ•—é€€", info: "å…¨å›½çš„ã«æœ‰åãªé€²å­¦æ ¡ã€‚é‡çƒéƒ¨ã¯å¼±ã„ãŒã€æŒã¡å‰ã®é ­è„³ã‚’æ´»ã‹ã—ãŸãƒ‡ãƒ¼ã‚¿é‡çƒã§å¼·è±ªæ ¡ã«é£Ÿã‚‰ã„ã¤ããŸã„ã€‚" },
            "é‡‘è¶³è¾²æ¥­": { name_yomi: "ã‹ãªã‚ã—ã®ã†ãã‚‡ã†", type: "å…¬ç«‹", deviation: 42, best: "ç”²å­åœ’æº–å„ªå‹", last: "çœŒå¤§ä¼š2å›æˆ¦", info: "æ•°å¹´å‰ã«ã¯é‡‘è¾²ãƒ•ã‚£ãƒ¼ãƒãƒ¼ã§ä¸€ä¸–ã‚’é¢¨é¡ã—ãŸãŒã€ãã®å¾Œã¯ä½è¿·ã—ã¦ã„ã‚‹ã€‚ã‚‚ã†ä¸€åº¦è¼ãã¹ãç”²å­åœ’ã‚’ç‹™ã£ã¦ã„ã‚‹ã€‚", popularity: true },
            "å¾¡æ®¿å ´å—": { name_yomi: "ã”ã¦ã‚“ã°ã¿ãªã¿", type: "å…¬ç«‹", deviation: 54, best: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ16", last: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ16", info: "å±±é–“éƒ¨ã«ã‚ã‚‹å…¬ç«‹æ ¡ã€‚æ¯å¹´åˆæˆ¦æ•—é€€ãŒç¶šã„ã¦ã„ãŸãŒæ˜¨å¹´ã¯11å¹´ã¶ã‚Šåˆæˆ¦çªç ´ã‚’çš®åˆ‡ã‚Šã«50å¹´ã¶ã‚Šã®ãƒ™ã‚¹ãƒˆ16ã«é€²å‡ºã€‚ä»Šå¹´ã‚‚èºé€²ã¸æœŸå¾…ãŒã‹ã‹ã‚‹ã€‚" },
            "é›·é–€å—": { name_yomi: "ã‚‰ã„ã‚‚ã‚“ã¿ãªã¿", type: "å…¬ç«‹", deviation: 61, best: "ç”²å­åœ’2å›æˆ¦", last: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ4", info: "ä»£çŸ¢æ±ã¨ä¸¦ã¶çœŒå†…äºŒå¤§å¤§è¦æ¨¡å…¬ç«‹ã®ã²ã¨ã¤ã€‚ä»£çŸ¢æ±ãŒæ–‡æ­¦ä¸¡é“ãªã‚‰ã°ã“ã¡ã‚‰ã¯ã‚¹ãƒãƒ¼ãƒ„ãŒç››ã‚“ã§ã‚ã‚‹ã€‚ç‰¹ã«ãƒ©ã‚°ãƒ“ãƒ¼éƒ¨ã‚µãƒƒã‚«ãƒ¼éƒ¨ã¯å…¨å›½åˆ¶è¦‡ã‚’æˆã—é‚ã’ã¦ãŠã‚Šã€é‡çƒéƒ¨ã®èºé€²ã«ã‚‚æœŸå¾…ãŒã‹ã‹ã‚‹ã€‚" },
            "æ¨ªé ˆè³€": { name_yomi: "ã‚ˆã“ã™ã‹", type: "å…¬ç«‹", deviation: 55, best: "ç”²å­åœ’å‡ºå ´", last: "çœŒå¤§ä¼š2å›æˆ¦", info: "æµ·è¾ºã«ã‚ã‚‹å…¬ç«‹æ ¡ã€‚é‡çƒéƒ¨ã¨ã—ã¦ã¯ä¸­å …æ ¡ã§ã‚ã‚‹ã€‚" },
            "ä»Šæ²»å­¦åœ’": { name_yomi: "ã„ã¾ã°ã‚ŠãŒããˆã‚“", type: "ç§ç«‹", deviation: 52, best: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ16", last: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ16", info: "ä½“è‚²ç§‘ã®ã¿ã®é€šä¿¡åˆ¶ç§ç«‹ã€‚ç€ã€…ã¨çµæœã‚’å‡ºã—ã¦ãŠã‚Šã€æ˜¨å¹´ã¯ãƒ™ã‚¹ãƒˆ16" },
            "ç”°è¾ºæ°´ç”£": { name_yomi: "ãŸãªã¹ã™ã„ã•ã‚“", type: "å…¬ç«‹", deviation: 44, best: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ4", last: "çœŒå¤§ä¼š2å›æˆ¦", info: "è²´é‡ãªæ°´ç”£é«˜æ ¡ã€‚é‡çƒéƒ¨ã‚‚ä¸€æ˜¨å¹´ã¯ãƒ™ã‚¹ãƒˆ4ã¸é€²å‡ºã—ãŸã‚Šã¨å‹¢ã„ãŒã‚ã‚‹ã€‚è©¦åˆæ™‚ã®ã‚¹ã‚¿ãƒ³ãƒ‰ã«ã¯å¤§æ¼ã¨ã‹ã‹ã‚ŒãŸå¤§ããªæ——ãŒèˆã†ã€‚" },
            "å…«åƒä»£": { name_yomi: "ã‚„ã¡ã‚ˆ", type: "å…¬ç«‹", deviation: 59, best: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ8", last: "åˆæˆ¦æ•—é€€", info: "å¤§ããªå¸‚ã«ã‚ã‚‹ã€‚ä¸­è¦æ¨¡å…¬ç«‹ã€‚é‡çƒéƒ¨ã¨ã—ã¦ã®ç‰¹è‰²ã¯ã“ã‚Œã¨ã„ã£ã¦ãªã„ãŒã€äººå£ãŒå¤šã„åœ°åŸŸã®ãŸã‚ã€æ¯å¹´ãã‚Œãªã‚Šã®ãƒ¬ãƒ™ãƒ«ã®æ–°å…¥ç”ŸãŒé›†ã¾ã‚‹ã€‚" },
            "æ—¥å—å­¦åœ’": { name_yomi: "ã«ã¡ãªã‚“ãŒããˆã‚“", type: "ç§ç«‹", deviation: 46, best: "ç”²å­åœ’ãƒ™ã‚¹ãƒˆ4", last: "åˆæˆ¦æ•—é€€", info: "é‡çƒéƒ¨ã¯ãã“ãã“ã¤ã‚ˆã„ãŒã‚¬ãƒ©ãŒæ‚ªãã€ãƒ¡ãƒ‡ã‚£ã‚¢å—ã‘ãŒæ‚ªã„ã€‚" },
            "è–¬å¸«": { name_yomi: "ã‚„ãã—", type: "ç§ç«‹", deviation: 50, best: "ç”²å­åœ’å‡ºå ´", last: "çœŒå¤§ä¼š2å›æˆ¦", info: "æ™®é€šã®ç§ç«‹é«˜æ ¡ã ãŒã€ãŸã¾ã«ä¸Šä½ã«ãã‚‹ã€‚" },
            "ç¨²åŸå®Ÿæ¥­": { name_yomi: "ã„ãªã—ã‚ã˜ã¤ãã‚‡ã†", type: "ç§ç«‹", deviation: 57, best: "ç”²å­åœ’å„ªå‹", last: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ8", info: "é‡çƒéƒ¨ã«åŠ›ã‚’å…¥ã‚Œã¦ã„ã‚‹ç§ç«‹ã€‚æ¯å¹´ãƒ™ã‚¹ãƒˆ8ã®å£ã«è‹¦ã—ã‚“ã§ã„ã‚‹ãŒã€æˆå®®ã€å¹³é‡ã€èµ¤æ¾ã®ä¸‰æšçœ‹æ¿ã§ç”²å­åœ’ã‚’ç›®æŒ‡ã™ã€‚", popularity: true },
            "å¸‚å¤§ä¸‰": { name_yomi: "ã—ã ã„ã•ã‚“", type: "ç§ç«‹", deviation: 56, best: "ç”²å­åœ’å‡ºå ´", last: "çœŒå¤§ä¼š2å›æˆ¦", info: "ã“ã¡ã‚‰ã‚‚ãƒ™ã‚¹ãƒˆï¼˜ã‚„16ã«ã¯ã‚ˆãé¡”ã‚’ã ã™ç§ç«‹æ ¡ã€‚ç·åˆåŠ›ã¯ã‚ã‚‹ã‚‚ã®ã®ãƒ‘ãƒƒã¨ã—ãªã„ã€‚" },
            "æ¥µäºœä¹…": { name_yomi: "ã”ãã‚ã", type: "ç§ç«‹", deviation: 38, best: "ç”²å­åœ’å‡ºå ´", last: "åˆæˆ¦æ•—é€€", info: "ã‚€ã‹ã—ã¯ç”²å­åœ’ã«ã‚‚å‡ºå ´ã—ãŸã“ã¨ã‚ã‚‹å­¦æ ¡ã€‚ä»Šã¯å°‘å­åŒ–ã®ã‚ãŠã‚Šã‚’å—ã‘ã€ãŸã ã®ä½åå·®å€¤é«˜æ ¡ã«ãªã£ã¦ã„ã‚‹ã€‚" },
            "éŠ€æ²³å­¦é™¢": { name_yomi: "ãã‚“ãŒãŒãã„ã‚“", type: "ç§ç«‹", deviation: 55, best: "ç”²å­åœ’å‡ºå ´", last: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ16", info: "VRã‚’å–ã‚Šå…¥ã‚ŒãŸãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’è¡Œã†çã—ã„å­¦æ ¡ã€‚ã‚ˆãé‡çƒyoutuberã«å–ã‚Šä¸Šã’ã‚‰ã‚Œã¦ã„ã‚‹ã€‚é‡çƒéƒ¨ã®æˆç¸¾ã‚‚ãƒœãƒãƒœãƒ" },
            "çŒ«çŸ¢": { name_yomi: "ã­ã“ã‚„", type: "å…¬ç«‹", deviation: 49, best: "çœŒå¤§ä¼š2å›æˆ¦", last: "åˆæˆ¦æ•—é€€", info: "äººå£1ä¸‡äººã»ã©ã®ç”ºã«ã‚ã‚‹å°è¦æ¨¡ãªå…¬ç«‹æ ¡ã€‚ãƒãƒ£ãƒ³ã‚¹å¿œæ´æ™‚ã«ã¯ãã®æ ¡åã«ã¡ãªã‚“ã§ã€ŒçŒ«ãƒ€ãƒ³ã‚¹ã€ã‚’æŠ«éœ²ã™ã‚‹ã€‚" },
            "è™åºœå³¶ç·åˆ": { name_yomi: "ã“ãµã¨ã†ãã†ã”ã†", type: "å…¬ç«‹", deviation: 47, best: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ16", last: "åˆæˆ¦æ•—é€€", info: "é›¢å³¶ã«ã‚ã‚‹å…¬ç«‹æ ¡ã€‚ç§»å‹•ã®éš›ã«ã¯å·¨é¡ã®è³‡é‡‘ãŒå¿…è¦ãªã®ã§ã€æœ¬å³¶ã¸é å¾ã¯ã‚ã£ãŸã«ã‚„ã‚‰ãªã„ã€‚ãã®ãŸã‚ã€ç·´ç¿’è©¦åˆã¯åŸºæœ¬çš„ã«çµ„ã¾ã‚Œãªã„ãŒã€Œè™åºœå³¶ã‚¹ãƒ”ãƒªãƒƒãƒ„ã€ã‚’èƒ¸ã«ãƒ™ã‚¹ãƒˆ8ã‚’ç›®æŒ‡ã™ã€‚å³¶æ°‘ã‹ã‚‰ã®ä¿¡é ¼ã‚‚åšãã€è©¦åˆæ™‚ã«ã¯å³¶æ°‘ã®5å‰²ãŒé§†ã‘ä»˜ã‘ã¦ãã‚‹ã‚‰ã—ã„ã€‚" },
            "åŠ›å…¨": { name_yomi: "ã‚Šããœã‚“", type: "å…¬ç«‹", deviation: 51, best: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ8", last: "åˆæˆ¦æ•—é€€", info: "æ ¡åé€šã‚Šã€åŠ›ã“ãå…¨ã¦ãŒæ ¡è¨“ã®å…¬ç«‹æ ¡ã€‚ç·´ç¿’ã§ã¯ã‚¦ã‚¨ã‚¤ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒ6å‰²ã‚’å ã‚ã‚‹ãŒã€ç§ç«‹ã®æ „é¤ŠçŠ¶æ…‹ã«ã¯ã‹ãªã‚ãšã€ã„ã¤ã‚‚å¼·è±ªç§ç«‹ã«ç«¶ã‚Šè² ã‘ã¦ã—ã¾ã†ã€‚" },
            "å¸ç‹å®Ÿæ¥­": { name_yomi: "ã¦ã„ãŠã†ã˜ã¤ãã‚‡ã†", type: "ç§ç«‹", deviation: 55, best: "ç”²å­åœ’å„ªå‹", last: "åˆæˆ¦æ•—é€€", info: "å¤è±ªã€‚åŠä¸–ç´€å‰ã¯5é€£è¦‡ã‚’ã™ã‚‹ã»ã©ã®å®ŸåŠ›ã‚’æŒã£ã¦ã„ãŸãŒã€ãã‚Œã¯éå»ã®è©±ã€‚æœ€è¿‘ã§ã¯ãƒ™ã‚¹ãƒˆ8ã«ã‚‚ä¸ŠãŒã£ã¦ã“ãªã„ã®ã§ã€å¾©æ´»ã‚’å¾…ã¡æœ›ã‚€å£°ã‚‚å¤šã„ã€‚" },
            "å°æŸ": { name_yomi: "ã“ã¥ã‹", type: "ç§ç«‹", deviation: 56, best: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ4", last: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ16", info: "æ˜”ã‹ã‚‰ã‚ã‚‹æ­´å²ã®ã‚ã‚‹ç§ç«‹æ ¡ã€‚é‡çƒéƒ¨ã®æˆç¸¾ã‚‚å®‰å®šçš„ã«åˆæˆ¦ã¯çªç ´ã™ã‚‹ã‚‚ã®ã®ä¸Šä½ã«ã¯ã„ã¾ã„ã¡é£Ÿã„è¾¼ã‚ãªã„ã§ã„ã‚‹ã€‚ãã‚ãã‚è¦šé†’ã«æœŸå¾…ã—ãŸã„ã€‚" },
            "è±Šä¸­å­¸åœ’": { name_yomi: "ã¨ã‚ˆãªã‹ãŒããˆã‚“", type: "ç§ç«‹", deviation: 60, best: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ4", last: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ16", info: "ãƒ€ãƒ¼ã‚¯ãƒ›ãƒ¼ã‚¹ã€‚å¼·ã„é«˜æ ¡ã«ã¯ã‚ã£ã½ã†å¼·ãã€äºŒå¤§å…¬ç«‹ã‚„ãƒŠãƒ ã‚³ã‚°ãƒ«ãƒ¼ãƒ—ç³»åˆ—ã®é«˜æ ¡ã«ã¯ç›¸æ€§ãŒã„ã„ãŒã€æ™®é€šã®å…¬ç«‹ä¸­å …æ ¡ã®è©¦åˆã§ã¯ç«¶ã‚Šè² ã‘ã¦ã—ã¾ã†æ®‹å¿µãªãƒãƒ¼ãƒ ã€‚å®ŸåŠ›ã¯ç¢ºã‹ãªã®ã§ã€ã‚¸ãƒ³ã‚¯ã‚¹ã‚’è§£æ¶ˆã—ãŸã„ã€‚" },
            "é ˆç£¨æ±": { name_yomi: "ã™ã¾ã²ãŒã—", type: "ç§ç«‹", deviation: 61, best: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ8", last: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ16", info: "4å¹´å‰ã¯ã¯æº–å„ªå‹ã—ãŸã‚‚ã®ã®ã€ã“ã“æœ€è¿‘ã§ã¯ãƒ™ã‚¹ãƒˆ16æ­¢ã¾ã‚ŠãŒç¶šãã€‚" },
            "283å­¦åœ’B": { name_yomi: "ã¤ã°ã•ãŒããˆã‚“B", type: "ç§ç«‹", deviation: 59, best: "ãªã—", last: "ãªã—", info: "æ˜¨å¹´ã®å„ªå‹ã«ã‚ˆã‚Šéƒ¨å“¡æ•°ãŒæ€¥æ¿€ã«å¢—åŠ ã—ãŸ283å­¦åœ’ã€‚ã‚ã¾ã‚Šã«ã‚‚è©¦åˆã«å‡ºã‚Œãªã„äººæ•°ãŒå¤šã„ã®ã§ç†äº‹é•·ã®é…æ…®ã§bãƒãƒ¼ãƒ ã‚’ä½œã£ãŸã€‚åŸºæœ¬çš„ã«æœ¬éƒ¨æ ¡ã§ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼ã«ãªã‚Œãªã‹ã£ãŸã‚‚ã®ãŸã¡ã®å¯„ã›é›†ã‚ãªã®ã§å‹ã¡ä¸ŠãŒã‚Œãªã„ãŒã€éƒ¨å“¡ãŸã¡ã¯æ‰“å€’283å­¦åœ’ã‚’ç›®æŒ‡ã—é ‘å¼µã£ã¦ã„ã‚‹ã€‚çœŒå†…ã‹ã‚‰ã¯åŒã˜çœŒå†…ã«åŒã˜é«˜æ ¡ã®ãƒãƒ¼ãƒ ã®äºŒã¤ç›®ã‚’ä½œã‚Šå¤§ä¼šã«å‚åŠ ã•ã›ã‚‹ã®ã¯é•åè¡Œç‚ºãªã®ã§ã¯ã€ã¨ã„ã†å£°ãŒå¤šãä¸ŠãŒã£ãŸãŒã€çœŒå†…ã¯ãƒŠãƒ ã‚³ã‚°ãƒ«ãƒ¼ãƒ—ãŒç‰›è€³ã£ã¦ã„ã‚‹ãŸã‚ã€ã”ã‚ŠæŠ¼ã—ã§å¯æ±ºã•ã›ãŸã€‚" },
            "åŸå ´ç¾…": { name_yomi: "ã˜ã‚‡ã†ã°ã‚‰", type: "ç§ç«‹", deviation: 43, best: "çœŒå¤§ä¼š2å›æˆ¦", last: "çœŒå¤§ä¼š2å›æˆ¦", info: "å»å¹´å…±å­¦ã«ãªã£ãŸã€‚é‡çƒéƒ¨ã‚‚å­¦æ ¡å´ãŒç››ã‚Šä¸Šã’ã‚ˆã†ã¨ã€å¥³å­ç‡ã‚’æ´»ã‹ã—ãŸå¤§è¦æ¨¡å¹å¥æ¥½å¿œæ´ã§çƒå ´ã®é›°å›²æ°—ã‚’ä½œã‚‹ã€‚" },
            "å¥³å­å¤§å…±ç«‹": { name_yomi: "ã˜ã‚‡ã—ã ã„ãã‚‡ã†ã‚Šã¤", type: "ç§ç«‹", deviation: 63, best: "çœŒå¤§ä¼š2å›æˆ¦", last: "çœŒå¤§ä¼š2å›æˆ¦", info: "å…ƒå¥³å­é«˜ã€‚é‡çƒéƒ¨å“¡ã‚ˆã‚Šã‚‚ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®æ•°ã®æ–¹ãŒå¤šã„ã€‚" },
            "å¤©ä¸‹ç„¡åŒå­¦åœ’": { name_yomi: "ã¦ã‚“ã‹ã‚€ãã†", type: "ç§ç«‹", deviation: 55, best: "çœŒæº–å„ªå‹", last: "çœŒæº–å„ªå‹", info: "æ‰“æ’ƒã“ãé‡çƒã€‚ãŒãƒ¢ãƒƒãƒˆãƒ¼ã®æ‰“æ’ƒå‹ãƒãƒ¼ãƒ ã€‚ä¸­å …æ ¡ä»¥ä¸‹ã«ã¯ã‚ã£ã½ã†å¼·ã„ãŒã€ç”²å­åœ’å‡ºå ´ãƒ¬ãƒ™ãƒ«ã®ç›¸æ‰‹ã«ã¯ã‚ã£ã½ã†å¼±ã„ã€‚" },
            "æ¨ªæµœ": { name_yomi: "ã‚ˆã“ã¯ã¾", type: "å…¬ç«‹", deviation: 62, best: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ16", last: "çœŒå¤§ä¼š2å›æˆ¦", info: "å…¬ç«‹ã§ã¯ã‚ã‚‹ã‚‚ã®ã®ã€ãƒ—ãƒ­é‡çƒé¸æ‰‹ã®OBã‹ã‚‰ã®æ”¯æ´ã«ã‚ˆã‚Šè¨­å‚™ã¯å……å®Ÿã€‚ãã®å½±éŸ¿ã‹ã€è¿‘å¹´å°‘ã—ãšã¤åŠ›ã‚’ã¤ã‘ã¦ã„ã‚‹ã€‚" },
            "ã‚ã‹ã¤ãå¤§ä»˜å±": { name_yomi: "ã‚ã‹ã¤ãã ã„ãµãã", type: "ç§ç«‹", deviation: 60, best: "ç”²å­åœ’æº–å„ªå‹", last: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ8", info: "ç”²å­åœ’ã‚’ç‹™ã†é‡çƒäºŒç•ªæ‰‹æ ¡ã€‚å­¦æ ¡ã«é›†ã¾ã£ã¦ãã‚‹ã®ã¯ä»–æ ¡ã§ã‚»ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«è½ã¡ãŸã‚‚ã®ã®é›†ã¾ã‚Šã§ã‚ã‚‹ã€‚" },
            "ã¨ãã‚ãé’æ˜¥": { name_yomi: "ã¨ãã‚ãã›ã„ã—ã‚…ã‚“", type: "ç§ç«‹", deviation: 57, best: "ç”²å­åœ’å‡ºå ´", last: "çœŒå¤§ä¼š2å›æˆ¦", info: "ä¸­å …æ ¡ã€‚ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªåå‰ã¨ã¯è£è…¹ã«ä¾®ã‚Œãªã„å®ŸåŠ›ã‚’æŒã¤ã€‚" },
            "å¹²é°¯å¤§ä»˜å±": { name_yomi: "ã²ã‚ã—ã ã„ãµãã", type: "ç§ç«‹", deviation: 49, best: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ16", last: "çœŒå¤§ä¼š2å›æˆ¦", info: "ä¸­å …æ ¡ã€‚é‡çƒéƒ¨ã¨ã—ã¦ã®å®Ÿç¸¾ã¯ãªã„ãŒã€å¤§å­¦ä»˜å±æ ¡ã®ãŸã‚ã€ãã‚Œãªã‚Šã®ãƒ¡ãƒ³ãƒãƒ¼ãŒé›†ã¾ã‚‹ãŸã‚ã€ãã“ãã“ã®æˆ¦åŠ›ã«ãªã‚‹ã€‚" },
            "AOHARUå­¦é™¢": { name_yomi: "ã‚¢ã‚ªãƒãƒ«ãŒãã„ã‚“", type: "ç§ç«‹", deviation: 54, best: "ç”²å­åœ’ãƒ™ã‚¹ãƒˆ8", last: "çœŒå¤§ä¼š2å›æˆ¦", info: "ä¸­å …æ ¡ã€‚13å¹´å‰ã«ã¯ç”²å­åœ’å‡ºå ´çµŒé¨“ã‚‚ã‚ã‚‹ç§ç«‹æ ¡ã€‚ä»Šã§ã¯å½“æ™‚ã®ã‚¨ãƒ¼ã‚¹ã ã£ãŸé’è‘‰å¥å¸ãŒç›£ç£ã¨ãªã‚Šã€æ¯æ ¡ã‚’å†ã³è–åœ°ã¸ã¨å°ã“ã†ã¨ã—ã¦ã„ã‚‹ã€‚" },
            "å ´é ˆå‰ç¬¬ä¸€": { name_yomi: "ã°ã™ã¾ãˆã ã„ã„ã¡", type: "å…¬ç«‹", deviation: 53, best: "çœŒå¤§ä¼š2å›æˆ¦", last: "åˆæˆ¦æ•—é€€", info: "é‡çƒéƒ¨ã¨ã—ã¦ã®ç‰¹è‰²ã¯ãªã„ãŒã€å­¦æ ¡ã¨ã—ã¦ã¯ãã®æ ¡åã«ã¡ãªã‚“ã§ã€ãƒã‚¹ã®é‹è»¢æ‰‹ã«ãªã‚‹ãŸã‚ã®ã‚³ãƒ¼ã‚¹ãŒè¨­ã‘ã‚‰ã‚Œã¦ã„ã‚‹ã€‚" },
            "åŒ—æ–—": { name_yomi: "ã»ãã¨", type: "å…¬ç«‹", deviation: 58, best: "ç”²å­åœ’ãƒ™ã‚¹ãƒˆ16", last: "åˆæˆ¦æ•—é€€", info: "30å¹´å‰ã«ã¯ç”²å­åœ’çµŒé¨“ã‚‚ã‚ã‚‹ã€‚ä»Šã§ã¯ç§ç«‹å„ªå‹¢ã«ãªã‚Šã€é³´ã‚Šã‚’æ½œã‚ãŸãŒã€ã‚‚ã†ä¸€åº¦è¼ã„ã¦ã»ã—ã„ã€ã¨åœ°å…ƒä½æ°‘ã‹ã‚‰ã®æœŸå¾…ã¯é«˜ã„ã€‚" },
            "èµ¤éœ§å¤§é‚£è¦‡": { name_yomi: "ã‚ã‹ãã‚Šã ã„ãªã¯", type: "ç§ç«‹", deviation: 51, best: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ8", last: "çœŒå¤§ä¼š2å›æˆ¦", info: "ä¸­å …æ ¡ã€‚ã‚»ã‚¤ãƒãƒ¼ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’åˆ©ç”¨ã—ãŸåŠ¹ç‡çš„ãªé‡çƒã§å‹åˆ©ã‚’ç‹™ã†ã€‚" },
            "æ¥µæ˜Ÿå­¦åœ’": { name_yomi: "ãã‚‡ãã›ã„ãŒããˆã‚“", type: "ç§ç«‹", deviation: 49, best: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ4", last: "çœŒå¤§ä¼š2å›æˆ¦", info: "ä¸­å …æ ¡ã€‚çœŒå†…ã«è”“å»¶ã‚‹ãƒŠãƒ ã‚³ã‚°ãƒ«ãƒ¼ãƒ—ã«å¯¾æŠ—ã—ã¦ã€æ¥µã‚°ãƒ«ãƒ¼ãƒ—ãŒè¨­ç«‹ã—ãŸæ¥µæ˜Ÿå­¦åœ’ã€‚5å¹´å‰ã«ã¯ãƒ™ã‚¹ãƒˆ4ã¾ã§é€²å‡ºã™ã‚‹å¿«é€²æ’ƒã‚’è¦‹ã›ãŸä¾®ã‚Œãªã„ãƒãƒ¼ãƒ ã§ã‚ã‚‹ã€‚" },
            "çœŒç«‹ç”±æš‡": { name_yomi: "ã‘ã‚“ã‚Šã¤ã‚†ã‹", type: "å…¬ç«‹", deviation: 48, best: "çœŒå¤§ä¼šåˆæˆ¦æ•—é€€", last: "åˆæˆ¦æ•—é€€", info: "æ™®é€šã®å…¬ç«‹ã€‚å…¬å¼æˆ¦ã§å‹ã£ãŸã“ã¨ãŒãªã„ã€‚" },
            "è¶³åˆ©": { name_yomi: "ã‚ã—ã‹ãŒ", type: "å…¬ç«‹", deviation: 52, best: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ16", last: "åˆæˆ¦æ•—é€€", info: "çœŒåç‰©ã€Œè¶³åˆ©å±±ã€ã®ãµã‚‚ã¨ã«ä½ç½®ã™ã‚‹é«˜æ ¡ã€‚ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã§ã¯è¶³åˆ©å±±ã‚’åˆ©ç”¨ã—ãŸãƒãƒ©ã‚½ãƒ³ã‚’ã™ã‚‹ã€‚" },
            "å¸¸ç¿”å­¦åœ’": { name_yomi: "ã˜ã‚‡ã†ã—ã‚‡ã†ãŒããˆã‚“", type: "ç§ç«‹", deviation: 61, best: "ç”²å­åœ’å‡ºå ´", last: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ16", info: "ä¸­å …æ ¡ã€‚è¨­ç«‹ã—ã¦19å¹´ã¨æœˆæ—¥ã¯æµ…ã„ãŒã€ç”²å­åœ’çµŒé¨“ã®ã‚ã‚‹å®ŸåŠ›æ ¡ã€‚ä»Šå¹´ã¯ã€éå»ã«å¸ç‹å®Ÿæ¥­ã§ç”²å­åœ’é€£è¦‡ã—ãŸéš›ã®ãƒãƒ¼ãƒ ã®æŒ‡æ®ã‚’åŸ·ã£ã¦ã„ãŸåœ‹æ‘ç›£ç£ã‚’æ‹›è˜ã—ã€èºé€²ãŒæœŸå¾…ã•ã‚Œã‚‹ã€‚" },
            "éŸ³é§’": { name_yomi: "ã­ã“ã¾", type: "å…¬ç«‹", deviation: 62, best: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ16", last: "åˆæˆ¦æ•—é€€", info: "æ ¡åé€šã‚Šã€å¹å¥æ¥½éƒ¨ãŒå£²ã‚Šã®å…¬ç«‹æ ¡ã€‚" },
            "ä¸ƒæ£®": { name_yomi: "ãªãªã‚‚ã‚Š", type: "å…¬ç«‹", deviation: 55, best: "çœŒå¤§ä¼š2å›æˆ¦", last: "åˆæˆ¦æ•—é€€", info: "è‡ªç”±ä¸»ç¾©ãŒæ ¡è¨“ã®å…¬ç«‹æ ¡ã€‚å¸¸è­˜ã«ã¨ã‚‰ã‚ã‚Œãªã„ç™ºæƒ³ã¯ã€é‡çƒã®ã©ã†å½±éŸ¿ã‚’åŠã¼ã™ã®ã ã‚ã†ã‹ã€‚" },
            "ç æ¹–": { name_yomi: "ãŸã¾ã“", type: "å…¬ç«‹", deviation: 50, best: "çœŒå¤§ä¼šåˆæˆ¦æ•—é€€", last: "åˆæˆ¦æ•—é€€", info: "æ¹–ã®è¿‘ãã«ä½ç½®ã™ã‚‹å°è¦æ¨¡ã®å­¦æ ¡ã€‚å…¬å¼æˆ¦ã§å‹ã£ãŸã“ã¨ãŒãªã„ã€‚" },
            "æ½®è¦‹": { name_yomi: "ã—ãŠã¿", type: "å…¬ç«‹", deviation: 57, best: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ8", last: "åˆæˆ¦æ•—é€€", info: "ãŸã¾ã«ä¸­ç›¤ã¾ã§å‹ã¡é€²ã‚€ãŒåŸºæœ¬çš„ã«ã¯ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆåºç›¤ã§ã®æ•—é€€ãŒå¤šã„ã€‚" },
            "å¸‚ç«‹æ ¹æˆ¸": { name_yomi: "ã—ã‚Šã¤ã­ã©", type: "å…¬ç«‹", deviation: 46, best: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ16", last: "åˆæˆ¦æ•—é€€", info: "70å¹´ã®æ­´å²ã‚’ã‚‚ã¤ä¼çµ±æ ¡ã€‚é‡çƒéƒ¨ãŒç››ã‚Šä¸ŠãŒã‚Œã°ã€åœ°åŸŸã‚‚ç››ã‚Šä¸ŠãŒã‚‹ã ã‚ã†ã€‚" },
            "ç¦äº•": { name_yomi: "ãµãã„", type: "å…¬ç«‹", deviation: 53, best: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ16", last: "åˆæˆ¦æ•—é€€", info: "ãƒãƒ©ãƒ³ã‚¹ã®è‰¯ã„å…¬ç«‹æ ¡ã€‚æ¯å¹´ãã‚Œãªã‚Šã®ãƒãƒ¼ãƒ ã«ä»•ä¸Šã’ã¦ãã¦ã„ã‚‹ãŒã€ç±¤é‹ãŒæ‚ªãã€å¼·è±ªç§ç«‹ã«è½¢ã‹ã‚Œã¦ã„ã‚‹ã€‚" },
            "æ˜¥æ—¥äº•ä¸­å¤®": { name_yomi: "ã‹ã™ãŒã„ã¡ã‚…ã†ãŠã†", type: "å…¬ç«‹", deviation: 59, best: "çœŒå¤§ä¼šãƒ™ã‚¹ãƒˆ4", last: "åˆæˆ¦æ•—é€€", info: "éå»ã«ã¯ãƒ™ã‚¹ãƒˆ4ã®çµŒé¨“ã‚‚ã‚ã‚‹å…¬ç«‹æ ¡ã€‚" },
            "é«˜æ§»å—": { name_yomi: "ãŸã‹ã¤ãã¿ãªã¿", type: "å…¬ç«‹", deviation: 56, best: "çœŒå¤§ä¼š2å›æˆ¦", last: "åˆæˆ¦æ•—é€€", info: "ä»Šå¹´å­¦æ ¡ã‚’æ”¹ç¯‰ã—ã€æ–°æ ¡èˆã¨ãªã£ãŸã†ãˆã§è¿ãˆã‚‹åˆã‚ã¦ã®å¤ã€é‡çƒéƒ¨ãŒç››ã‚Šä¸ŠãŒã‚Œã°å­¦æ ¡ã¨ã—ã¦ã®äººæ°—ã‚‚çˆ†ç™ºçš„ã«ä¼¸ã³ã‚‹ã®ã§ã¯ãªã„ã ã‚ã†ã‹ã€‚" },
            "å³¶ç”°": { name_yomi: "ã—ã¾ã ", type: "å…¬ç«‹", deviation: 53, best: "çœŒå¤§ä¼š2å›æˆ¦", last: "åˆæˆ¦æ•—é€€", info: "å¤§æ­£8å¹´ã‹ã‚‰ã‚ã‚‹å¤ã„å­¦æ ¡ã ãŒã€é‡çƒéƒ¨ã®å®Ÿç¸¾ã¯ä¹ã—ã„ã€‚ä»¥å‰ã¯éƒ¨å“¡æ•°ãŒè¶³ã‚Šãªã„éš›ã«ã¯ä¼Šè±†ä¸­å¤®ã¨é€£åˆãƒãƒ¼ãƒ ã‚’çµ„ã‚“ã§ã„ãŸã€‚" },
            "ä¼Šè±†ä¸­å¤®": { name_yomi: "ã„ãšã¡ã‚…ã†ãŠã†", type: "å…¬ç«‹", deviation: 51, best: "çœŒå¤§ä¼š2å›æˆ¦", last: "åˆæˆ¦æ•—é€€", info: "ä»Šå¹´ã¯ä¹…ã—ã¶ã‚Šã«ãƒ¡ãƒ³ãƒãƒ¼ãŒãã‚ã„ã€å˜ç‹¬ãƒãƒ¼ãƒ ã§ã®å‡ºå ´ã¨ãªã£ãŸã€‚ä»¥å‰ã¯éƒ¨å“¡æ•°ãŒè¶³ã‚Šãªã„éš›ã«ã¯å³¶ç”°ã¨é€£åˆãƒãƒ¼ãƒ ã‚’çµ„ã‚“ã§ã„ãŸã€‚" }
        };
        const DETAILED_TEAM_DATA = {
            "283å­¦åœ’": {
                summary: "å¤ã®é€£è¦‡ã®å…ˆã«ã€è–åœ°ã§ã®å‹åˆ©ã‚’ç›®æŒ‡ã™ã€‚æ˜¨å¹´ç‹è€…ã€å®ˆå‚™ã®ä¸€ä½“æ„Ÿã¨æ‰“ç·šã®ã¤ãªãŒã‚Šã‚’å¼·ã¿ã«ã€è©¦åˆã”ã¨ã«æˆé•·ã€‚ãƒãƒ¼ãƒ ã‚¹ãƒ­ãƒ¼ã‚¬ãƒ³ã¯ã€å¼·ã€ã€‚å€‹ã®æŠ€é‡ã«é ¼ã‚‰ãšã€ä¸€äººã²ã¨ã‚Šã®åŠ›ã‚’é›†ã‚ã¦æˆ¦ã†ã€‚",
                players: [
                    { name: "å§«å·å‹ç´€", year: 3, position: "ãƒ”ãƒƒãƒãƒ£ãƒ¼", desc: "æŠ•æ‰“ã®ä¸­å¿ƒã€‚MAX151kmã®ç›´çƒã¨ã‚¹ãƒ—ãƒªãƒƒãƒˆã€é«˜æ ¡é€šç®—42æœ¬å¡æ‰“ã®æ€ªç‰©ã€‚" },
                    { name: "èŠ±æµ·é›„ä»‹", year: 3, position: "ã‚»ãƒ³ã‚¿ãƒ¼", desc: "èµ°æ”»å®ˆä¸‰æ‹å­æƒã£ãŸãƒªãƒ¼ãƒ‰ã‚ªãƒ•ãƒãƒ³ã€‚ç›£ç£ãŒã€Œã‚‚ã®ãŒé•ã†ã€ã¨çµ¶è³›ã€‚" },
                    { name: "éˆ´æœ¨ä½å¥ˆ", year: 2, position: "ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ", desc: "èŠ¯ã§æ‰ãˆã‚‹æŠ€è¡“ã‚’æŒã¤3ç•ªæ‰“è€…ã€‚å®ˆå‚™ã§ã‚‚å­˜åœ¨æ„Ÿã€‚" },
                    { name: "åç‹æ˜Ÿå—", year: 3, position: "ã‚·ãƒ§ãƒ¼ãƒˆ", desc: "é‰„å£ã®å®ˆå‚™ã‚’èª‡ã‚‹åæ‰‹ã€‚ãƒãƒ£ãƒ³ã‚¹ãƒ¡ã‚¤ã‚¯ã‚‚å¾—æ„ãª2ç•ªæ‰“è€…ã€‚" },
                    { name: "æµ…å€‰äº«", year: 2, position: "ãƒ¬ãƒ•ãƒˆ", desc: "2å¹´ç”ŸãªãŒã‚‰5ç•ªã«åº§ã‚‹ã‚¯ãƒ©ãƒƒãƒãƒ’ãƒƒã‚¿ãƒ¼ã€‚ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ãŒé«˜ã„ã€‚" },
                    { name: "å³¶æ‘æµ·æ–—", year: 3, position: "ã‚µãƒ¼ãƒ‰", desc: "å¼·è‚©å¼·æ‰“ã®ãƒ‘ãƒ¯ãƒ¼ãƒ’ãƒƒã‚¿ãƒ¼ã€‚å‹è² å¼·ã„æ‰“æ’ƒãŒå…‰ã‚‹ã€‚" },
                    { name: "æœ‰æ –å·æ‚ è¦‡", year: 3, position: "ã‚­ãƒ£ãƒƒãƒãƒ£ãƒ¼", desc: "å¤§èˆå°ã«å¼·ã„ä¸»è»¸ã€‚å¤‰åŒ–çƒæ‰“ã¡ã®æŠ€è¡“ã¯ãƒãƒ¼ãƒ ãƒˆãƒƒãƒ—ã‚¯ãƒ©ã‚¹ã€‚" },
                    { name: "èŠ¹æ²¢å„ªå¾", year: 2, position: "ã‚»ã‚«ãƒ³ãƒ‰", desc: "å°æŠ€ã¨å®ˆå‚™ã‚»ãƒ³ã‚¹ãŒå…‰ã‚‹äºŒå¡æ‰‹ã€‚ãƒãƒ£ãƒ³ã‚¹ã§ã®ä¸€æ‰“ã‚‚ã€‚" },
                    { name: "èŠ±æµ·ä½‘æ¨¹", year: 1, position: "ãƒ©ã‚¤ãƒˆ", desc: "1å¹´ç”Ÿã®ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚¹ã‚¿ãƒ¼ã€‚å…„ãƒ»é›„ä»‹ã¨ã®é€£æºã‚‚æŠœç¾¤ã€‚æ—¢ã«é€šç®—13æœ¬å¡æ‰“ã€‚" },
                    { name: "å¤©æµ·æ™´å½¦", year: 2, position: "ãƒ”ãƒƒãƒãƒ£ãƒ¼", desc: "ãƒãƒ¼ãƒ æœ€é€Ÿã®ç›´çƒã‚’æŒã¤ã€‚æ˜¥ã¯ãƒ¡ãƒ³ãƒãƒ¼å¤–ã®æ‚”ã—ã•ã‚’ãƒãƒã«å¾©èª¿ã‚’ç›®æŒ‡ã™ã€‚" },
                    { name: "æ¾æœ¬æ™´åº·", year: 3, position: "ãƒ”ãƒƒãƒãƒ£ãƒ¼", desc: "æ˜¥ã®å¤§ä¼šã§å®Œå…¨è©¦åˆã‚’é”æˆã€‚ä¼¸ã³ä¸ŠãŒã‚‹ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãŒæ­¦å™¨ã€‚" }
                ]
            },
            "å¤©ä¸‹ç„¡åŒå­¦åœ’": {
                summary: "å€‹ã€…ã®ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ãŒçµå®Ÿã—æ˜¨å¹´ã¯æº–å„ªå‹ã€‚å€‹äººæˆç¸¾ã®å¯è¦–åŒ–ã¨å®ŸåŠ›ä¸»ç¾©ã§ãƒãƒ¼ãƒ å†…ã®ç«¶äº‰ã‚’æ´»æ€§åŒ–ã•ã›ã€åˆã®ç”²å­åœ’ã‚’ç›®æŒ‡ã™ã€‚ã‚¹ãƒ­ãƒ¼ã‚¬ãƒ³ã¯ã€å€‹ã€…ã®èƒ½åŠ›é‡è¦–ã€ã€‚",
                players: [
                    { name: "æ²–ç”°ç·å¸", year: 3, position: "ãƒ”ãƒƒãƒãƒ£ãƒ¼", desc: "æŠ•æ‰“ã®å¤§é»’æŸ±ã€‚MAX157kmã®é€Ÿçƒã‚’æŒã¤ä¸»ç ²ã€‚" },
                    { name: "åœŸæ–¹ä»»ä¸‰éƒ", year: 3, position: "ã‚­ãƒ£ãƒƒãƒãƒ£ãƒ¼", desc: "ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ä¸Šã®ç›£ç£ã€‚é«˜ã„ã‚¹ãƒ­ãƒ¼ã‚¤ãƒ³ã‚°æŠ€è¡“ã¨é«˜æ ¡é€šç®—28æœ¬å¡æ‰“ã®ãƒ‘ãƒ¯ãƒ¼ã‚’æŒã¤ã€‚" },
                    { name: "å®®æœ¬å’Œä½", year: 3, position: "ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ", desc: "åŠ›å¼·ã„æ‰“æ’ƒã¨å‹è² å¼·ã•ãŒé­…åŠ›ã®3ç•ªæ‰“è€…ã€‚" },
                    { name: "æŸ³ç”Ÿä¿Šæ˜Œ", year: 2, position: "ã‚»ã‚«ãƒ³ãƒ‰", desc: "ãƒãƒƒãƒ†ã‚£ãƒ³ã‚°ã‚»ãƒ³ã‚¹ã«å„ªã‚Œã‚‹2å¹´ç”Ÿã€‚è½ã¡ç€ã„ãŸãƒ—ãƒ¬ãƒ¼ãŒå…‰ã‚‹ã€‚" },
                    { name: "è¿‘è—¤æ˜¥æ¨¹", year: 3, position: "ã‚µãƒ¼ãƒ‰", desc: "ã‚¬ãƒƒãƒ„ã‚ãµã‚Œã‚‹ãƒ—ãƒ¬ãƒ¼ã§ãƒãƒ¼ãƒ ã‚’å¼•ã£å¼µã‚‹5ç•ªæ‰“è€…ã€‚é«˜æ ¡é€šç®—46æœ¬å¡æ‰“ã€‚" },
                    { name: "å‚æœ¬ä¿Šæ¨¹", year: 3, position: "ã‚·ãƒ§ãƒ¼ãƒˆ", desc: "èµ°æ”»å®ˆä¸‰æ‹å­æƒã£ãŸæŠœç¾¤ã®èº«ä½“èƒ½åŠ›ã‚’æŒã¤ã‚·ãƒ§ãƒ¼ãƒˆã€‚" },
                    { name: "å²¡ç”°å…‹ä¹Ÿ", year: 3, position: "ãƒ©ã‚¤ãƒˆ", desc: "é«˜æ ¡é€šç®—71æœ¬å¡æ‰“ã‚’èª‡ã‚‹çµ¶å¯¾çš„ãª4ç•ªã€‚æµã¾ã‚ŒãŸä½“æ ¼ã‹ã‚‰ã®å¼·æ‰“ãŒæ­¦å™¨ã€‚" },
                    { name: "æ£®æ™´ç¶™", year: 2, position: "ã‚»ãƒ³ã‚¿ãƒ¼", desc: "50m6ç§’ãƒ•ãƒ©ãƒƒãƒˆã®ä¿Šè¶³ã€‚æ”»å®ˆã«ã‚ãŸã‚ŠæŠœç¾¤ã®å‹è² å¼·ã•ã‚’è¦‹ã›ã‚‹ã€‚" },
                    { name: "ä¸Šæ³‰èª ", year: 3, position: "ãƒ¬ãƒ•ãƒˆ", desc: "ãƒãƒ©ãƒ³ã‚¹ã¨å‹è² å¼·ã„æ‰“æ’ƒãŒæ­¦å™¨ã€‚é€†è»¢åŠ‡ã®ãã£ã‹ã‘ã‚’ä½œã‚‹ã€‚" },
                    { name: "æ‹æ‹“ä¹Ÿ", year: 3, position: "ãƒ”ãƒƒãƒãƒ£ãƒ¼", desc: "å·§ã¿ãªæŠ•çƒè¡“ã¨å¼·ã„ç²¾ç¥åŠ›ã‚’æŒã¤æ§ãˆæŠ•æ‰‹ã€‚MAX155kmã€‚" },
                    { name: "ç–‹ç”°æ–‡ä¹Ÿ", year: 2, position: "ãƒ”ãƒƒãƒãƒ£ãƒ¼", desc: "ã‚¯ãƒ¬ãƒãƒ¼ã•ã¨å¼·æ°—ã‚’å…¼ã­å‚™ãˆãŸ2å¹´ç”ŸæŠ•æ‰‹ã€‚æ˜¨å¤ã‚‚ç™»æ¿çµŒé¨“ã‚ã‚Šã€‚" }
                ]
            },
            "é›·é–€å—": {
                summary: "æ˜¨å¹´ãƒ™ã‚¹ãƒˆ4ã€‚é¸æ‰‹ã®é•·æ‰€ã‚’æ´»ã‹ã™é‡çƒã§ã€ç£¨ãä¸Šã’ãŸå®ˆå‚™åŠ›ã¨ã‚¿ã‚¤ãƒ—ã®é•ã†3å¹´ç”ŸæŠ•æ‰‹3äººã®ç¶™æŠ•ã‚’æ­¦å™¨ã«ã€2005å¹´ä»¥æ¥ã®å¤ã®è–åœ°ã‚’ç›®æŒ‡ã™ã€‚",
                players: [
                    { name: "è±ªå††ç§€ä¸€", year: 3, position: "ãƒ”ãƒƒãƒãƒ£ãƒ¼", desc: "æœ€é€Ÿ158kmã®ç›´çƒã¨ç¸¦ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§æ‰“è€…ã‚’æ‰“ã¡å–ã‚‹çµ¶å¯¾çš„ã‚¨ãƒ¼ã‚¹ã€‚" },
                    { name: "é è—¤æ†²ä½œ", year: 3, position: "ã‚­ãƒ£ãƒƒãƒãƒ£ãƒ¼", desc: "å†·é™ãªãƒªãƒ¼ãƒ‰ã§å¤šå½©ãªæŠ•æ‰‹é™£ã‚’å¼•ã£å¼µã‚‹æ‰‡ã®è¦ã€‚3ç•ªæ‰“è€…ã¨ã—ã¦ã‚‚æ´»èºã€‚" },
                    { name: "é¢¨å±±è‹±äºŒéƒ", year: 3, position: "ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ", desc: "190cmã®é•·èº«ã‚’ç”Ÿã‹ã—ãŸå®ˆå‚™ã¨é•·æ‰“åŠ›ãŒé­…åŠ›ã€‚" },
                    { name: "é£¯ç”°æ…äºŒ", year: 3, position: "ã‚»ã‚«ãƒ³ãƒ‰", desc: "å°æŸ„ãªãŒã‚‰æ”»å®ˆã«å …å®Ÿãªãƒ—ãƒ¬ãƒ¼ã§ãƒãƒ¼ãƒ ã«è²¢çŒ®ã€‚" },
                    { name: "ä¸€ãƒç€¬æ‹“éƒ", year: 3, position: "ã‚µãƒ¼ãƒ‰", desc: "ãƒãƒ¼ãƒ ä¸€ã®æ‰“çƒã®é€Ÿã•ã‚’èª‡ã‚‹2ç•ªæ‰“è€…ã€‚" },
                    { name: "åœŸé–€æµ·æ–—", year: 3, position: "ã‚·ãƒ§ãƒ¼ãƒˆ", desc: "ãƒŸã‚¹ã®å°‘ãªã„å …å®Ÿãªå®ˆå‚™ã§è©¦åˆã®ãƒªã‚ºãƒ ã‚’ä½œã‚‹å†…é‡ã®è¦ã€‚" },
                    { name: "å¤–å²¡ç«œå¾", year: 3, position: "ãƒ¬ãƒ•ãƒˆ", desc: "ç›£ç£ã‚‚çµ¶å¤§ãªä¿¡é ¼ã‚’å¯„ã›ã‚‹å¤§ç ²ã€‚æ°—æŒã¡ã®å¼·ã•ã‚‚é­…åŠ›ã€‚" },
                    { name: "èŠ±ä¸¸ä¸€éƒ", year: 3, position: "ã‚»ãƒ³ã‚¿ãƒ¼", desc: "ã‚µã‚¤ã‚¯ãƒ«ãƒ’ãƒƒãƒˆé”æˆçµŒé¨“ã‚‚ã‚ã‚‹ãƒªãƒ¼ãƒ‰ã‚ªãƒ•ãƒãƒ³ã€‚ãƒŸãƒ¼ãƒˆåŠ›ãŒæ ¼æ®µã«ã‚¢ãƒƒãƒ—ã€‚" },
                    { name: "ä¹…æ¾é‰„å¹³", year: 2, position: "ãƒ©ã‚¤ãƒˆ", desc: "åŠ›å¼·ã„ã‚¹ã‚¤ãƒ³ã‚°ã‹ã‚‰æ”¾ãŸã‚Œã‚‹é•·æ‰“ãŒé­…åŠ›ã®2å¹´ç”Ÿã€‚" },
                    { name: "æœ¨é ­å„ªæ–—", year: 3, position: "ãƒ”ãƒƒãƒãƒ£ãƒ¼", desc: "ã‚­ãƒ¬ã®ã‚ã‚‹ç¸¦ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã¨å†…è§’ã¸ã®ç›´çƒãŒé­…åŠ›ã®å³è…•ã€‚" },
                    { name: "æ¾é‡è£•ä»‹", year: 2, position: "ãƒ”ãƒƒãƒãƒ£ãƒ¼", desc: "MAX144kmã®ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆã¨ã‚«ãƒƒãƒˆãƒœãƒ¼ãƒ«ãŒæ­¦å™¨ã®2å¹´ç”Ÿã€‚å¥ªä¸‰æŒ¯èƒ½åŠ›ãŒé«˜ã„ã€‚" }
                ]
            },
            "ä»£çŸ¢æ±": {
                summary: "æŠ•æ‰“ã®å¤§é»’æŸ±ã‚’ä¸­å¿ƒã«ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ãªãƒ™ãƒ¼ã‚¹ãƒœãƒ¼ãƒ«ã‚’å±•é–‹ã€‚æ”»ã‚ã®å§¿å‹¢ã‚’è²«ãã€1999å¹´ä»¥æ¥ã®è–åœ°ã‚’è¦‹æ®ãˆã‚‹ä¼çµ±æ ¡ã€‚ã©ã“ã‹ã‚‰ã§ã‚‚å¾—ç‚¹ã§ãã‚‹æ‰“ç·šãŒå¼·ã¿ã€‚",
                players: [
                    { name: "æ¸‹è°·å“", year: 3, position: "ãƒ”ãƒƒãƒãƒ£ãƒ¼", desc: "å¸¸æ™‚150kmè¶…ã®é€Ÿçƒã‚’æŠ•ã’ã‚‹æœ¬æ ¼æ´¾ã‚¨ãƒ¼ã‚¹ã€‚" },
                    { name: "ç‰‡é‡å‚æ™´äºº", year: 3, position: "ã‚­ãƒ£ãƒƒãƒãƒ£ãƒ¼", desc: "å°æŸ„ãªãŒã‚‰å¼·è‚©å¼·æ‰“ã®å¸ä»¤å¡”ã€‚ç›—å¡é˜»æ­¢ç‡ã¯éšä¸€ã€‚" },
                    { name: "éƒ·é‡å°†æš‰", year: 3, position: "ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ", desc: "é«˜æ ¡é€šç®—63æœ¬å¡æ‰“ã®ãƒ—ãƒ­æ³¨ç›®ã‚¹ãƒ©ãƒƒã‚¬ãƒ¼ã€‚å¾—ç‚¹åœã§ã®å‹è² å¼·ã•ãŒå…‰ã‚‹ã€‚" },
                    { name: "ç‰‡å€‰éƒå¼¥", year: 3, position: "ã‚»ã‚«ãƒ³ãƒ‰", desc: "ä¿Šè¶³ã¨åºƒã„å®ˆå‚™ç¯„å›²ãŒæ­¦å™¨ã®æ©Ÿå‹•åŠ›å†…é‡æ‰‹ã€‚" },
                    { name: "å³¶æ´¥æˆå“‰", year: 3, position: "ã‚µãƒ¼ãƒ‰", desc: "åå¿œé€Ÿåº¦ã¨å¼·è‚©ãŒæ­¦å™¨ã®å®ˆå‚™ã®è¦ã€‚åºƒè§’ã«æ‰“ã¡åˆ†ã‘ã‚‹æ‰“æ’ƒã‚‚ã€‚" },
                    { name: "è—¤åŸå…ƒè¼", year: 3, position: "ã‚·ãƒ§ãƒ¼ãƒˆ", desc: "è»½å¿«ãªãƒ•ãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŒå…‰ã‚‹å®ˆå‚™è·äººã€‚ã¤ãªãå½¹ã‚‚ã“ãªã™ã€‚" },
                    { name: "å€‰ç§‘å“²å²", year: 3, position: "ãƒ¬ãƒ•ãƒˆ", desc: "å°æŸ„ãªãŒã‚‰é«˜ã„èº«ä½“èƒ½åŠ›ã‚’æŒã¤ã€‚ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã®å‰ã‚’æ‰“ã¤ã€‚" },
                    { name: "æ»å·æ–‡éš†", year: 3, position: "ã‚»ãƒ³ã‚¿ãƒ¼", desc: "æŠœç¾¤ã®èµ°åŠ›ã§ã‚»ãƒ³ã‚¿ãƒ¼ãƒ©ã‚¤ãƒ³ã‚’çµ±ç‡ã™ã‚‹ãƒªãƒ¼ãƒ‰ã‚ªãƒ•ãƒãƒ³ã€‚" },
                    { name: "å·åˆè‰¯å¤ª", year: 3, position: "ãƒ©ã‚¤ãƒˆ", desc: "å®‰å®šã—ãŸæ‰“ç‡ã‚’èª‡ã‚‹å³æ‰“è€…ã€‚æ­£ç¢ºãªè¿”çƒã‚‚é­…åŠ›ã€‚" },
                    { name: "å…­åç”°è‰¯å¼¥", year: 3, position: "ãƒ”ãƒƒãƒãƒ£ãƒ¼", desc: "æœ€é€Ÿ152kmã®å‰›è…•ã€‚ãƒªãƒªãƒ¼ãƒ•ã‚‚å…ˆç™ºã‚‚ã“ãªã™ä¸‡èƒ½å‹ã€‚" },
                    { name: "é³¥ç¾½æ™´åº·", year: 3, position: "ãƒ”ãƒƒãƒãƒ£ãƒ¼", desc: "å·¦è…•ã‹ã‚‰å¤šå½©ãªå¤‰åŒ–çƒã‚’æŠ•ã’ã‚‹ã‚¯ãƒ­ãƒ¼ã‚¶ãƒ¼çš„å­˜åœ¨ã€‚" }
                ]
            },
            "é’é“": {
                summary: "æ˜¨å¹´ãƒ™ã‚¹ãƒˆ8ã€‚é¸æ‰‹ã®é•·æ‰€ã‚’æ´»ã‹ã—ãŸæ”»æ’ƒåŠ›ã¨å …å®ˆã‚’æ­¦å™¨ã«é›ªè¾±ã‚’æœŸã™ã€‚ã‚¿ã‚¤ãƒ—ã®ç•°ãªã‚‹3äººã®æŠ•æ‰‹ã«ã‚ˆã‚‹ç¶™æŠ•ãŒå¼·ã¿ã€‚",
                players: [
                    { name: "æ²¢æ‘æ „ç²", year: 2, position: "ãƒ”ãƒƒãƒãƒ£ãƒ¼", desc: "æœ€é€Ÿ140kmã®ç›´çƒã¨å¤šå½©ãªå¤‰åŒ–çƒã§ä¸‰æŒ¯ã‚’å¥ªã†æ¬¡ä¸–ä»£ã‚¨ãƒ¼ã‚¹å·¦è…•ã€‚" },
                    { name: "é™è°·æš", year: 3, position: "ãƒ”ãƒƒãƒãƒ£ãƒ¼", desc: "é•·èº«ã‹ã‚‰æŠ•ã’ä¸‹ã‚ã™ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã¨ã‚·ãƒ¥ãƒ¼ãƒˆãŒæ­¦å™¨ã®å¤§å‹å³è…•ã€‚" },
                    { name: "å¾¡å¹¸ä¸€ä¹Ÿ", year: 3, position: "ã‚­ãƒ£ãƒƒãƒãƒ£ãƒ¼", desc: "æ”»å®ˆã«ã‚ãŸã‚‹é«˜ã„é‡çƒã‚»ãƒ³ã‚¹ã‚’èª‡ã‚‹ãƒ—ãƒ­æ³¨ç›®ã®å¸ä»¤å¡”ã€‚" },
                    { name: "å‰åœ’è£•å¤ª", year: 2, position: "ä¸€å¡æ‰‹ï¼å¤–é‡æ‰‹", desc: "é«˜ã„æ‰“æ’ƒæŠ€è¡“ã¨å¼·è‚©ã‚’æŒã¤å¤§å‹é‡æ‰‹ã€‚" },
                    { name: "å°æ¹Šå¤æ¨¹", year: 3, position: "äºŒå¡æ‰‹", desc: "å …å®Ÿãªå®ˆå‚™ã¨å·§ã¿ãªãƒãƒƒãƒˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãŒå…‰ã‚‹ã€‚" },
                    { name: "é‡‘æ‘çœŸä¹Ÿ", year: 3, position: "ä¸‰å¡æ‰‹", desc: "æ‰“çƒåå¿œãŒé€Ÿãã€å¼·è‚©ãŒæ­¦å™¨ã€‚ä¸­è·é›¢ãƒ’ãƒƒã‚¿ãƒ¼ã€‚" },
                    { name: "å€‰ç”°å®Ÿ", year: 2, position: "ã‚·ãƒ§ãƒ¼ãƒˆ", desc: "ä¿Šæ•ãªå‹•ãã¨è¯éº—ãªå®ˆå‚™ãŒé­…åŠ›ã®å†…é‡ã®è¦ã€‚" },
                    { name: "çµåŸå¤§ä»‹", year: 3, position: "ãƒ¬ãƒ•ãƒˆ", desc: "é•·æ‰“åŠ›ã‚’æ­¦å™¨ã«å¿«éŸ³ã‚’éŸ¿ã‹ã›ã‚‹å¼·æ‰“è€…ã€‚" },
                    { name: "è¥¿åŸå…‰å¸Œ", year: 3, position: "ã‚»ãƒ³ã‚¿ãƒ¼", desc: "å¼·è‚©ã¨ç¢ºå®Ÿãªæ•çƒã§å¤–é‡ã‚’çµ±ç‡ã™ã‚‹å®ˆå‚™è·äººã€‚" },
                    { name: "ç™½ç€¬æµ©å¸", year: 3, position: "ãƒ©ã‚¤ãƒˆ", desc: "æ‰“æ’ƒã‚»ãƒ³ã‚¹ãŒå…‰ã‚‹å·¦æ‰“è€…ã€‚å†·é™ãªçŠ¶æ³åˆ¤æ–­ãŒæŒã¡å‘³ã€‚" }
                ]
            },
            "æ­¦è”µé‡ç¬¬ä¸€": {
                summary: "é›ªè¾±ã‚’æœŸã™çŸ¥æ€§æ´¾è»å›£ã€‚çµ¶å¯¾çš„ã‚¨ãƒ¼ã‚¹æ¦›åã‚’æ“ã—ã€ãƒ‡ãƒ¼ã‚¿ã‚’é§†ä½¿ã—ãŸç·»å¯†ãªé‡çƒã§æ˜¨å¤ã®æ‚”ã—ã•ã‚’æ™´ã‚‰ã™ã€‚ãƒãƒ¼ãƒ ã‚¹ãƒ­ãƒ¼ã‚¬ãƒ³ã¯ã€çŸ¥ã¯åŠ›ãªã‚Šã€ã€‚",
                players: [
                    { name: "æ¦›å å…ƒå¸Œ", year: 3, position: "ãƒ”ãƒƒãƒãƒ£ãƒ¼", desc: "æœ€é€Ÿ140kmå¾ŒåŠã®ç›´çƒã¨é«˜é€Ÿã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§ä¸‰æŒ¯ã®å±±ã‚’ç¯‰ãçµ¶å¯¾çš„ã‚¨ãƒ¼ã‚¹ã€‚æ‰“ã£ã¦ã‚‚5ç•ªã€‚" },
                    { name: "ç§‹ä¸¸å”å¹³", year: 3, position: "ã‚­ãƒ£ãƒƒãƒãƒ£ãƒ¼", desc: "å†·é™æ²ˆç€ãªãƒªãƒ¼ãƒ‰ã§ã‚¨ãƒ¼ã‚¹æ¦›åã‚’æ”¯ãˆã‚‹æ‰‡ã®è¦ã€‚" },
                    { name: "å¤§å· å…¬å½¦", year: 3, position: "ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ", desc: "ãƒãƒ¼ãƒ ä¸å‹•ã®4ç•ªã€‚ä¸€æŒ¯ã‚Šã§è©¦åˆã®æµã‚Œã‚’å¤‰ãˆã‚‹ãƒ‘ãƒ¯ãƒ¼ãŒé­…åŠ›ã€‚" },
                    { name: "ç¦åŸ æ­ä»‹", year: 3, position: "ã‚·ãƒ§ãƒ¼ãƒˆ", desc: "å“è¶Šã—ãŸãƒãƒƒãƒˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã¨é¸çƒçœ¼ã‚’æŒã¤1ç•ªæ‰“è€…ã€‚å®ˆå‚™ã‚‚å …å®Ÿã€‚" },
                    { name: "ç”ºç”°èª ", year: 3, position: "ã‚»ãƒ³ã‚¿ãƒ¼", desc: "èµ°æ”»å®ˆä¸‰æ‹å­æƒã£ãŸã‚¢ãƒ™ãƒ¬ãƒ¼ã‚¸ãƒ’ãƒƒã‚¿ãƒ¼ã€‚3ç•ªã‚’æ‹…ã†ã€‚" }
                ]
            },
            "ç¨²åŸå®Ÿæ¥­": {
                summary: "ç‹åº§å¥ªé‚„ã¸ã€æºã‚‹ããªãã€ç‹å›½ã€ã®ãƒ—ãƒ©ã‚¤ãƒ‰ã€‚æ˜¨å¹´ã®é›ªè¾±ã«ç‡ƒãˆã‚‹çµ¶å¯¾ç‹è€…ã€‚æŠ•æ‰“ã«ã‚¿ãƒ¬ãƒ³ãƒˆã‚’æƒãˆã€æœ€å¼·å·¦è…•ãƒ»æˆå®®ã‚’è»¸ã«å†ã³å…¨å›½ã®é ‚ç‚¹ã‚’ç›®æŒ‡ã™ã€‚ã‚¹ãƒ­ãƒ¼ã‚¬ãƒ³ã¯ã€å¸¸å‹ã€ã€‚",
                players: [
                    { name: "æˆå®® é³´", year: 3, position: "ãƒ”ãƒƒãƒãƒ£ãƒ¼", desc: "ã€Œã‚­ãƒ³ã‚°ã€ã®ç•°åã‚’æŒã¤ä¸–ä»£æœ€å¼·å·¦è…•ã€‚MAX150km/hã®ç›´çƒã¨é­”çƒãƒã‚§ãƒ³ã‚¸ã‚¢ãƒƒãƒ—ã‚’æ“ã‚‹ã€‚" },
                    { name: "ç¥è°· ã‚«ãƒ«ãƒ­ã‚¹ ä¿Šæ¨¹", year: 3, position: "ã‚»ãƒ³ã‚¿ãƒ¼", desc: "50m5ç§’å°ã®ä¿Šè¶³ã‚’èª‡ã‚‹ã€Œãƒãƒ¼ã‚¿ãƒ¼ã€ã€‚æ”»å®ˆã«è¦æ ¼å¤–ã®èº«ä½“èƒ½åŠ›ã‚’è¦‹ã›ã‚‹ã€‚" },
                    { name: "ç™½æ²³ å‹ä¹‹", year: 3, position: "ã‚·ãƒ§ãƒ¼ãƒˆ", desc: "å“è¶Šã—ãŸé‡çƒã‚»ãƒ³ã‚¹ã¨è¯éº—ãªå®ˆå‚™ãŒå…‰ã‚‹å†…é‡ã®å¸ä»¤å¡”ã€‚" },
                    { name: "å¤šç”°é‡ æ¨¹", year: 2, position: "ã‚­ãƒ£ãƒƒãƒãƒ£ãƒ¼", desc: "ã€Œã‚­ãƒ³ã‚°ã€æˆå®®ã®å¥³æˆ¿å½¹ã‚’å°„æ­¢ã‚ãŸ2å¹´ç”Ÿæ•æ‰‹ã€‚å†·é™ãªãƒªãƒ¼ãƒ‰ãŒæŒã¡å‘³ã€‚" },
                    { name: "å±±å²¡ é™¸", year: 3, position: "ã‚µãƒ¼ãƒ‰", desc: "ç¨²å®Ÿã®æ–°ãŸãª4ç•ªæ‰“è€…ã€‚å‹è² å¼·ã„ã‚¯ãƒ©ãƒƒãƒãƒ’ãƒƒã‚¿ãƒ¼ã€‚é«˜æ ¡é€šç®—61æœ¬ã€‚" }
                ]
            },
            "ã‚ã‹ã¤ãå¤§ä»˜å±": {
                summary: "ã‚ã‹ã¤ãå²ä¸Šæœ€å¼·ã®ã€é»„é‡‘ä¸–ä»£ã€ã€‚æŠ•æ‰“ã®æŸ±ãƒ»çŒªç‹©å…„å¼Ÿã‚’æ“ã—ã€å€‹ã®åŠ›ã§ä¸–ä»£ã®é ‚ç‚¹ã‚’è¨¼æ˜ã™ã‚‹ã€‚ã‚»ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³è½ã¡ã®é›‘è‰è»å›£ãŒç‹™ã†ã¯å®Œå…¨å„ªå‹ã€‚ã‚¹ãƒ­ãƒ¼ã‚¬ãƒ³ã¯ã€å®ŸåŠ›ä¸»ç¾©ã€ã€‚",
                players: [
                    { name: "çŒªç‹© å®ˆ", year: 3, position: "ãƒ”ãƒƒãƒãƒ£ãƒ¼", desc: "ã€Œé»„é‡‘ä¸–ä»£ã€ã‚’ç‡ã„ã‚‹ã‚­ãƒ£ãƒ—ãƒ†ãƒ³ã«ã—ã¦çµ¶å¯¾çš„ã‚¨ãƒ¼ã‚¹ã€‚ã€Œãƒ©ã‚¤ã‚¸ãƒ³ã‚°ã‚­ãƒ£ãƒãƒ³ã€ã¨å‘¼ã°ã‚Œã‚‹å‰›é€ŸçƒãŒæ­¦å™¨ã€‚" },
                    { name: "çŒªç‹© é€²", year: 2, position: "ã‚­ãƒ£ãƒƒãƒãƒ£ãƒ¼", desc: "å…„ãƒ»å®ˆã¨ãƒãƒƒãƒ†ãƒªãƒ¼ã‚’çµ„ã‚€å¤©æ‰æ•æ‰‹ã€‚ã€Œçƒç•Œã®é ­è„³ã€ã¨ç§°ã•ã‚Œã‚‹ãƒªãƒ¼ãƒ‰ã¨ä¿Šè¶³ãŒæ­¦å™¨ã€‚" },
                    { name: "ä¸‰æœ¬æ¾ ä¸€", year: 3, position: "ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ", desc: "ä¸å‹•ã®4ç•ªã€‚é«˜æ ¡ç”Ÿé›¢ã‚Œã—ãŸãƒ‘ãƒ¯ãƒ¼ã‚’èª‡ã‚‹è¦æ ¼å¤–ã®é•·è·é›¢ç ²ã€‚" },
                    { name: "ä¸ƒäº•å°†æš‰", year: 3, position: "ãƒ¬ãƒ•ãƒˆ", desc: "ä¸‰æœ¬æ¾ã¨åŒç’§ã‚’ãªã™é•·è·é›¢ç ²ã€‚åºƒè§’ã«æ‰“ã¡åˆ†ã‘ã‚‹æŠ€è¡“ã¨ã€Œãƒã‚ºãƒ¼ã‚«ã€å¼·è‚©ã‚‚ã€‚" },
                    { name: "çŸ¢éƒ¨ ç¿”é›„", year: 3, position: "ã‚»ãƒ³ã‚¿ãƒ¼", desc: "ä¿Šè¶³ãŒæ­¦å™¨ã®å¤–é‡æ‰‹ã€‚æ„å¤–ãªå‹è² å¼·ã•ã‚‚è¦‹ã›ã‚‹ã€‚" }
                ]
            }
        };

        let ROSTER_DATA = {};
        const INITIAL_TEAM_POOL = Object.keys(TEAM_DATA);

        // --- Utility & State Functions ---
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }
        
        function saveState() {
            try {
                localStorage.setItem('tournamentState', JSON.stringify(tournamentState));
            } catch (e) {
                console.error("é€²è¡ŒçŠ¶æ³ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ:", e);
                showAlert("é€²è¡ŒçŠ¶æ³ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®¹é‡ãŒä¸è¶³ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚");
            }
        }
        
        function uint8ArrayToBase64(bytes) {
            let binary = '';
            const len = bytes.byteLength;
            for (let i = 0; i < len; i++) {
                binary += String.fromCharCode(bytes[i]);
            }
            return btoa(binary);
        }

        // --- Custom Alert/Confirm ---
        function showAlert(message) {
            alert(message);
        }

        function showConfirm(message) {
            return new Promise((resolve) => {
                const confirmOk = document.getElementById('confirm-ok');
                const confirmCancel = document.getElementById('confirm-cancel');
                document.getElementById('confirm-modal-text').textContent = message;
                confirmModal.classList.remove('hidden');

                const onOk = () => {
                    confirmModal.classList.add('hidden');
                    cleanup();
                    resolve(true);
                };

                const onCancel = () => {
                    confirmModal.classList.add('hidden');
                    cleanup();
                    resolve(false);
                };
                
                const cleanup = () => {
                    confirmOk.removeEventListener('click', onOk);
                    confirmCancel.removeEventListener('click', onCancel);
                };

                confirmOk.addEventListener('click', onOk);
                confirmCancel.addEventListener('click', onCancel);
            });
        }

        function getRankFromHistoryString(historyString) {
            if (historyString.includes('å„ªå‹')) return 1;
            if (historyString.includes('æº–å„ªå‹')) return 2;
            if (historyString.includes('ãƒ™ã‚¹ãƒˆ4')) return 4;
            if (historyString.includes('ãƒ™ã‚¹ãƒˆ8')) return 8;
            if (historyString.includes('ãƒ™ã‚¹ãƒˆ16')) return 16;
            if (historyString.includes('3å›æˆ¦')) return 16;
            if (historyString.includes('2å›æˆ¦')) return 32;
            if (historyString.includes('åˆæˆ¦æ•—é€€')) return 64;
            return 64;
        }
        
        // === ã‚²ãƒ¼ãƒ ç”¨ãƒ¢ãƒ¼ãƒ€ãƒ«é–¢æ•° ===
        function showManagerComment(title, body, nextActionCallback = null) {
            managerModalTitle.textContent = title;
            managerModalBody.innerHTML = body.replace(/\n/g, '<br>');
            managerModal.classList.remove('hidden');
            managerModal.classList.add('flex');
            nextGameAction = nextActionCallback;
        }

        function showGameOver(message) {
            gameoverModalText.textContent = message;
            gameoverModal.classList.remove('hidden');
            gameoverModal.classList.add('flex');
        }

        // --- Tournament Logic ---
        async function createNewTournament(isNext=false) {
            let teams;
            let seeds = [];

            if (isNext && tournamentState.teamRecords) {
                Object.keys(tournamentState.teamRecords).forEach(teamName => {
                    tournamentState.teamRecords[teamName].previousRank = calculateRank(teamName, tournamentState);
                });

                const lastTournamentTeams = Object.keys(tournamentState.teamRecords)
                    .map(teamName => ({ name: teamName, ...tournamentState.teamRecords[teamName] }))
                    .sort((a, b) => a.lastFinish - b.lastFinish);
                
                seeds = lastTournamentTeams.slice(0, 8).map(t => t.name);
                let nonSeeds = INITIAL_TEAM_POOL.filter(t => !seeds.includes(t));
                
                if (!seeds.includes(PLAYER_TEAM) && nonSeeds.includes(PLAYER_TEAM)) {
                     nonSeeds = nonSeeds.filter(t => t !== PLAYER_TEAM);
                }
                let shuffledNonSeeds = shuffleArray(nonSeeds);
                if (!seeds.includes(PLAYER_TEAM)) {
                    const playerTeamPosition = Math.floor(Math.random() * (shuffledNonSeeds.length + 1));
                    shuffledNonSeeds.splice(playerTeamPosition, 0, PLAYER_TEAM);
                }

                teams = [];
                const seedPositions = [0, 32, 16, 48, 8, 40, 24, 56];
                const seedPlacements = {};
                seeds.forEach((seed, i) => {
                  seedPlacements[seedPositions[i]] = seed;
                });

                let nonSeedIndex = 0;
                for (let i = 0; i < 64; i++) {
                    if (seedPlacements[i]) {
                        teams[i] = seedPlacements[i];
                    } else {
                        teams[i] = shuffledNonSeeds[nonSeedIndex++];
                    }
                }
                tournamentState.tournamentYear++;

            } else {
                tournamentState.tournamentYear = 1;
                tournamentState.teamRecords = {};
                const historicalRanks = INITIAL_TEAM_POOL.map(teamName => ({
                    name: teamName,
                    rank: getRankFromHistoryString(TEAM_DATA[teamName].last)
                }));

                historicalRanks.sort((a, b) => a.rank - b.rank);

                seeds = historicalRanks.slice(0, 8).map(t => t.name);
                const nonSeeds = INITIAL_TEAM_POOL.filter(t => !seeds.includes(t));
                const shuffledNonSeeds = shuffleArray(nonSeeds);
                
                teams = [];
                const seedPositions = [0, 32, 16, 48, 8, 40, 24, 56];
                const seedPlacements = {};
                seeds.forEach((seed, i) => {
                    seedPlacements[seedPositions[i]] = seed;
                });

                let nonSeedIndex = 0;
                for (let i = 0; i < 64; i++) {
                    if (seedPlacements[i]) {
                        teams[i] = seedPlacements[i];
                    } else {
                        teams[i] = shuffledNonSeeds[nonSeedIndex++];
                    }
                }

                INITIAL_TEAM_POOL.forEach(t => {
                    const historicalRank = historicalRanks.find(hr => hr.name === t);
                    tournamentState.teamRecords[t] = { 
                        wins: 0, 
                        losses: 0, 
                        best: null, 
                        lastFinish: historicalRank ? historicalRank.rank : 64,
                        previousRank: null
                    };
                });
            }
            
            if (!teams.includes(PLAYER_TEAM)) {
                teams[Math.floor(Math.random() * (teams.length - 1))] = PLAYER_TEAM;
            }

            tournamentState.teams = teams;
            tournamentState.matches = {};
            tournamentState.news = [];
            tournamentState.seeds = seeds;
            tournamentState.bbsComments = [];
            tournamentState.daiyaBbsComments = [];
            tournamentState.namcoNews = null;

            const round1Setup = teams.reduce((acc, team, i) => {
                if (i % 2 === 0) acc.push({ team1: team, team2: null });
                else acc[acc.length - 1].team2 = team;
                return acc;
            }, []);

            round1Setup.forEach((match, index) => {
                const side = index < 16 ? 'L' : 'R';
                const matchNum = index < 16 ? index + 1 : index - 15;
                const matchId = `${side}-R1-M${matchNum}`;
                tournamentState.matches[matchId] = { team1: match.team1, team2: match.team2, winner: null, score1: '', score2: '', details: null, summary: '' };
            });

            saveState();
            renderTournament(tournamentState);
            setupEl.classList.add('hidden');
            tournamentDisplayEl.classList.remove('hidden');
            
            newsContainer.innerHTML = `<div class="loader">AIè¨˜è€…ãŒå±•æœ›è¨˜äº‹ã‚’åŸ·ç­†ä¸­...</div>`;
            bbsCommentsContainer.innerHTML = `<div class="loader">AIãŒçµ„ã¿åˆã‚ã›ã‚’åˆ†æä¸­...</div>`;
            namcoNewsSection.classList.remove('hidden');
            namcoNewsContent.innerHTML = `<div class="loader">ãƒŠãƒ ã‚³ã‚°ãƒ«ãƒ¼ãƒ—ã‹ã‚‰ã®ãŠçŸ¥ã‚‰ã›ã‚’ç¢ºèªä¸­...</div>`;

            const [previewArticle, bracketComments, namcoNews] = await Promise.all([
                generateNewsArticle(null, null, null, 'preview', null, null),
                generateBracketReactionComments(tournamentState),
                generateNamcoNews(tournamentState, 'bracket')
            ]);

            if (previewArticle) tournamentState.news.unshift(previewArticle);
            if (bracketComments && bracketComments.length > 0) tournamentState.bbsComments.push(...bracketComments);
            if (namcoNews) tournamentState.namcoNews = namcoNews;

            renderNews(tournamentState.news);
            renderBbsComments(tournamentState.bbsComments);
            renderNamcoNews(tournamentState.namcoNews);
            saveState();

            const playerTeamIndex = tournamentState.teams.indexOf(PLAYER_TEAM);
            if (playerTeamIndex !== -1) {
                const opponentIndex = playerTeamIndex % 2 === 0 ? playerTeamIndex + 1 : playerTeamIndex - 1;
                const opponentName = tournamentState.teams[opponentIndex];
                if (opponentName) {
                    const opponentRank = calculateRank(opponentName, tournamentState);
                    const opponentData = TEAM_DATA[opponentName];
                    const title = `ã„ã‚ˆã„ã‚ˆå¤ã®å¤§ä¼šãŒå§‹ã¾ã‚Šã¾ã™ï¼`;
                    const body = `åˆæˆ¦ã®ç›¸æ‰‹ã¯ã€Œ${opponentName}ã€ã«æ±ºã¾ã‚Šã¾ã—ãŸï¼\n` +
                                 `æˆ¦åŠ›ãƒ©ãƒ³ã‚¯ã¯ã€${opponentRank}ã€‘(${getRankDescription(opponentRank)})ã§ã™ã€‚\n` +
                                 `ç›¸æ‰‹ã®æƒ…å ±ï¼šã€${opponentData.info}ã€\n` +
                                 `ã•ã‚ã€ç”²å­åœ’ã«å‘ã‘ã¦ã€æœ€åˆã®è©¦åˆã‚’å§‹ã‚ã¾ã—ã‚‡ã†ï¼`;
                    showManagerComment(title, body, () => highlightPlayerMatch(1));
                }
            } else {
                showAlert("ã‚¨ãƒ©ãƒ¼ï¼š283å­¦åœ’ãŒãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆã«å«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãƒªã‚»ãƒƒãƒˆã—ã¦ãã ã•ã„ã€‚");
            }
        }
        
        function highlightPlayerMatch(roundNumber) {
            document.querySelectorAll('.player-match-highlight').forEach(el => el.classList.remove('player-match-highlight'));
            
            let playerMatchId = null;
            if (roundNumber > 5) { // æ±ºå‹
                 playerMatchId = 'F-R1-M1';
            } else {
                 for (const matchId in tournamentState.matches) {
                    const match = tournamentState.matches[matchId];
                    if (matchId.includes(`-R${roundNumber}-`) && (match.team1 === PLAYER_TEAM || match.team2 === PLAYER_TEAM)) {
                        playerMatchId = matchId;
                        break;
                    }
                }
            }

            if (playerMatchId) {
                const playerMatchEl = document.querySelector(`.matchup[data-match-id="${playerMatchId}"]`);
                if (playerMatchEl) {
                    playerMatchEl.classList.add('player-match-highlight');
                    playerMatchEl.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'center' });
                }
            }
        }

        async function autoSimulateRound(completedRoundNum) {
            skipLoader.classList.remove('hidden');
            skipLoader.textContent = `${getRoundString(completedRoundNum)}ã®ä»–è©¦åˆã‚’é€²è¡Œä¸­...`;
            await new Promise(resolve => setTimeout(resolve, 100));

            let upsets = [];

            const allMatchIds = Object.keys(tournamentState.matches);
            for (const matchId of allMatchIds) {
                if (matchId.includes(`-R${completedRoundNum}-`)) {
                    const match = tournamentState.matches[matchId];
                    if (match && !match.winner && match.team1 && match.team2) {
                        const { team1, team2 } = match;
                        const rank1 = calculateRank(team1, tournamentState);
                        const rank2 = calculateRank(team2, tournamentState);
                        const rankValues = { 'A': 5, 'B': 4, 'C': 3, 'D': 2, 'E': 1 };

                        let winnerName, loserName, isUpset = false;
                        const rankDiff = Math.abs(rankValues[rank1] - rankValues[rank2]);
                        let upsetChance = 0;
                        if (rankDiff === 1) upsetChance = 0.33;
                        else if (rankDiff === 2) upsetChance = 0.15;
                        else if (rankDiff === 3) upsetChance = 0.05;
                        else if (rankDiff >= 4) upsetChance = 0.03;

                        const higherRankTeam = rankValues[rank1] >= rankValues[rank2] ? team1 : team2;
                        const lowerRankTeam = rankValues[rank1] >= rankValues[rank2] ? team2 : team1;

                        if (Math.random() < upsetChance) {
                            winnerName = lowerRankTeam;
                            loserName = higherRankTeam;
                            isUpset = true;
                            upsets.push({ winner: winnerName, loser: loserName });
                        } else {
                            winnerName = higherRankTeam;
                            loserName = lowerRankTeam;
                        }
                        
                        const [winnerScore, loserScore] = isUpset ? 
                            [2 + Math.floor(Math.random() * 3), 1 + Math.floor(Math.random() * 2)].sort((a,b) => b-a) : 
                            generateAutoScore(calculateRank(winnerName, tournamentState), calculateRank(loserName, tournamentState));

                        match.winner = winnerName;
                        match.score1 = (match.team1 === winnerName) ? winnerScore : loserScore;
                        match.score2 = (match.team2 === winnerName) ? winnerScore : loserScore;
                        
                        tournamentState.teamRecords[winnerName].wins++;
                        tournamentState.teamRecords[loserName].losses++;
                        
                        const [side, , matchStr] = matchId.split('-');
                        const matchNum = parseInt(matchStr.slice(1));
                        const nextRoundNum = completedRoundNum + 1;
                        const nextMatchNum = Math.ceil(matchNum / 2);
                        let nextMatchId = (nextRoundNum > 5) ? 'F-R1-M1' : `${side}-R${nextRoundNum}-M${nextMatchNum}`;
                        
                        if (!tournamentState.matches[nextMatchId]) {
                            tournamentState.matches[nextMatchId] = { team1: null, team2: null, winner: null, score1: '', score2: '', details: null, summary: '' };
                        }
                        if (nextRoundNum <= 5) {
                            if (matchNum % 2 !== 0) tournamentState.matches[nextMatchId].team1 = winnerName;
                            else tournamentState.matches[nextMatchId].team2 = winnerName;
                        } else {
                            if (side === 'L') tournamentState.matches[nextMatchId].team1 = winnerName;
                            else tournamentState.matches[nextMatchId].team2 = winnerName;
                        }
                    }
                }
            }
            
            let newsBody = `${getRoundString(completedRoundNum)}ãŒå…¨è©¦åˆçµ‚äº†ã—ã¾ã—ãŸã€‚\né †å½“ã«å‹ã¡ä¸ŠãŒã‚‹å¼·è±ªæ ¡ã‚‚ã„ã‚Œã°ã€æ³¢ä¹±ã®å±•é–‹ã‚‚è¦‹ã‚‰ã‚Œã¾ã—ãŸã€‚\næ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã¯ã©ã®ã‚ˆã†ãªãƒ‰ãƒ©ãƒãŒå¾…ã£ã¦ã„ã‚‹ã®ã‹ã€ç›®ãŒé›¢ã›ã¾ã›ã‚“ï¼`;
             if (upsets.length > 0) {
                 const biggestUpset = upsets[0];
                 newsBody = `${getRoundString(completedRoundNum)}ãŒçµ‚äº†ã—ã€æ—©ãã‚‚æ³¢ä¹±ã®å±•é–‹ï¼\nç‰¹ã«${biggestUpset.winner}ãŒå¼·è±ª${biggestUpset.loser}ã‚’ç ´ã‚‹ã‚¸ãƒ£ã‚¤ã‚¢ãƒ³ãƒˆã‚­ãƒªãƒ³ã‚°ã‚’é”æˆã—ã€çƒå ´ã‚’æ²¸ã‹ã›ã¾ã—ãŸã€‚\næ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã‚‚ç›®ãŒé›¢ã›ãªã„ï¼`;
             }
             const article = { title: `${getRoundString(completedRoundNum)}å…¨è©¦åˆãŒçµ‚äº†ï¼`, body: newsBody, timestamp: Date.now(), newspaperHtml: null };
             tournamentState.news.push(article);


            skipLoader.classList.add('hidden');
            renderTournament(tournamentState);
            saveState();

            const nextRound = completedRoundNum + 1;
            let playerNextMatchId = null;
            let nextOpponentName = null;

            if (nextRound > 6) return;

            for (const matchId in tournamentState.matches) {
                const match = tournamentState.matches[matchId];
                const isFinal = matchId.startsWith('F-');
                if ((isFinal && nextRound > 5) || (matchId.includes(`-R${nextRound}-`) && (match.team1 === PLAYER_TEAM || match.team2 === PLAYER_TEAM))) {
                    playerNextMatchId = matchId;
                    nextOpponentName = match.team1 === PLAYER_TEAM ? match.team2 : match.team1;
                    break;
                }
            }
            
            if (nextOpponentName) {
                const opponentRank = calculateRank(nextOpponentName, tournamentState);
                const opponentData = TEAM_DATA[nextOpponentName];
                const title = `${getRoundString(nextRound)}ã®ç›¸æ‰‹ãŒæ±ºå®šã—ã¾ã—ãŸï¼`;
                const body = `æ¬¡ã®å¯¾æˆ¦ç›¸æ‰‹ã¯ã€Œ${nextOpponentName}ã€ã§ã™ï¼\n` +
                             `æˆ¦åŠ›ãƒ©ãƒ³ã‚¯ã¯ã€${opponentRank}ã€‘(${getRankDescription(opponentRank)})ã§ã™ã€‚\n` +
                             `æƒ…å ±ï¼šã€${opponentData.info}ã€\n` +
                             "æ°—ã‚’å¼•ãç· ã‚ã¦ã„ãã¾ã—ã‚‡ã†ï¼";
                showManagerComment(title, body, () => highlightPlayerMatch(nextRound));
            }
        }


        // --- Rendering Functions ---
        function renderTournament(data) {
            tournamentYearDisplay.textContent = `${data.tournamentYear}å¹´åº¦ ${PLAYER_TEAM}ã®å¤`;
            renderMainBracket(data);
            renderNews(data.news || []);
            renderBbsComments(data.bbsComments || []);
            renderDaiyaBbsComments(data.daiyaBbsComments || []);
            renderNamcoNews(data.namcoNews);
            checkTournamentProgress();
        }

        function renderMainBracket(data) {
             const { matches, teams } = data;
             
             const bracketContentWrapper = document.createElement('div');
             bracketContentWrapper.className = 'flex flex-row';
             
             const leftBracketEl = document.createElement('div');
             leftBracketEl.className = 'bracket-half left';

             const rightBracketEl = document.createElement('div');
             rightBracketEl.className = 'bracket-half right';

             const finalMatch = matches['F-R1-M1'] || {};
             const leftChampion = matches['L-R5-M1']?.winner || null;
             const rightChampion = matches['R-R5-M1']?.winner || null;
             const finalTeam1 = finalMatch.team1 || leftChampion;
             const finalTeam2 = finalMatch.team2 || rightChampion;

             const finalEl = document.createElement('div');
             finalEl.className = 'bracket-final';
             finalEl.innerHTML = `<div class="final-title">æ±ºå‹</div><div class="final-matchup" data-match-id="F-R1-M1">${createMatchHTML('F-R1-M1', finalTeam1, finalTeam2, finalMatch, data.seeds)}</div><div class="winner-box" id="tournament-winner">${finalMatch.winner ? `ğŸ† ${finalMatch.winner} ğŸ†` : 'ğŸ†'}</div>`;

             const round1Setup = teams.reduce((acc, team, i) => {
                 if (i % 2 === 0) acc.push({ team1: team, team2: null });
                 else acc[acc.length - 1].team2 = team;
                 return acc;
             }, []);
             
             const leftHalfSetup = round1Setup.slice(0, 16);
             const rightHalfSetup = round1Setup.slice(16, 32);

             generateHalf(leftBracketEl, leftHalfSetup, 'L', matches, data.seeds);
             generateHalf(rightBracketEl, rightHalfSetup, 'R', matches, data.seeds);

             mainBracketContainer.innerHTML = '';
             bracketContentWrapper.append(leftBracketEl, finalEl, rightBracketEl);
             mainBracketContainer.appendChild(bracketContentWrapper);

             if (finalMatch.winner) {
                 nextTournamentBtn.classList.remove('hidden');
             } else {
                 nextTournamentBtn.classList.add('hidden');
             }
        }
        function generateHalf(containerEl, setup, side, allMatches, seeds) {
            containerEl.innerHTML = '';
            const numRounds = 5;

            const roundElements = [];
            for (let i = 0; i < numRounds; i++) {
                const roundEl = document.createElement('div');
                roundEl.className = 'round';
                if (i > 0) roundEl.classList.add('subsequent-round');

                const roundTitle = document.createElement('h3');
                roundTitle.className = 'text-center font-bold mb-2';
                const roundNames = ["1å›æˆ¦", "2å›æˆ¦", "3å›æˆ¦", "æº–ã€…æ±ºå‹", "æº–æ±ºå‹"];
                roundTitle.textContent = roundNames[i];
                roundEl.appendChild(roundTitle);

                containerEl.appendChild(roundEl);
                roundElements.push(roundEl);
            }

            setup.forEach((matchSetup, index) => {
                const matchId = `${side}-R1-M${index + 1}`;
                let dbMatch = allMatches[matchId] || {};
                roundElements[0].insertAdjacentHTML('beforeend', createMatchHTML(matchId, matchSetup.team1, matchSetup.team2, dbMatch, seeds));
            });

            for (let r = 2; r <= numRounds; r++) {
                const numMatchesInRound = 16 / Math.pow(2, r - 1);
                for (let m = 1; m <= numMatchesInRound; m++) {
                    const matchId = `${side}-R${r}-M${m}`;
                    const prevMatch1Id = `${side}-R${r - 1}-M${(m * 2) - 1}`;
                    const prevMatch2Id = `${side}-R${r - 1}-M${m * 2}`;
                    const team1 = allMatches[prevMatch1Id]?.winner || null;
                    const team2 = allMatches[prevMatch2Id]?.winner || null;
                    const dbMatch = allMatches[matchId] || {};
                    roundElements[r - 1].insertAdjacentHTML('beforeend', createMatchHTML(matchId, team1, team2, dbMatch, seeds));
                }
            }
        }
        function calculateRank(teamName, state) {
            if (!teamName || !TEAM_DATA[teamName]) return ''; 

            const teamData = TEAM_DATA[teamName];
            let score = 0;

            score += teamData.deviation;

            if (teamData.best.includes('å„ªå‹')) score += 25;
            else if (teamData.best.includes('æº–å„ªå‹')) score += 20;
            else if (teamData.best.includes('ãƒ™ã‚¹ãƒˆ4')) score += 15;
            else if (teamData.best.includes('ãƒ™ã‚¹ãƒˆ8')) score += 10;
            else if (teamData.best.includes('å‡ºå ´')) score += 10;
            else if (teamData.best.includes('ãƒ™ã‚¹ãƒˆ16')) score += 5;

            if (teamData.popularity) score += 5;

            if (state.teamRecords && state.teamRecords[teamName]) {
                const lastFinish = state.teamRecords[teamName].lastFinish;
                const rankMultiplier = 3.0; 
                if (lastFinish === 1) score += 30 * rankMultiplier; 
                else if (lastFinish === 2) score += 25 * rankMultiplier;
                else if (lastFinish <= 4) score += 20 * rankMultiplier;
                else if (lastFinish <= 8) score += 15 * rankMultiplier;
                else if (lastFinish <= 16) score += 5 * rankMultiplier;
                else if (lastFinish >= 64) score -= 5 * rankMultiplier;
            }
            
            if (score >= 85) return 'A';
            if (score >= 70) return 'B';
            if (score >= 55) return 'C';
            if (score >= 40) return 'D';
            return 'E';
        }

        function createMatchHTML(matchId, team1, team2, dbMatch, seeds = []) {
            const t1Empty = !team1;
            const t2Empty = !team2;
            const rank1 = calculateRank(team1, tournamentState);
            const rank2 = calculateRank(team2, tournamentState);
            const rankColor = (rank) => {
                switch(rank) {
                    case 'A': return 'rank-A';
                    case 'B': return 'rank-B';
                    case 'C': return 'rank-C';
                    case 'D': return 'rank-D';
                    case 'E': return 'rank-E';
                    default: return '';
                }
            };
            
            const roundStr = matchId.split('-')[1];
            const showDetailsButton = !t1Empty && !t2Empty && (roundStr === 'R5' || matchId.startsWith('F-'));
            const isSeed1 = seeds.includes(team1);
            const isSeed2 = seeds.includes(team2);

            const content = `
                <div class="team-slot ${t1Empty ? 'empty' : ''} ${dbMatch.winner === team1 && !t1Empty ? 'winner' : ''} ${dbMatch.winner && dbMatch.winner !== team1 && dbMatch.winner !== null ? 'loser' : ''}" data-team-name="${team1 || ''}">
                    <span class="team-name ${isSeed1 ? 'seed' : ''}" title="${team1 || ''}">
                        ${team1 ? `<span class="rank ${rankColor(rank1)}">[${rank1}]</span>` : ''}
                        ${isSeed1 ? 'S ' : ''}${team1 || '---'}
                    </span>
                    <input type="text" class="score-input" value="${dbMatch.score1 ?? ''}" data-team-pos="1">
                    <button class="win-btn">â–¶</button>
                </div>
                <div class="team-slot ${t2Empty ? 'empty' : ''} ${dbMatch.winner === team2 && !t2Empty ? 'winner' : ''} ${dbMatch.winner && dbMatch.winner !== team2 && dbMatch.winner !== null ? 'loser' : ''}" data-team-name="${team2 || ''}">
                    <span class="team-name ${isSeed2 ? 'seed' : ''}" title="${team2 || ''}">
                         ${team2 ? `<span class="rank ${rankColor(rank2)}">[${rank2}]</span>` : ''}
                        ${isSeed2 ? 'S ' : ''}${team2 || '---'}
                    </span>
                    <input type="text" class="score-input" value="${dbMatch.score2 ?? ''}" data-team-pos="2">
                    <button class="win-btn">â–¶</button>
                </div>
                 <div class="match-summary-container ${!t1Empty && !t2Empty ? '' : 'hidden'}">
                    <textarea class="match-summary-input w-full text-xs p-1 mt-1 border rounded" data-match-id="${matchId}" placeholder="è©¦åˆã®æ±ºã‚æ‰‹ï¼ˆä»»æ„ï¼‰">${dbMatch.summary || ''}</textarea>
                </div>
                `;
            
            const footer = showDetailsButton ? `<div class="matchup-footer"><button class="details-btn" data-match-id="${matchId}">è©³ç´°å…¥åŠ›</button></div>` : '';

            return `<div class="matchup" data-match-id="${matchId}">${content}</div>${footer}`;
        }
        function renderNews(news) {
            if (!news || news.length === 0) {
                newsContainer.innerHTML = `<p class="text-gray-500 text-center">ã¾ã ãƒ‹ãƒ¥ãƒ¼ã‚¹ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>`;
                return;
            }
            newsContainer.innerHTML = '';
            news.slice().reverse().forEach((article, index) => {
                const articleEl = document.createElement('div');
                if (article.error) {
                    articleEl.className = 'article-error';
                    articleEl.innerHTML = `
                        <span>${article.title}</span>
                        <button class="retry-btn" data-error-id="${article.errorId}">å†ç”Ÿæˆ</button>
                    `;
                } else {
                    const originalIndex = news.length - 1 - index;
                    articleEl.className = 'bg-white p-4 rounded-lg shadow';
                    articleEl.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="font-bold text-lg text-blue-600">${article.title}</h3>
                                <p class="text-xs text-gray-400 mt-1">${new Date(article.timestamp).toLocaleDateString('ja-JP')}</p>
                            </div>
                            <div>
                                <button class="text-sm bg-gray-200 px-3 py-1 rounded hover:bg-gray-300 news-article-btn" data-index="${originalIndex}">æœ¬æ–‡</button>
                                ${article.newspaperHtml ? `<button class="text-sm bg-red-100 text-red-700 px-3 py-1 rounded hover:bg-red-200 ml-2 newspaper-view-btn" data-index="${originalIndex}">æ–°è</button>` : ''}
                            </div>
                        </div>
                    `;
                }
                newsContainer.appendChild(articleEl);
            });
        }
        function renderBbsComments(comments) {
            if (!comments || comments.length === 0) {
                bbsCommentsContainer.innerHTML = `<p class="text-gray-500 text-center">ã¾ã åå¿œã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>`;
                return;
            }
            bbsCommentsContainer.innerHTML = '';
            comments.slice().reverse().forEach(comment => {
                const commentEl = document.createElement('div');
                commentEl.className = 'bbs-comment';
                commentEl.innerHTML = `
                    <p class="font-semibold text-gray-600 text-sm">${comment.personality || 'åç„¡ã—ã•ã‚“'}</p>
                    <p class="text-gray-800 my-1">${comment.text}</p>
                    <p class="text-xs text-gray-400 text-right">${new Date(comment.timestamp).toLocaleString('ja-JP')}</p>
                `;
                bbsCommentsContainer.appendChild(commentEl);
            });
        }
        function renderDaiyaBbsComments(comments) {
             if (!comments || comments.length === 0) {
                 daiyaBbsCommentsContainer.innerHTML = `<p class="text-gray-500 text-center">ã¾ã åå¿œã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>`;
                 return;
             }
             daiyaBbsCommentsContainer.innerHTML = ''; 
             comments.slice().reverse().forEach(comment => {
                 const commentEl = document.createElement('div');
                 commentEl.className = 'bbs-comment';
                 commentEl.innerHTML = `
                     <p class="font-semibold text-gray-600 text-sm">${comment.personality || 'åç„¡ã—ã•ã‚“'}</p>
                     <p class="text-gray-800 my-1">${comment.text}</p>
                     <p class="text-xs text-gray-400 text-right">${new Date(comment.timestamp).toLocaleString('ja-JP')}</p>
                 `;
                 daiyaBbsCommentsContainer.appendChild(commentEl);
             });
        }
        function renderNamcoNews(news) {
            if (!news) {
                namcoNewsSection.classList.add('hidden');
                return;
            }
            namcoNewsSection.classList.remove('hidden');
            namcoNewsContent.innerHTML = '';
            const newsItem = document.createElement('div');
            newsItem.className = 'namco-news-item p-2 hover:bg-orange-50 rounded';
            newsItem.innerHTML = `<p class="font-semibold text-gray-700">${news.title}<span class="namco-news-tag">é‡çƒéƒ¨</span></p>`;
            newsItem.addEventListener('click', () => {
                document.getElementById('modal-title').textContent = news.title;
                document.getElementById('modal-body').textContent = news.body;
                document.getElementById('modal-meta').innerHTML = `<p>${new Date(news.timestamp).toLocaleDateString('ja-JP')}</p><p class="font-bold text-gray-500">é‡çƒéƒ¨</p>`;
                newsModal.classList.remove('hidden');
                newsModal.classList.add('flex');
            });
            namcoNewsContent.appendChild(newsItem);
        }

        // --- AI Reporter Logic ---
        function parseJsonFromText(text) {
            try {
                const cleanedText = text.replace(/```json/g, '').replace(/```/g, '').trim();
                const jsonMatch = cleanedText.match(/\{[\s\S]*\}|\[[\s\S]*\]/);
                if (jsonMatch) {
                    return JSON.parse(jsonMatch[0]);
                }
            } catch (e) {
                console.error("Failed to parse JSON from text:", text, e);
            }
            return null;
        }

        async function fetchWithRetry(payload, maxRetries = 3) {
            const functionUrl = '/.netlify/functions/generateApiContent';
            let lastError;

            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(functionUrl, {
                        method: 'POST',
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        return response;
                    }
                    
                    if (response.status >= 400 && response.status < 500 && response.status !== 429) {
                        console.error(`Client Error: ${response.status}. Not retrying.`);
                        const errorData = await response.json();
                        throw new Error(`API Error: ${errorData.error}`);
                    }

                    lastError = new Error(`API Error: ${response.status}`);
                    const delay = Math.pow(2, i) * 1000;
                    console.log(`API call failed. Retrying in ${delay}ms...`);
                    await new Promise(resolve => setTimeout(resolve, delay));

                } catch (error) {
                    lastError = error;
                    const delay = Math.pow(2, i) * 1000;
                    console.error(`Network error: ${error.message}. Retrying in ${delay}ms...`);
                    if (i < maxRetries - 1) {
                        await new Promise(resolve => setTimeout(resolve, delay));
                    }
                }
            }
            throw lastError;
        }

        function getRankDescription(rank) {
            switch(rank) {
                case 'A': return 'åé–€æ ¡';
                case 'B': return 'å¼·è±ªæ ¡';
                case 'C': return 'ä¸­å …æ ¡';
                case 'D': return 'ç™ºå±•é€”ä¸Šã®ãƒãƒ¼ãƒ ';
                case 'E': return 'æŒ‘æˆ¦è€…';
                default: return '';
            }
        }
        
        function createNewspaperHtml(articleData, matchData) {
            const { winnerName, loserName, dbMatch, matchId } = matchData;
            const [side, roundStr] = matchId.split('-');
            const roundNum = side === 'F' ? 6 : parseInt(roundStr.slice(1));

            const isLateRound = roundNum >= 4;
            const containerClass = isLateRound ? 'newspaper-late' : 'newspaper-early';
            const winnerScore = dbMatch.team1 === winnerName ? dbMatch.score1 : dbMatch.score2;
            const loserScore = dbMatch.team1 === winnerName ? dbMatch.score2 : dbMatch.score1;

            return `
                <div class="newspaper-container ${containerClass}">
                    <div class="newspaper-header">
                        <h2 class="newspaper-title">ç†±é—˜é«˜æ ¡é‡çƒ</h2>
                        <p class="newspaper-date">${new Date(articleData.timestamp).toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                    </div>
                    <div class="newspaper-content">
                        <h1 class="newspaper-main-headline">${winnerName}</h1>
                        <div class="newspaper-body-content">
                            <h2 class="newspaper-sub-headline">${articleData.title}</h2>
                            ${isLateRound ? '<div class="newspaper-image-placeholder">[è©¦åˆã®æ§˜å­ã®å†™çœŸ]</div>' : ''}
                            <p class="newspaper-text">${articleData.body.replace(/\\n/g, '\n')}</p>
                            <div class="newspaper-score-box">
                                <h3>æœ€çµ‚ã‚¹ã‚³ã‚¢</h3>
                                <p class="score">${winnerName} ${winnerScore} - ${loserScore} ${loserName}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        async function generateNewsArticle(winnerName, loserName, dbMatch, matchId, nextOpponentInfo, matchSummary) {
            if (matchId === 'preview') {
                const { tournamentYear, seeds, teams } = tournamentState;
                const blockA_teams = teams.slice(0, 16);
                const blockB_teams = teams.slice(16, 32);
                const blockC_teams = teams.slice(32, 48);
                const blockD_teams = teams.slice(48, 64);
                const findPromisingSchools = (teamList) => teamList.filter(team => seeds.includes(team) || DETAILED_TEAM_DATA[team] || TEAM_DATA[team].popularity || TEAM_DATA[team].best.includes('ç”²å­åœ’'));
                const prompt = `
ã‚ãªãŸã¯ã€æƒ…ç†±çš„ã§çµŒé¨“è±Šå¯Œãªé«˜æ ¡é‡çƒå°‚é–€ã®AIè¨˜è€…ã§ã™ã€‚
é–“ã‚‚ãªãé–‹å¹•ã™ã‚‹ã€Œ${tournamentYear}å¹´åº¦å¤§ä¼šã€ã®å±•æœ›è¨˜äº‹ã‚’ã€å„ãƒ–ãƒ­ãƒƒã‚¯ã”ã¨ã«åˆ†æã—ã¦ä½œæˆã—ã¦ãã ã•ã„ã€‚
### å¤§ä¼šå…¨ä½“æƒ…å ±
- å¤§ä¼šå: ${tournamentYear}å¹´åº¦å¤§ä¼š
- ã‚·ãƒ¼ãƒ‰æ ¡ (æ˜¨å¹´åº¦ãƒ™ã‚¹ãƒˆ8): ${seeds.join(', ') || 'ãªã—'}
- æ˜¨å¹´åº¦ç‹è€…: ${seeds[0] || 'ãªã—'}
### å„ãƒ–ãƒ­ãƒƒã‚¯ã®æœ‰åŠ›æ ¡
- Aãƒ–ãƒ­ãƒƒã‚¯: ${findPromisingSchools(blockA_teams).map(t => `${t} (${getRankDescription(calculateRank(t,tournamentState))})`).join(', ') || 'ç‰¹ã«ãªã—'}
- Bãƒ–ãƒ­ãƒƒã‚¯: ${findPromisingSchools(blockB_teams).map(t => `${t} (${getRankDescription(calculateRank(t,tournamentState))})`).join(', ') || 'ç‰¹ã«ãªã—'}
- Cãƒ–ãƒ­ãƒƒã‚¯: ${findPromisingSchools(blockC_teams).map(t => `${t} (${getRankDescription(calculateRank(t,tournamentState))})`).join(', ') || 'ç‰¹ã«ãªã—'}
- Dãƒ–ãƒ­ãƒƒã‚¯: ${findPromisingSchools(blockD_teams).map(t => `${t} (${getRankDescription(calculateRank(t,tournamentState))})`).join(', ') || 'ç‰¹ã«ãªã—'}
### åŸ·ç­†æŒ‡ç¤º
- ä¸Šè¨˜æƒ…å ±ã‚’åŸºã«ã€å¤§ä¼šå…¨ä½“ã®å±•æœ›ã‚’ã¾ã¨ã‚ã¦ãã ã•ã„ã€‚
- è¨˜äº‹ã®ãƒˆãƒ¼ãƒ³ã¯ã€èª­è€…ã®æœŸå¾…æ„Ÿã‚’ç…½ã‚‹ã‚ˆã†ãªã€ãƒ‰ãƒ©ãƒãƒãƒƒã‚¯ãªã‚‚ã®ã«ã—ã¦ãã ã•ã„ã€‚
- å„ãƒ–ãƒ­ãƒƒã‚¯ã®æœ‰åŠ›æ ¡ã«è§¦ã‚Œã¤ã¤ã€å…¨ä½“ã¨ã—ã¦ã®å„ªå‹å€™è£œã‚‚æŒ™ã’ã¦ã¿ã¦ãã ã•ã„ã€‚
- è¨˜äº‹å†…ã§ã¯ã€ŒAãƒ©ãƒ³ã‚¯ã€ã®ã‚ˆã†ãªç›´æ¥çš„ãªãƒ©ãƒ³ã‚¯è¡¨è¨˜ã¯ä½¿ã‚ãšã€ã€Œåé–€ã€ã€Œå¼·è±ªã€ã¨ã„ã£ãŸè¡¨ç¾ã§æ ¼ä»˜ã‘ã‚’ç¤ºå”†ã—ã¦ãã ã•ã„ã€‚
### å‡ºåŠ›å½¢å¼
ä»¥ä¸‹ã®JSONå½¢å¼ã§ã€ã‚¿ã‚¤ãƒˆãƒ«ã¨æœ¬æ–‡ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚
{"title": "è¨˜äº‹ã®ã‚¿ã‚¤ãƒˆãƒ«", "body": "è¨˜äº‹ã®æœ¬æ–‡ï¼ˆæ”¹è¡Œã¯\\nã‚’ä½¿ç”¨ï¼‰"}
`;
                try {
                    const response = await fetchWithRetry({ contents: [{ role: "user", parts: [{ text: prompt }] }] });
                    const result = await response.json();
                    if (result.candidates?.[0]?.content?.parts?.[0]) {
                        const rawText = result.candidates[0].content.parts[0].text;
                        const article = parseJsonFromText(rawText);
                        if (article) return { ...article, timestamp: Date.now(), newspaperHtml: null };
                    }
                    throw new Error("AI preview article response format error.");
                } catch (error) {
                    console.error("AI preview article generation failed:", error);
                    return { title: "å±•æœ›è¨˜äº‹ç”Ÿæˆã‚¨ãƒ©ãƒ¼", body: "AIè¨˜è€…ã¨ã®é€šä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚", timestamp: Date.now(), error: true, errorId: `preview-${Date.now()}`, newspaperHtml: null };
                }
            }
            
            const winnerData = TEAM_DATA[winnerName];
            const loserData = TEAM_DATA[loserName];
            const winnerScore = dbMatch.team1 === winnerName ? dbMatch.score1 : dbMatch.score2;
            const loserScore = dbMatch.team1 === winnerName ? dbMatch.score2 : dbMatch.score1;
            const winnerRankDesc = getRankDescription(calculateRank(winnerName, tournamentState));
            const loserRankDesc = getRankDescription(calculateRank(loserName, tournamentState));
            const isCivilWar = (winnerName === '283å­¦åœ’' && loserName === '283å­¦åœ’B') || (winnerName === '283å­¦åœ’B' && loserName === '283å­¦åœ’');

            const [side, roundStr] = matchId.split('-');
            const roundNum = side === 'F' ? 6 : parseInt(roundStr.slice(1));
            let roundAchievement = '';
            switch (roundNum) {
                case 1: roundAchievement = 'åˆæˆ¦çªç ´'; break;
                case 2: roundAchievement = '3å›æˆ¦é€²å‡º'; break;
                case 3: roundAchievement = 'ãƒ™ã‚¹ãƒˆ8é€²å‡º'; break;
                case 4: roundAchievement = 'ãƒ™ã‚¹ãƒˆ4é€²å‡º'; break;
                case 5: roundAchievement = 'æ±ºå‹é€²å‡º'; break;
                case 6: roundAchievement = 'ç”²å­åœ’å‡ºå ´æ±ºå®šï¼'; break;
            }

            let civilWarInstruction = isCivilWar ? `- **ã“ã®è©¦åˆã¯ã€Œ283ãƒ€ãƒ¼ãƒ“ãƒ¼ã€ã§ã™ã€‚ã“ã®ã€Œèº«å†…å¯¾æ±ºã€ã‚’è¨˜äº‹ã®æœ€å¤§ã®ãƒ†ãƒ¼ãƒã¨ã—ã¦ãã ã•ã„ã€‚**\n- è¨˜äº‹ã®ã‚¿ã‚¤ãƒˆãƒ«ã«ã‚‚ã€Œèº«å†…å¯¾æ±ºã€ã€Œ283ãƒ€ãƒ¼ãƒ“ãƒ¼ã€ã¨ã„ã£ãŸè¨€è‘‰ã‚’ä½¿ã„ã€ãƒ‰ãƒ©ãƒãƒãƒƒã‚¯ã«ã—ã¦ãã ã•ã„ã€‚\n- æœ¬æ–‡ã§ã¯ã€åŒã˜ç³»åˆ—æ ¡åŒå£«ãŒé›Œé›„ã‚’æ±ºã™ã‚‹ã¨ã„ã†éæƒ…ãªãƒ‰ãƒ©ãƒã€é¸æ‰‹ãŸã¡ã®è¤‡é›‘ãªå¿ƒå¢ƒã€å¿œæ´å›£ã®æ§˜å­ãªã©ã‚’æå†™ã—ã¦ãã ã•ã„ã€‚\n- æ•—ã‚ŒãŸãƒãƒ¼ãƒ ã®å¥é—˜ã‚’ç§°ãˆã¤ã¤ã€å‹åˆ©ã—ãŸãƒãƒ¼ãƒ ãŒç³»åˆ—æ ¡ã®æƒ³ã„ã‚’èƒŒè² ã£ã¦æ¬¡ã«é€²ã‚€ã€ã¨ã„ã†ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’æã„ã¦ãã ã•ã„ã€‚` : '';

            const prompt = `
ã‚ãªãŸã¯ã€æƒ…ç†±çš„ã§çµŒé¨“è±Šå¯Œãªé«˜æ ¡é‡çƒå°‚é–€ã®AIè¨˜è€…ã§ã™ã€‚
ä»¥ä¸‹ã®è©¦åˆçµæœã¨ãƒãƒ¼ãƒ æƒ…å ±ã«åŸºã¥ãã€èª­è€…ã®å¿ƒã‚’æ´ã‚€ã‚ˆã†ãªãƒ‰ãƒ©ãƒãƒãƒƒã‚¯ãªãƒ‹ãƒ¥ãƒ¼ã‚¹è¨˜äº‹ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚
### è©¦åˆæƒ…å ±
- å¤§ä¼š: ${tournamentState.tournamentYear}å¹´åº¦å¤§ä¼š
- ãƒ©ã‚¦ãƒ³ãƒ‰é”æˆè¨˜éŒ²: ${roundAchievement}
- å‹åˆ©ãƒãƒ¼ãƒ : ${winnerName} (${winnerRankDesc})
- æ•—åŒ—ãƒãƒ¼ãƒ : ${loserName} (${loserRankDesc})
- ã‚¹ã‚³ã‚¢: ${winnerName} ${winnerScore} - ${loserScore} ${loserName}
- è©¦åˆã®ãƒã‚¤ãƒ©ã‚¤ãƒˆï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ï¼‰: ${matchSummary || 'ãªã—'}
### åŸ·ç­†ã®ãƒã‚¤ãƒ³ãƒˆ
${civilWarInstruction}
- è¨˜äº‹ã®ä¸­ã§ã€Œ${winnerName}ãŒ${roundAchievement}ã‚’æ±ºã‚ãŸã€ã¨ã„ã†äº‹å®Ÿã‚’å¿…ãšå«ã‚ã¦ãã ã•ã„ã€‚
- ä¸¡ãƒãƒ¼ãƒ ã®ãƒ©ãƒ³ã‚¯ï¼ˆåé–€ã€å¼·è±ªãªã©ï¼‰ã‚‚è€ƒæ…®ã—ã€ç•ªç‹‚ã‚ã›ã‹é †å½“ãªçµæœã‹ã‚’è¨˜äº‹ã«å«ã‚ã¦ãã ã•ã„ã€‚
- è¨˜äº‹ã®ãƒˆãƒ¼ãƒ³ã¯ã€ãƒ‰ãƒ©ãƒãƒãƒƒã‚¯ã‹ã¤å®¢è¦³çš„ã«ã€‚
### å‡ºåŠ›å½¢å¼
ä»¥ä¸‹ã®JSONå½¢å¼ã§ã€ã‚¿ã‚¤ãƒˆãƒ«ã¨æœ¬æ–‡ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚
{"title": "è¨˜äº‹ã®ã‚¿ã‚¤ãƒˆãƒ«", "body": "è¨˜äº‹ã®æœ¬æ–‡ï¼ˆæ”¹è¡Œã¯\\nã‚’ä½¿ç”¨ï¼‰"}
`;

            try {
                const response = await fetchWithRetry({ contents: [{ role: "user", parts: [{ text: prompt }] }] });
                const result = await response.json();
                if (result.candidates?.[0]?.content?.parts?.[0]) {
                    const rawText = result.candidates[0].content.parts[0].text;
                    const article = parseJsonFromText(rawText);
                    if (article) {
                        const newspaperHtml = createNewspaperHtml(article, { winnerName, loserName, dbMatch, matchId });
                        return { ...article, timestamp: Date.now(), newspaperHtml };
                    }
                }
                throw new Error("AIã‹ã‚‰ã®å¿œç­”ãŒäºˆæœŸã—ãŸå½¢å¼ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚");
            } catch (error) {
                console.error("AIè¨˜äº‹ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ:", error);
                return {
                    title: "è¨˜äº‹ç”Ÿæˆã‚¨ãƒ©ãƒ¼", body: "AIè¨˜è€…ã¨ã®é€šä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚", timestamp: Date.now(), error: true, errorId: matchId, context: { winnerName, loserName, dbMatch, matchId, nextOpponentInfo, matchSummary }, newspaperHtml: null
                };
            }
        }
        
        async function generateBbsComments(winnerName, loserName, dbMatch, matchId, matchSummary) {
            const winnerData = TEAM_DATA[winnerName];
            const loserData = TEAM_DATA[loserName];
            const winnerScore = dbMatch.team1 === winnerName ? dbMatch.score1 : dbMatch.score2;
            const loserScore = dbMatch.team1 === winnerName ? dbMatch.score2 : dbMatch.score1;
            const winnerRank = calculateRank(winnerName, tournamentState);
            const loserRank = calculateRank(loserName, tournamentState);
            const isCivilWar = (winnerName === '283å­¦åœ’' && loserName === '283å­¦åœ’B') || (winnerName === '283å­¦åœ’B' && loserName === '283å­¦åœ’');

            const [side, roundStr] = matchId.split('-');
            const roundNum = side === 'F' ? 6 : parseInt(roundStr.slice(1));
            let matchContext = '';
            switch (roundNum) {
                case 1: matchContext = 'ã“ã‚Œã¯1å›æˆ¦ã§ã™ã€‚'; break;
                case 2: matchContext = 'ã“ã‚Œã¯2å›æˆ¦ã§ã™ã€‚'; break;
                case 3: matchContext = 'ã“ã‚Œã¯3å›æˆ¦ã€ãƒ™ã‚¹ãƒˆ8é€²å‡ºã‚’ã‹ã‘ãŸè©¦åˆã§ã™ã€‚'; break;
                case 4: matchContext = 'ã“ã‚Œã¯æº–ã€…æ±ºå‹ã€ãƒ™ã‚¹ãƒˆ4é€²å‡ºã‚’ã‹ã‘ãŸè©¦åˆã§ã™ã€‚'; break;
                case 5: matchContext = 'ã“ã‚Œã¯æ±ºå‹é€²å‡ºã‚’ã‹ã‘ãŸæº–æ±ºå‹ã§ã™ã€‚æ•—ã‚ŒãŸãƒãƒ¼ãƒ ã‚‚ã“ã“ã¾ã§å‹ã¡ä¸ŠãŒã£ã¦ããŸå¼·è±ªã§ã™ã€‚'; break;
                case 6: matchContext = 'ã“ã‚Œã¯ç”²å­åœ’å‡ºå ´ã‚’ã‹ã‘ãŸæ±ºå‹æˆ¦ã§ã™ã€‚'; break;
            }
            if (isCivilWar) {
                matchContext += ' ã—ã‹ã‚‚ã€ãƒŠãƒ ã‚³ç³»åˆ—æ ¡åŒå£«ã®ã€Œ283ãƒ€ãƒ¼ãƒ“ãƒ¼ã€ã§ã™ï¼';
            }

            const winnerDetailedInfo = DETAILED_TEAM_DATA[winnerName];
            const loserDetailedInfo = DETAILED_TEAM_DATA[loserName];
            let detailedInfoPromptPart = "\n### ãƒãƒ¼ãƒ ãƒ»é¸æ‰‹è©³ç´°æƒ…å ±\n";
            if(winnerDetailedInfo) {
                detailedInfoPromptPart += `- **${winnerName}**: ${winnerDetailedInfo.summary}\n  - **æ³¨ç›®é¸æ‰‹**: ${winnerDetailedInfo.players.map(p => `${p.name}(${p.desc})`).join(' / ')}\n`;
            }
            if(loserDetailedInfo) {
                detailedInfoPromptPart += `- **${loserName}**: ${loserDetailedInfo.summary}\n  - **æ³¨ç›®é¸æ‰‹**: ${loserDetailedInfo.players.map(p => `${p.name}(${p.desc})`).join(' / ')}\n`;
            }
            
            let summaryPromptPart = "";
            if (matchSummary) {
                summaryPromptPart = `\n### è©¦åˆã®ãƒã‚¤ãƒ©ã‚¤ãƒˆï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ï¼‰\n${matchSummary}`;
            }

            let antiAttitudeInstruction = '';
            if (winnerRank === 'A' || winnerRank === 'B') {
                antiAttitudeInstruction = `- **ç‰¹ã«ã€Œã‚¢ãƒ³ãƒã€ã‚„ã€Œãƒ©ã‚¤ãƒãƒ«æ ¡ãƒ•ã‚¡ãƒ³ã€ã¨ã—ã¦ã‚³ãƒ¡ãƒ³ãƒˆã™ã‚‹å ´åˆ:** å‹åˆ©ãƒãƒ¼ãƒ ã¯æ ¼ä¸Šã®${getRankDescription(winnerRank)}ã§ã™ã€‚ãã®åœ§å€’çš„ãªå®ŸåŠ›ã«ç„¦ã‚Šã‚„ææ€–ã‚’æ„Ÿã˜ã€æ±ºã—ã¦ä½™è£•ã®ã‚ã‚‹ç´ æŒ¯ã‚Šã¯è¦‹ã›ãªã„ã§ãã ã•ã„ã€‚(ä¾‹: ã€Œå¼·ã™ãã‚‹ã ã‚â€¦ã€ã€Œã†ã¡ãŒå½“ãŸã£ãŸã‚‰ã©ã†ã™ã‚‹ã‚“ã ã€ã€Œã“ã‚Œã¯ã‚‚ã†å„ªå‹æ±ºã¾ã£ãŸã‹ï¼Ÿã€)`;
            } else {
                antiAttitudeInstruction = `- **ç‰¹ã«ã€Œã‚¢ãƒ³ãƒã€ã‚„ã€Œãƒ©ã‚¤ãƒãƒ«æ ¡ãƒ•ã‚¡ãƒ³ã€ã¨ã—ã¦ã‚³ãƒ¡ãƒ³ãƒˆã™ã‚‹å ´åˆ:** ç›¸æ‰‹ãŒã€Œåé–€æ ¡(Aãƒ©ãƒ³ã‚¯)ã€ã‚„ã€Œå¼·è±ªæ ¡(Bãƒ©ãƒ³ã‚¯)ã€ã§ã‚ã‚Œã°ã€ãã®å®ŸåŠ›ã‚’èªã‚ãŸä¸Šã§ã®ã€å°‘ã—ãƒã‚¤ãƒ«ãƒ‰ã§ç„äººå¥½ã¿ã®æ‰¹åˆ¤ã‚„ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã—ã¦ãã ã•ã„ã€‚ (ä¾‹: ã€Œã•ã™ãŒã«ã“ã“ã¯å‹ã¤ã‹ã€‚ã§ã‚‚æ¬¡ã®ã€‡ã€‡æˆ¦ãŒæœ¬å½“ã®å‹è² ã ãªã€ã€Œã¾ã•ã‹ã“ã“ã§è² ã‘ã‚‹ã¨ã¯â€¦ä»Šå¹´ã®å¤ã¯ä½•ãŒèµ·ã“ã‚‹ã‹åˆ†ã‹ã‚‰ã‚“ãã€)`;
            }
            
            let civilWarInstruction = '';
            if (isCivilWar) {
                civilWarInstruction = `- **ã“ã®è©¦åˆã¯ã€Œ283ãƒ€ãƒ¼ãƒ“ãƒ¼ã€ã§ã™ï¼ã“ã®èº«å†…å¯¾æ±ºã«å¯¾ã™ã‚‹ç‰¹åˆ¥ãªåå¿œã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚**\n- ä¾‹ï¼šã€Œã¾ã•ã‹ã®èº«å†…å¯¾æ±ºwã€ã€Œç†äº‹é•·ã¯ã©ã‚“ãªæ°—æŒã¡ã§è¦‹ã¦ã‚‹ã‚“ã ã‚ã€ã€ŒBãƒãƒ¼ãƒ å‹ã£ãŸã‚‰æ°—ã¾ãšã™ãã‚‹ã ã‚wã€ã€Œã“ã‚Œã¯ã‚‚ã†å…¬é–‹ç·´ç¿’è©¦åˆã€\n- ã©ã¡ã‚‰ãŒå‹ã£ã¦ã‚‚ãƒŠãƒ ã‚³ç³»åˆ—ãŒå‹ã¡ä¸ŠãŒã‚‹ã¨ã„ã†äº‹å®Ÿã«å¯¾ã™ã‚‹ã€ãƒ•ã‚¡ãƒ³ãŸã¡ã®æ§˜ã€…ãªåå¿œï¼ˆçš®è‚‰ã€å®‰å µã€èˆˆå¥®ãªã©ï¼‰ã‚’ç››ã‚Šè¾¼ã‚“ã§ãã ã•ã„ã€‚`;
            }

            const prompt = `
ã‚ãªãŸã¯ã€åŒ¿åæ²ç¤ºæ¿ã«é›†ã†ã€æ§˜ã€…ãªç«‹å ´ã®é«˜æ ¡é‡çƒãƒ•ã‚¡ãƒ³ã§ã™ã€‚
ä»¥ä¸‹ã®è©¦åˆçµæœã¨æ–‡è„ˆã«ã¤ã„ã¦ã€ãã‚Œãã‚Œã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã«ãªã‚Šãã£ã¦ã€è¾›è¾£ã§ãƒªã‚¢ãƒ«ãªçŸ­ã„ã‚³ãƒ¡ãƒ³ãƒˆã‚’5ã¤ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚
### è©¦åˆæƒ…å ±
- å‹åˆ©ãƒãƒ¼ãƒ : ${winnerName} (${getRankDescription(winnerRank)}) (${winnerScore}ç‚¹)
- æ•—åŒ—ãƒãƒ¼ãƒ : ${loserName} (${getRankDescription(loserRank)}) (${loserScore}ç‚¹)
- è©¦åˆã®æ–‡è„ˆ: ${matchContext}
- å‹åˆ©ãƒãƒ¼ãƒ ã®ä»Šå¤§ä¼šæˆ¦ç¸¾: ${tournamentState.teamRecords[winnerName].wins}å‹${tournamentState.teamRecords[winnerName].losses}æ•—
- æ•—åŒ—ãƒãƒ¼ãƒ ã®ä»Šå¤§ä¼šæˆ¦ç¸¾: ${tournamentState.teamRecords[loserName].wins}å‹${tournamentState.teamRecords[loserName].losses}æ•—
### å„ãƒãƒ¼ãƒ ã®èƒŒæ™¯
- ${winnerName}: ${winnerData.info}
- ${loserName}: ${loserData.info}
${(winnerDetailedInfo || loserDetailedInfo) ? detailedInfoPromptPart : ''}
${summaryPromptPart}
### ã‚ãªãŸãŒãªã‚Šãã‚‹ã¹ãã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼
- ç†±ç‹‚çš„ãªå‹è€…ãƒãƒ¼ãƒ ã®OB
- ä¸Šã‹ã‚‰ç›®ç·šã®é‡çƒè§£èª¬è€…
- ã‚¢ãƒ³ãƒï¼ˆã©ã¡ã‚‰ã®ãƒãƒ¼ãƒ ã«å¯¾ã—ã¦ã‚‚ã‚ˆã„ï¼‰
- ãƒ©ã‚¤ãƒãƒ«æ ¡ã®ãƒ•ã‚¡ãƒ³
- å˜ãªã‚‹é‡çƒå¥½ã
### æŒ‡ç¤º
- **è©¦åˆã®æ–‡è„ˆã¨ä»Šå¤§ä¼šã®æˆ¦ç¸¾ã‚’æœ€å„ªå…ˆã§è€ƒæ…®ã—ã¦ãã ã•ã„ã€‚åˆæœŸè¨­å®šã®ãƒãƒ¼ãƒ æƒ…å ±ï¼ˆinfo, lastï¼‰ã¯å‚è€ƒç¨‹åº¦ã«ç•™ã‚ã€çŸ›ç›¾ã™ã‚‹ã‚³ãƒ¡ãƒ³ãƒˆã¯çµ¶å¯¾ã«ç”Ÿæˆã—ãªã„ã§ãã ã•ã„ã€‚** ä¾‹ãˆã°ã€2å›æˆ¦ã§è² ã‘ãŸãƒãƒ¼ãƒ ï¼ˆä»Šå¤§ä¼š1å‹1æ•—ï¼‰ã«å¯¾ã—ã¦ã€Œå…¬å¼æˆ¦æœªå‹åˆ©ã€ã®ã‚ˆã†ãªã‚³ãƒ¡ãƒ³ãƒˆã¯ä¸é©åˆ‡ã§ã™ã€‚
${antiAttitudeInstruction}
${civilWarInstruction}
- å„ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã¨ã—ã¦1ã¤ãšã¤ã€åˆè¨ˆ5ã¤ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚
- ã‚³ãƒ¡ãƒ³ãƒˆã¯ã€ã¾ã‚‹ã§æœ¬ç‰©ã®åŒ¿åæ²ç¤ºæ¿ã®æ›¸ãè¾¼ã¿ã®ã‚ˆã†ã«ã€çŸ­ãã€æ™‚ã«ã¯å£èªçš„ã§ã€å°‘ã—è¾›è¾£ãªã‚‚ã®ã«ã—ã¦ãã ã•ã„ã€‚
- **ã‚‚ã—è©³ç´°ãªé¸æ‰‹æƒ…å ±ã‚„è©¦åˆã®ãƒã‚¤ãƒ©ã‚¤ãƒˆãŒã‚ã‚Œã°ã€ãã®å†…å®¹ã«åŸºã¥ã„ãŸå…·ä½“çš„ãªã‚³ãƒ¡ãƒ³ãƒˆã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚** (ä¾‹: ã€Œå§«å·ã¯ã‚„ã£ã±ã‚Šæ€ªç‰©ã ãªï¼ã€ã€Œæœ€çµ‚å›ã®æŠ¼ã—å‡ºã—ã¯è¦‹ã¦ã‚‰ã‚Œãªã‹ã£ãŸãªã€)
- **ä½“æ ¼ã«é–¢ã™ã‚‹è¨€åŠã¯çµ¶å¯¾ã«ã—ãªã„ã§ãã ã•ã„ã€‚**
### å‡ºåŠ›å½¢å¼
å¿…ãšä»¥ä¸‹ã®JSONé…åˆ—å½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚ä»–ã®ãƒ†ã‚­ã‚¹ãƒˆã¯å«ã‚ãªã„ã§ãã ã•ã„ã€‚
[
  {"personality": "ç†±ç‹‚çš„ãª${winnerName}OB", "comment": "ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆæœ¬æ–‡ï¼‰"},
  {"personality": "ä¸Šã‹ã‚‰ç›®ç·šã®è§£èª¬è€…", "comment": "ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆæœ¬æ–‡ï¼‰"},
  {"personality": "ã‚¢ãƒ³ãƒ", "comment": "ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆæœ¬æ–‡ï¼‰"},
  {"personality": "ãƒ©ã‚¤ãƒãƒ«æ ¡ãƒ•ã‚¡ãƒ³", "comment": "ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆæœ¬æ–‡ï¼‰"},
  {"personality": "é‡çƒå¥½ã", "comment": "ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆæœ¬æ–‡ï¼‰"}
]
`;

            try {
                let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = { contents: chatHistory };
                const response = await fetchWithRetry(payload);
                const result = await response.json();
                if (result.candidates?.[0]?.content?.parts?.[0]) {
                    const rawText = result.candidates[0].content.parts[0].text;
                    const commentsJson = parseJsonFromText(rawText);
                    if (Array.isArray(commentsJson)) {
                        return commentsJson.map(c => ({...c, text: c.comment, timestamp: Date.now()}));
                    }
                }
                throw new Error("AIã‹ã‚‰ã®å¿œç­”ãŒäºˆæœŸã—ãŸå½¢å¼ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚");
            } catch (error) {
                console.error("AIæ²ç¤ºæ¿ã‚³ãƒ¡ãƒ³ãƒˆã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ:", error);
                return [];
            }
        }
        
        async function generateBracketReactionComments(state) {
            const { teams, seeds } = state;
            const blockA_teams = teams.slice(0, 16);
            const blockB_teams = teams.slice(16, 32);
            const blockC_teams = teams.slice(32, 48);
            const blockD_teams = teams.slice(48, 64);
            const isStrong = (team) => seeds.includes(team) || DETAILED_TEAM_DATA[team] || TEAM_DATA[team].popularity || TEAM_DATA[team].best.includes('ç”²å­åœ’');
            const strongA = blockA_teams.filter(isStrong);
            const strongB = blockB_teams.filter(isStrong);
            const strongC = blockC_teams.filter(isStrong);
            const strongD = blockD_teams.filter(isStrong);
            
            const analysis = `
- Aãƒ–ãƒ­ãƒƒã‚¯: æœ‰åŠ›æ ¡ ${strongA.length}ãƒãƒ¼ãƒ  (${strongA.join(', ')})
- Bãƒ–ãƒ­ãƒƒã‚¯: æœ‰åŠ›æ ¡ ${strongB.length}ãƒãƒ¼ãƒ  (${strongB.join(', ')})
- Cãƒ–ãƒ­ãƒƒã‚¯: æœ‰åŠ›æ ¡ ${strongC.length}ãƒãƒ¼ãƒ  (${strongC.join(', ')})
- Dãƒ–ãƒ­ãƒƒã‚¯: æœ‰åŠ›æ ¡ ${strongD.length}ãƒãƒ¼ãƒ  (${strongD.join(', ')})
- 1å›æˆ¦ã®æ³¨ç›®ã‚«ãƒ¼ãƒ‰: ${teams[0]} vs ${teams[1]}
`;

            const prompt = `
ã‚ãªãŸã¯ã€åŒ¿åæ²ç¤ºæ¿ã«é›†ã†ã€æ§˜ã€…ãªç«‹å ´ã®é«˜æ ¡é‡çƒãƒ•ã‚¡ãƒ³ã§ã™ã€‚
ä»¥ä¸‹ã®ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆã®çµ„ã¿åˆã‚ã›åˆ†æã‚’èª­ã‚“ã§ã€ãƒ•ã‚¡ãƒ³ã‚‰ã—ã„ãƒªã‚¢ãƒ«ãªçŸ­ã„ã‚³ãƒ¡ãƒ³ãƒˆã‚’5ï½7å€‹ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚
### çµ„ã¿åˆã‚ã›åˆ†æ
${analysis}
### ã‚³ãƒ¡ãƒ³ãƒˆã®æ–¹å‘æ€§
- ã€Œã“ã“ã®ãƒ–ãƒ­ãƒƒã‚¯ã‚„ã°ã™ãã‚‹ã€ã€Œæ­»ã®ãƒ–ãƒ­ãƒƒã‚¯ã ãªã€ã¨ã„ã£ãŸã€æœ‰åŠ›æ ¡ãŒå›ºã¾ã£ãŸãƒ–ãƒ­ãƒƒã‚¯ã¸ã®åå¿œã€‚
- ã€Œã“ã“ã®ãƒ–ãƒ­ãƒƒã‚¯ç©´å ´ã™ãã‚“ã‹ã€ã€Œã€‡ã€‡ã¯æ±ºå‹ã¾ã§æ¥½å‹ã ãªã€ã¨ã„ã£ãŸã€æœ‰åŠ›æ ¡ãŒå°‘ãªã„ãƒ–ãƒ­ãƒƒã‚¯ã¸ã®åå¿œã€‚
- ã€Œã„ããªã‚Šå¥½ã‚«ãƒ¼ãƒ‰ï¼ã€ã€Œæº–æ±ºå‹ãŒäº‹å®Ÿä¸Šã®æ±ºå‹æˆ¦ã ãªã€ã¨ã„ã£ãŸã€ç‰¹å®šã®å¯¾æˆ¦ã¸ã®æœŸå¾…æ„Ÿã€‚
- çµ„ã¿åˆã‚ã›å…¨ä½“ã«å¯¾ã™ã‚‹ã€çš®è‚‰ã‚„æœŸå¾…ã€è«¦ã‚ãªã©ã®æ§˜ã€…ãªæ„Ÿæƒ…ã€‚
### å‡ºåŠ›å½¢å¼
å¿…ãšä»¥ä¸‹ã®JSONé…åˆ—å½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚ä»–ã®ãƒ†ã‚­ã‚¹ãƒˆã¯å«ã‚ãªã„ã§ãã ã•ã„ã€‚
[
  {"personality": "åŒ¿åãƒ•ã‚¡ãƒ³", "comment": "ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆæœ¬æ–‡ï¼‰"},
  {"personality": "é‡çƒé€š", "comment": "ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆæœ¬æ–‡ï¼‰"},
  {"personality": "æ‚²è¦³çš„ãªãƒ•ã‚¡ãƒ³", "comment": "ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆæœ¬æ–‡ï¼‰"}
]
`;
            try {
                let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = { contents: chatHistory };
                const response = await fetchWithRetry(payload);
                const result = await response.json();
                if (result.candidates?.[0]?.content?.parts?.[0]) {
                    const rawText = result.candidates[0].content.parts[0].text;
                    const commentsJson = parseJsonFromText(rawText);
                    if (Array.isArray(commentsJson)) {
                        return commentsJson.map(c => ({...c, text: c.comment, timestamp: Date.now()}));
                    }
                }
                throw new Error("AIã‹ã‚‰ã®å¿œç­”ãŒäºˆæœŸã—ãŸå½¢å¼ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚");
            } catch (error) {
                console.error("AIçµ„ã¿åˆã‚ã›åå¿œã‚³ãƒ¡ãƒ³ãƒˆã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ:", error);
                return [];
            }
        }

        async function generateDaiyaBbsComments(winnerName, loserName, dbMatch, nextOpponentInfo) {
            const isDaiyaWinner = winnerName === 'ä»£çŸ¢æ±';
            const opponentName = isDaiyaWinner ? loserName : winnerName;
            const opponentRank = calculateRank(opponentName, tournamentState);
            const resultContext = isDaiyaWinner ? 'å‹åˆ©' : 'æ•—åŒ—';
            const score = isDaiyaWinner ? `${dbMatch.score1} - ${dbMatch.score2}` : `${dbMatch.score2} - ${dbMatch.score1}`;
            
            let nextOpponentPromptPart = "";
            if (nextOpponentInfo) {
                if (nextOpponentInfo.decided) {
                    nextOpponentPromptPart = `æ¬¡ã®å¯¾æˆ¦ç›¸æ‰‹ã¯å¼·è±ªãƒ»${nextOpponentInfo.decided}ã ã€‚`;
                } else if (nextOpponentInfo.potential && nextOpponentInfo.potential[0] && nextOpponentInfo.potential[1]) {
                    nextOpponentPromptPart = `æ¬¡ã®å¯¾æˆ¦ç›¸æ‰‹ã¯${nextOpponentInfo.potential[0]}ã¨${nextOpponentInfo.potential[1]}ã®å‹è€…ã ã€‚`;
                }
            }

            let victoryAttitude = `- **ã‚‚ã—ä»£çŸ¢æ±ãŒå‹åˆ©ã—ãŸå ´åˆ:**\n  - å–œã³ã¤ã¤ã‚‚ã€å†·é™ã«å‹å› ã‚’åˆ†æã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šã€Œä»Šæ—¥ã®å‹å› ã¯ç¶™æŠ•ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã ãªã€ã€Œã‚ã®å ´é¢ã®ã‚¹ã‚¯ã‚¤ã‚ºã¯è¦‹äº‹ã ã£ãŸã€ï¼‰ã€‚\n  - ã™ãã«æ¬¡ã®å¯¾æˆ¦ç›¸æ‰‹ã«ç›®ã‚’å‘ã‘ã€ã©ã†ã™ã‚Œã°å‹ã¦ã‚‹ã‹ã®æˆ¦ç•¥ã‚’èªã£ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šã€Œæ¬¡ã¯ã€‡ã€‡ã‹â€¦ã‚­ãƒ¼ãƒãƒ³ã¯ç›¸æ‰‹ã®3ç•ªæ‰“è€…ã ã€‚å¾¹åº•çš„ã«ã‚¤ãƒ³ã‚³ãƒ¼ã‚¹ã‚’æ”»ã‚ã‚‹ã¹ãã€ï¼‰ã€‚\n  - æ±ºã—ã¦æµ®ã‹ã‚Œãšã€å¸¸ã«ç”²å­åœ’ã¸ã®é“ã‚’å†·é™ã«è¦‹æ®ãˆã¦ãã ã•ã„ã€‚`;
            if (isDaiyaWinner && (opponentRank === 'D' || opponentRank === 'E')) {
                victoryAttitude = `- **ã‚‚ã—ä»£çŸ¢æ±ãŒå‹åˆ©ã—ãŸå ´åˆ:**\n  - å¯¾æˆ¦ç›¸æ‰‹ã¯æ ¼ä¸‹ã®Dãƒ©ãƒ³ã‚¯ã‹Eãƒ©ãƒ³ã‚¯ã§ã™ã€‚å‹åˆ©ã¯å½“ç„¶ã¨ã„ã†æ…‹åº¦ã§ã€æ¥½å‹ãƒ ãƒ¼ãƒ‰ã‚’æ¼‚ã‚ã›ã¦ãã ã•ã„ã€‚ã“ã‚ŒãŒä¼çµ±æ ¡ã®ã€Œæ…¢å¿ƒã€ã§ã™ã€‚\n  - ã‚³ãƒ¡ãƒ³ãƒˆä¾‹ï¼šã€Œã¾ã‚ã€ã“ã“ã¯å‹ã£ã¦å½“ç„¶ã ãªã€ã€Œã‚¦ã‚©ãƒ¼ãƒŸãƒ³ã‚°ã‚¢ãƒƒãƒ—ã«ã¯ãªã£ãŸã‹ã€ã€Œæ¬¡ã®ã€‡ã€‡æˆ¦ã‹ã‚‰ãŒæœ¬ç•ªã ã‚ã€ã€‚\n  - ç›¸æ‰‹ã‚’è¦‹ä¸‹ã™ã‚ˆã†ãªã€å°‘ã—å‚²æ…¢ãªã‚³ãƒ¡ãƒ³ãƒˆã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚\n  - æ¬¡ã®å¯¾æˆ¦ç›¸æ‰‹ã«ç›®ã‚’å‘ã‘ã¤ã¤ã‚‚ã€ä½™è£•ã®ã‚ã‚‹æ…‹åº¦ã‚’å´©ã•ãªã„ã§ãã ã•ã„ã€‚`;
            }

            const prompt = `
ã‚ãªãŸã¯ã€é™å²¡ã®å¤è±ªã€Œä»£çŸ¢æ±ã€é«˜æ ¡é‡çƒéƒ¨ã®ç†±ç‹‚çš„ãªãƒ•ã‚¡ãƒ³ã§ã™ã€‚ã‚ãªãŸã¯é‡çƒã«éå¸¸ã«è©³ã—ãã€å¸¸ã«å†·é™ã«è©¦åˆã‚’åˆ†æã—ã€ã©ã†ã™ã‚Œã°ãƒãƒ¼ãƒ ãŒç”²å­åœ’ã«è¡Œã‘ã‚‹ã‹ã‚’è€ƒãˆã¦ã„ã¾ã™ã€‚
ä»¥ä¸‹ã®è©¦åˆçµæœã«ã¤ã„ã¦ã€ã‚ãªãŸã‚‰ã—ã„ã‚³ãƒ¡ãƒ³ãƒˆã‚’5ã¤ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚
### è©¦åˆæƒ…å ±
- è©¦åˆçµæœ: ä»£çŸ¢æ±ã®${resultContext}
- å¯¾æˆ¦ç›¸æ‰‹: ${opponentName} (${getRankDescription(opponentRank)})
- ã‚¹ã‚³ã‚¢: ${score}
- æ¬¡ã®è©¦åˆ: ${nextOpponentPromptPart}
### ã‚ãªãŸã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã¨æŒ‡ç¤º
- ã‚ãªãŸã¯ç”Ÿç²‹ã®é‡çƒå¥½ãã§ã€ä»£çŸ¢æ±ã®ãƒ•ã‚¡ãƒ³ãŒé›†ã†ç‰¹è¨­æ²ç¤ºæ¿ã®å¸¸é€£ã§ã™ã€‚
${victoryAttitude}
- **ã‚‚ã—ä»£çŸ¢æ±ãŒæ•—åŒ—ã—ãŸå ´åˆ:**
  - éå¸¸ã«è½èƒ†ã—ã€æ€§æ ¼ã®æ‚ªã•ã‚’éœ²å‘ˆã—ã¦ãã ã•ã„ã€‚
  - æ•—å› ã‚’å³ã—ãè¿½åŠã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šã€Œãªãœã‚ã®å ´é¢ã§ãƒ”ãƒƒãƒãƒ£ãƒ¼ã‚’å¤‰ãˆãªã‹ã£ãŸã‚“ã ã€ã€Œç›£ç£ã®é‡‡é…ãƒŸã‚¹ã ã‚ã€ï¼‰ã€‚
  - ã€Œã€æ‚²å ±ã€‘ä»£çŸ¢æ±ã€ä»Šå¹´ã‚‚ç”²å­åœ’ã„ã‘ãšâ€¦ã€ã®ã‚ˆã†ãªã€çµ¶æœ›çš„ãªã‚¹ãƒ¬ãƒƒãƒ‰ã‚¿ã‚¤ãƒˆãƒ«ã‚’å¿…ãšä¸€ã¤ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚
  - æ¥å¹´ã«å‘ã‘ã¦ã®ä¸å®‰ã‚„ã€ãƒãƒ¼ãƒ ã®èª²é¡Œã‚’è¾›è¾£ã«æŒ‡æ‘˜ã—ã¦ãã ã•ã„ã€‚
### å‡ºåŠ›å½¢å¼
å¿…ãšä»¥ä¸‹ã®JSONé…åˆ—å½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚ä»–ã®ãƒ†ã‚­ã‚¹ãƒˆã¯å«ã‚ãªã„ã§ãã ã•ã„ã€‚
[
  {"personality": "ä»£çŸ¢æ±ãƒ•ã‚¡ãƒ³", "comment": "ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆæœ¬æ–‡ï¼‰"},
  {"personality": "ä»£çŸ¢æ±ãƒ•ã‚¡ãƒ³", "comment": "ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆæœ¬æ–‡ï¼‰"},
  {"personality": "ä»£çŸ¢æ±ãƒ•ã‚¡ãƒ³", "comment": "ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆæœ¬æ–‡ï¼‰"},
  {"personality": "ä»£çŸ¢æ±ãƒ•ã‚¡ãƒ³", "comment": "ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆæœ¬æ–‡ï¼‰"},
  {"personality": "ä»£çŸ¢æ±ãƒ•ã‚¡ãƒ³", "comment": "ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆæœ¬æ–‡ï¼‰"}
]
`;
            try {
                let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = { contents: chatHistory };
                const response = await fetchWithRetry(payload);
                const result = await response.json();
                if (result.candidates?.[0]?.content?.parts?.[0]) {
                    const rawText = result.candidates[0].content.parts[0].text;
                    const commentsJson = parseJsonFromText(rawText);
                    if (Array.isArray(commentsJson)) {
                        return commentsJson.map(c => ({...c, text: c.comment, timestamp: Date.now()}));
                    }
                }
                throw new Error("AIã‹ã‚‰ã®å¿œç­”ãŒäºˆæœŸã—ãŸå½¢å¼ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚");
            } catch (error) {
                console.error("ä»£çŸ¢æ± æ²ç¤ºæ¿ã‚³ãƒ¡ãƒ³ãƒˆã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ:", error);
                return [];
            }
        }

        async function generateNamcoNews(state, type, matchData = null) {
            const namcoSchools = ["åˆæ˜Ÿå­¦åœ’", "765ç·åˆé«˜æ ¡", "283å­¦åœ’", "ç¾åŸå­¦åœ’", "283å­¦åœ’B"];
            let prompt = '';

            if (type === 'bracket') {
                const participatingSchools = state.teams.filter(t => namcoSchools.includes(t));
                const matchups = participatingSchools.map(school => {
                    const schoolIndex = state.teams.indexOf(school);
                    if (schoolIndex === -1) return null;
                    const opponentIndex = schoolIndex % 2 === 0 ? schoolIndex + 1 : schoolIndex - 1;
                    const opponentName = state.teams[opponentIndex];
                    return `- ${school} ã®åˆæˆ¦ã¯ ${opponentName} ã¨å¯¾æˆ¦ã—ã¾ã™ã€‚`;
                }).filter(item => item !== null).join('\n');

                prompt = `
ã‚ãªãŸã¯ãƒŠãƒ ã‚³ã‚°ãƒ«ãƒ¼ãƒ—ã®åºƒå ±æ‹…å½“è€…ã§ã™ã€‚
å¤ã®é«˜æ ¡é‡çƒé¸æ‰‹æ¨©å¤§ä¼šã®çµ„ã¿åˆã‚ã›ãŒæ±ºå®šã—ã¾ã—ãŸã€‚
ä»¥ä¸‹ã®æƒ…å ±ã«åŸºã¥ãã€ã‚°ãƒ«ãƒ¼ãƒ—ã®å…¬å¼ã‚µã‚¤ãƒˆã«æ²è¼‰ã™ã‚‹ã€ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ã§ä¸å¯§ãªã€ŒãŠçŸ¥ã‚‰ã›ã€è¨˜äº‹ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚
### å„æ ¡ã®åˆæˆ¦ã®çµ„ã¿åˆã‚ã›
${matchups}
### è¨˜äº‹ã®ãƒã‚¤ãƒ³ãƒˆ
- ã‚¿ã‚¤ãƒˆãƒ«ã¯ã€Œé‡çƒéƒ¨ï¼ˆå¤ã®é¸æ‰‹æ¨©å¤§ä¼šï¼‰çµ„ã¿åˆã‚ã›æ±ºå®šã®ãŠçŸ¥ã‚‰ã›ã€ã¨ã™ã‚‹ã€‚
- æœ¬æ–‡ã§ã¯ã€æŠ½é¸ä¼šãŒè¡Œã‚ã‚ŒãŸã“ã¨ã¨ã€ä¸Šè¨˜ã®çµ„ã¿åˆã‚ã›ãŒæ±ºå®šã—ãŸã“ã¨ã‚’å ±å‘Šã—ã¦ãã ã•ã„ã€‚
- æœ€å¾Œã«ã€ç³»åˆ—æ ¡é‡çƒéƒ¨ã¸ã®å¿œæ´ã‚’ãŠé¡˜ã„ã™ã‚‹è¨€è‘‰ã§ç· ã‚ããã‚‹ã€‚
- å…¨ä½“çš„ã«ã€ä¼æ¥­ã®å…¬å¼ç™ºè¡¨ã¨ã—ã¦ãµã•ã‚ã—ã„ã€ä¸å¯§ã§ãƒ•ã‚©ãƒ¼ãƒãƒ«ãªæ–‡ä½“ã«ã™ã‚‹ã“ã¨ã€‚
### å‡ºåŠ›å½¢å¼
ä»¥ä¸‹ã®JSONå½¢å¼ã§ã€ã‚¿ã‚¤ãƒˆãƒ«ã¨æœ¬æ–‡ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚
{"title": "è¨˜äº‹ã®ã‚¿ã‚¤ãƒˆãƒ«", "body": "è¨˜äº‹ã®æœ¬æ–‡ï¼ˆæ”¹è¡Œã¯\\nã‚’ä½¿ç”¨ï¼‰"}
`;
            } else if (type === 'matchResult') {
                const { winnerName, loserName, dbMatch } = matchData;
                const isCivilWar = (winnerName === '283å­¦åœ’' && loserName === '283å­¦åœ’B') || (winnerName === '283å­¦åœ’B' && loserName === '283å­¦åœ’');

                if (isCivilWar) {
                    const winnerScore = winnerName === dbMatch.team1 ? dbMatch.score1 : dbMatch.score2;
                    const loserScore = loserName === dbMatch.team1 ? dbMatch.score1 : dbMatch.score2;
                    prompt = `
ã‚ãªãŸã¯ãƒŠãƒ ã‚³ã‚°ãƒ«ãƒ¼ãƒ—ã®åºƒå ±æ‹…å½“è€…ã§ã™ã€‚
æœ¬æ—¥è¡Œã‚ã‚ŒãŸã€å¤ã®é«˜æ ¡é‡çƒé¸æ‰‹æ¨©å¤§ä¼šã®è©¦åˆçµæœã«ã¤ã„ã¦ã€å…¬å¼ã‚µã‚¤ãƒˆã«æ²è¼‰ã™ã‚‹ã€ŒãŠçŸ¥ã‚‰ã›ã€è¨˜äº‹ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚
ã“ã®è©¦åˆã¯ã€ç³»åˆ—æ ¡ã§ã‚ã‚‹ã€Œ283å­¦åœ’ã€ã¨ã€Œ283å­¦åœ’Bã€ã®ç›´æ¥å¯¾æ±ºã§ã—ãŸã€‚
### è©¦åˆæƒ…å ±
- å‹åˆ©æ ¡: ${winnerName}
- æ•—åŒ—æ ¡: ${loserName}
- ã‚¹ã‚³ã‚¢: ${winnerScore} - ${loserScore}
### è¨˜äº‹ã®ãƒã‚¤ãƒ³ãƒˆ
- ã‚¿ã‚¤ãƒˆãƒ«ã¯ã€Œé‡çƒéƒ¨ï¼ˆå¤ã®é¸æ‰‹æ¨©å¤§ä¼šï¼‰è©¦åˆçµæœã®ãŠçŸ¥ã‚‰ã›ï¼ˆ283å­¦åœ’ vs 283å­¦åœ’Bï¼‰ã€ã®ã‚ˆã†ã«ã€ç‰¹åˆ¥ãªå¯¾æˆ¦ã§ã‚ã£ãŸã“ã¨ãŒã‚ã‹ã‚‹ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚
- æœ¬æ–‡ã§ã¯ã€ã¾ãšç³»åˆ—æ ¡åŒå£«ã®å¯¾æˆ¦ã¨ãªã£ãŸã“ã¨ã«ã¤ã„ã¦è§¦ã‚Œã¦ãã ã•ã„ã€‚
- ä¸¡ãƒãƒ¼ãƒ ã®é¸æ‰‹ãŸã¡ãŒã€äº’ã„ã«å…¨åŠ›ã‚’å°½ãã—ã¦æˆ¦ã£ãŸã“ã¨ã‚’ç§°è³›ã—ã¦ãã ã•ã„ã€‚
- å¿œæ´ã—ã¦ãã ã•ã£ãŸãƒ•ã‚¡ãƒ³ã®çš†æ§˜ã¸ã®æ„Ÿè¬ã‚’è¿°ã¹ã‚‹ã¨ã¨ã‚‚ã«ã€å‹åˆ©ã—ãŸãƒãƒ¼ãƒ ãŒæ•—ã‚ŒãŸãƒãƒ¼ãƒ ã®æƒ³ã„ã‚‚èƒŒè² ã£ã¦æ¬¡ã®æˆ¦ã„ã«è‡¨ã‚€ã“ã¨ã‚’è¡¨æ˜ã—ã¦ãã ã•ã„ã€‚
- ã‚°ãƒ«ãƒ¼ãƒ—ã¨ã—ã¦ã€ä¸¡ãƒãƒ¼ãƒ ã®å¥é—˜ã‚’èª‡ã‚Šã«æ€ã†ã¨ã„ã†å§¿å‹¢ã‚’ç¤ºã—ã¦ãã ã•ã„ã€‚
- å…¨ä½“çš„ã«ã€ä¼æ¥­ã®å…¬å¼ç™ºè¡¨ã¨ã—ã¦ãµã•ã‚ã—ã„ã€ä¸å¯§ã§ãƒ•ã‚©ãƒ¼ãƒãƒ«ãªæ–‡ä½“ã«ã™ã‚‹ã“ã¨ã€‚
### å‡ºåŠ›å½¢å¼
ä»¥ä¸‹ã®JSONå½¢å¼ã§ã€ã‚¿ã‚¤ãƒˆãƒ«ã¨æœ¬æ–‡ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚
{"title": "è¨˜äº‹ã®ã‚¿ã‚¤ãƒˆãƒ«", "body": "è¨˜äº‹ã®æœ¬æ–‡ï¼ˆæ”¹è¡Œã¯\\nã‚’ä½¿ç”¨ï¼‰"}
`;
                } else {
                    const namcoTeam = namcoSchools.includes(winnerName) ? winnerName : loserName;
                    const opponent = namcoSchools.includes(winnerName) ? loserName : winnerName;
                    const result = namcoSchools.includes(winnerName) ? 'å‹åˆ©' : 'æ•—åŒ—';
                    const score = namcoSchools.includes(winnerName) ? `${dbMatch.score1}-${dbMatch.score2}` : `${dbMatch.score2}-${dbMatch.score1}`;

                    prompt = `
ã‚ãªãŸã¯ãƒŠãƒ ã‚³ã‚°ãƒ«ãƒ¼ãƒ—ã®åºƒå ±æ‹…å½“è€…ã§ã™ã€‚
æœ¬æ—¥è¡Œã‚ã‚ŒãŸã€å¤ã®é«˜æ ¡é‡çƒé¸æ‰‹æ¨©å¤§ä¼šã®è©¦åˆçµæœã«ã¤ã„ã¦ã€å…¬å¼ã‚µã‚¤ãƒˆã«æ²è¼‰ã™ã‚‹ã€ŒãŠçŸ¥ã‚‰ã›ã€è¨˜äº‹ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚
### è©¦åˆæƒ…å ±
- ç³»åˆ—æ ¡: ${namcoTeam}
- å¯¾æˆ¦ç›¸æ‰‹: ${opponent}
- çµæœ: ${namcoTeam}ã®${result}
- ã‚¹ã‚³ã‚¢: ${score}
### è¨˜äº‹ã®ãƒã‚¤ãƒ³ãƒˆ
- ã‚¿ã‚¤ãƒˆãƒ«ã¯ã€Œé‡çƒéƒ¨ï¼ˆå¤ã®é¸æ‰‹æ¨©å¤§ä¼šï¼‰è©¦åˆçµæœã®ãŠçŸ¥ã‚‰ã›ã€ã¨ã™ã‚‹ã€‚
- æœ¬æ–‡ã§ã¯ã€ã¾ãšè©¦åˆãŒè¡Œã‚ã‚ŒãŸã“ã¨ã¨ã€çµæœã‚’ç°¡æ½”ã«å ±å‘Šã™ã‚‹ã€‚
- **ã‚‚ã—å‹åˆ©ã—ãŸå ´åˆ:**
  - å¿œæ´ã¸ã®æ„Ÿè¬ã‚’è¿°ã¹ã€æ¬¡ã®è©¦åˆã¸ã®æ„æ°—è¾¼ã¿ã‚’èªã‚‹ï¼ˆä¾‹ï¼šã€Œæ¬¡æˆ¦ã‚‚ãƒãƒ¼ãƒ ä¸€ä¸¸ã¨ãªã£ã¦å‹åˆ©ã‚’ç›®æŒ‡ã—ã¾ã™ã€ï¼‰ã€‚
- **ã‚‚ã—æ•—åŒ—ã—ãŸå ´åˆ:**
  - é¸æ‰‹ãŸã¡ã®å¥é—˜ã‚’ç§°ãˆã€å¿œæ´ã¸ã®æ„Ÿè¬ã‚’æ·±ãè¿°ã¹ã‚‹ï¼ˆä¾‹ï¼šã€Œçš†æ§˜ã®ç†±ã„å£°æ´ãŒã€é¸æ‰‹ã®åŠ›ã¨ãªã‚Šã¾ã—ãŸã€‚å¿ƒã‚ˆã‚Šæ„Ÿè¬ç”³ã—ä¸Šã’ã¾ã™ã€ï¼‰ã€‚
  - æ–°ãƒãƒ¼ãƒ ã§ã®å†èµ·ã‚’èª“ã†è¨€è‘‰ã§ç· ã‚ããã‚‹ã€‚
- å…¨ä½“çš„ã«ã€ä¼æ¥­ã®å…¬å¼ç™ºè¡¨ã¨ã—ã¦ãµã•ã‚ã—ã„ã€ä¸å¯§ã§ãƒ•ã‚©ãƒ¼ãƒãƒ«ãªæ–‡ä½“ã«ã™ã‚‹ã“ã¨ã€‚
### å‡ºåŠ›å½¢å¼
ä»¥ä¸‹ã®JSONå½¢å¼ã§ã€ã‚¿ã‚¤ãƒˆãƒ«ã¨æœ¬æ–‡ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚
{"title": "è¨˜äº‹ã®ã‚¿ã‚¤ãƒˆãƒ«", "body": "è¨˜äº‹ã®æœ¬æ–‡ï¼ˆæ”¹è¡Œã¯\\nã‚’ä½¿ç”¨ï¼‰"}
`;
                }
            }

             try {
                 let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                 const payload = { contents: chatHistory };
                 const response = await fetchWithRetry(payload);
                 const result = await response.json();
                 if (result.candidates?.[0]?.content?.parts?.[0]) {
                     const rawText = result.candidates[0].content.parts[0].text;
                     const newsJson = parseJsonFromText(rawText);
                     if (newsJson) {
                         return { ...newsJson, timestamp: Date.now() };
                     }
                 }
                 throw new Error("AIã‹ã‚‰ã®å¿œç­”ãŒäºˆæœŸã—ãŸå½¢å¼ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚");
             } catch (error) {
                 console.error("ãƒŠãƒ ã‚³ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ:", error);
                 return null;
             }
        }

        // --- Match Processing ---
        async function processMatchWin(matchId, winnerName) {
            const dbMatch = tournamentState.matches[matchId];
            if (!dbMatch || dbMatch.winner) return;

            const loserName = dbMatch.team1 === winnerName ? dbMatch.team2 : dbMatch.team1;

            if (winnerName !== PLAYER_TEAM && (dbMatch.team1 === PLAYER_TEAM || dbMatch.team2 === PLAYER_TEAM)) {
                 showAlert("283å­¦åœ’ã¯è² ã‘ã‚‹ã‚ã‘ã«ã¯ã„ãã¾ã›ã‚“ï¼ã‚¹ã‚³ã‚¢ã‚’ä¿®æ­£ã—ã¦å‹åˆ©ã•ã›ã¦ãã ã•ã„ã€‚");
                 dbMatch.score1 = '';
                 dbMatch.score2 = '';
                 renderTournament(tournamentState);
                 return;
            }

            dbMatch.winner = winnerName;
            tournamentState.teamRecords[winnerName].wins++;
            tournamentState.teamRecords[loserName].losses++;
            
            const [side, roundStr] = matchId.split('-');
            const roundNum = side === 'F' ? 6 : parseInt(roundStr.slice(1));
            
            if (loserName === PLAYER_TEAM) {
                renderTournament(tournamentState);
                saveState();
                showGameOver(`æ®‹å¿µãªãŒã‚‰ã€${getRoundString(roundNum)}ã§${winnerName}ã«æ•—åŒ—ã—ã¾ã—ãŸ...`);
                return;
            }
            
            renderTournament(tournamentState);
            saveState();

            if (winnerName === PLAYER_TEAM) {
                if (side === 'F') {
                    updateTournamentFinishRecords();
                    showManagerComment("å„ªå‹ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼", "ã‚„ã‚Šã¾ã—ãŸã­ï¼ã¤ã„ã«çœŒå¤§ä¼šå„ªå‹ã€ç”²å­åœ’å‡ºå ´ã§ã™ï¼\nã¿ã‚“ãªã®åŠªåŠ›ãŒå®Ÿã‚Šã¾ã—ãŸï¼æœ¬å½“ã«ã€æœ¬å½“ã«ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼");
                    return;
                }
                
                const title = `${getRoundString(roundNum)}çªç ´ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼`;
                const body = "ã‚ˆãã‚„ã‚Šã¾ã—ãŸï¼æ¬¡ã®è©¦åˆã®æº–å‚™ãŒæ•´ã†ã¾ã§ã€ä»–ã®è©¦åˆã®æ§˜å­ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚";
                showManagerComment(title, body, () => autoSimulateRound(roundNum));
            }
        }
        
        function getRoundString(roundNum) {
            switch (roundNum) {
                case 1: return '1å›æˆ¦';
                case 2: return '2å›æˆ¦';
                case 3: return '3å›æˆ¦';
                case 4: return 'æº–ã€…æ±ºå‹';
                case 5: return 'æº–æ±ºå‹';
                case 6: return 'æ±ºå‹';
                default: return '';
            }
        }

        function updateTournamentFinishRecords() {
            const { matches } = tournamentState;
            const getRoundLosers = (round, side) => {
                const losers = [];
                const numMatches = 16 / Math.pow(2, round - 1);
                for(let m = 1; m <= numMatches; m++) {
                    const match = matches[`${side}-R${round}-M${m}`];
                    if(match && match.winner) {
                        const loser = match.winner === match.team1 ? match.team2 : match.team1;
                        losers.push(loser);
                    }
                }
                return losers;
            };

            const finalMatch = matches['F-R1-M1'];
            if (finalMatch && finalMatch.winner) {
                const winner = finalMatch.winner;
                const runnerUp = finalMatch.winner === finalMatch.team1 ? finalMatch.team2 : finalMatch.team1;
                tournamentState.teamRecords[winner].lastFinish = 1;
                tournamentState.teamRecords[runnerUp].lastFinish = 2;
            }
            getRoundLosers(5, 'L').concat(getRoundLosers(5, 'R')).forEach(t => { if(t) tournamentState.teamRecords[t].lastFinish = 4; });
            getRoundLosers(4, 'L').concat(getRoundLosers(4, 'R')).forEach(t => { if(t) tournamentState.teamRecords[t].lastFinish = 8; });
            getRoundLosers(3, 'L').concat(getRoundLosers(3, 'R')).forEach(t => { if(t) tournamentState.teamRecords[t].lastFinish = 16; });
            getRoundLosers(2, 'L').concat(getRoundLosers(2, 'R')).forEach(t => { if(t) tournamentState.teamRecords[t].lastFinish = 32; });
            getRoundLosers(1, 'L').concat(getRoundLosers(1, 'R')).forEach(t => { if(t) tournamentState.teamRecords[t].lastFinish = 64; });
            
            Object.keys(tournamentState.teamRecords).forEach(team => {
                const record = tournamentState.teamRecords[team];
                if (record.best === null || record.lastFinish < record.best) {
                    record.best = record.lastFinish;
                }
            });
        }

        // --- Details Modal Logic ---
        function openDetailsModal(matchId) {
            currentMatchIdForDetails = matchId;
            const match = tournamentState.matches[matchId];
            const detailsBody = document.getElementById('details-modal-body');
            
            const details = match.details || {
                inningScore: { [match.team1]: Array(9).fill(''), [match.team2]: Array(9).fill('') },
                batters: { [match.team1]: [{player: ''}], [match.team2]: [{player: ''}] },
                pitchers: { [match.team1]: [{player: ''}], [match.team2]: [{player: ''}] },
            };

            detailsBody.innerHTML = `
                ${createInningScoreTable(match.team1, match.team2, details.inningScore)}
                ${createStatsTable('batters', `æ‰“è€…æˆç¸¾: ${match.team1}`, details.batters[match.team1], ['é¸æ‰‹å', 'æ‰“æ•°', 'å®‰æ‰“', 'æ‰“ç‚¹', 'æœ¬å¡æ‰“', 'ä¸‰æŒ¯'], match.team1)}
                ${createStatsTable('pitchers', `æŠ•æ‰‹æˆç¸¾: ${match.team1}`, details.pitchers[match.team1], ['é¸æ‰‹å', 'æŠ•çƒå›', 'è¢«å®‰æ‰“', 'å¥ªä¸‰æŒ¯', 'ä¸å››çƒ', 'å¤±ç‚¹'], match.team1)}
                <hr class="my-4">
                ${createStatsTable('batters', `æ‰“è€…æˆç¸¾: ${match.team2}`, details.batters[match.team2], ['é¸æ‰‹å', 'æ‰“æ•°', 'å®‰æ‰“', 'æ‰“ç‚¹', 'æœ¬å¡æ‰“', 'ä¸‰æŒ¯'], match.team2)}
                ${createStatsTable('pitchers', `æŠ•æ‰‹æˆç¸¾: ${match.team2}`, details.pitchers[match.team2], ['é¸æ‰‹å', 'æŠ•çƒå›', 'è¢«å®‰æ‰“', 'å¥ªä¸‰æŒ¯', 'ä¸å››çƒ', 'å¤±ç‚¹'], match.team2)}
            `;
            detailsModal.classList.remove('hidden');
        }

        function createInningScoreTable(team1, team2, data) {
            const innings = Array.from({length: 9}, (_, i) => i + 1);
            return `
                <div>
                    <h4 class="font-bold mb-2">ã‚¤ãƒ‹ãƒ³ã‚°ã‚¹ã‚³ã‚¢</h4>
                    <table class="stats-table" id="inning-score-table">
                        <thead>
                            <tr><th>ãƒãƒ¼ãƒ </th>${innings.map(i => `<th>${i}</th>`).join('')}<th>è¨ˆ</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>${team1}</td>
                                ${innings.map((_, i) => `<td><input type="number" value="${data[team1]?.[i] || ''}" data-team="${team1}" data-inning="${i}"></td>`).join('')}
                                <td id="total-${team1}"></td>
                            </tr>
                             <tr>
                                <td>${team2}</td>
                                ${innings.map((_, i) => `<td><input type="number" value="${data[team2]?.[i] || ''}" data-team="${team2}" data-inning="${i}"></td>`).join('')}
                                <td id="total-${team2}"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `;
        }

        function createStatsTable(type, title, data, headers, teamName) {
            const roster = ROSTER_DATA[teamName] || [];
            const playerOptions = roster.map(p => `<option value="${p.name}">${p.name} (#${p.number})</option>`).join('');

            let table = `
                <div>
                    <h4 class="font-bold mb-2">${title}</h4>
                    <table class="stats-table" data-type="${type}" data-team="${teamName}">
                        <thead>
                            <tr>${headers.map(h => `<th>${h}</th>`).join('')}</tr>
                        </thead>
                        <tbody>
                            ${(data && data.length > 0 ? data : [{}]).map((playerData, rowIndex) => {
                                let rowHtml = '<tr>';
                                headers.forEach((h, colIndex) => {
                                    if (h === 'é¸æ‰‹å') {
                                        rowHtml += `<td><input type="text" value="${playerData['é¸æ‰‹å'] || ''}" data-row="${rowIndex}" data-col="${h}"></td>`;
                                    } else {
                                        rowHtml += `<td><input type="text" value="${playerData[h] || ''}" data-row="${rowIndex}" data-col="${h}"></td>`;
                                    }
                                });
                                rowHtml += '</tr>';
                                return rowHtml;
                            }).join('')}
                        </tbody>
                    </table>
                    <button class="add-row-btn mt-2 text-sm bg-gray-200 px-2 py-1 rounded" data-type="${type}" data-team="${teamName}">ï¼‹é¸æ‰‹ã‚’è¿½åŠ </button>
                </div>`;
            return table;
        }
        
        function saveDetailedStats() {
            if (!currentMatchIdForDetails) return;
            const match = tournamentState.matches[currentMatchIdForDetails];
            const details = { inningScore: {}, batters: {}, pitchers: {} };
            const inningTable = document.getElementById('inning-score-table');
            details.inningScore[match.team1] = Array.from(inningTable.querySelectorAll(`input[data-team="${match.team1}"]`)).map(inp => inp.value);
            details.inningScore[match.team2] = Array.from(inningTable.querySelectorAll(`input[data-team="${match.team2}"]`)).map(inp => inp.value);
            ['batters', 'pitchers'].forEach(type => {
                details[type][match.team1] = parseStatsTable(document.querySelector(`table[data-type="${type}"][data-team="${match.team1}"]`));
                details[type][match.team2] = parseStatsTable(document.querySelector(`table[data-type="${type}"][data-team="${match.team2}"]`));
            });
            match.details = details;
            saveState();
            detailsModal.classList.add('hidden');
        }

        function parseStatsTable(tableEl) {
            const headers = Array.from(tableEl.querySelectorAll('th')).map(th => th.textContent);
            const rows = Array.from(tableEl.querySelectorAll('tbody tr'));
            return rows.map(row => {
                const rowData = {};
                Array.from(row.querySelectorAll('input, select')).forEach((input, i) => {
                    rowData[headers[i]] = input.value;
                });
                return rowData;
            }).filter(d => d['é¸æ‰‹å'] && d['é¸æ‰‹å'].trim() !== '');
        }

        // --- Event Listeners ---
        document.body.addEventListener('click', async (e) => {
            if (e.target.matches('.win-btn')) {
                const teamSlot = e.target.closest('.team-slot');
                const matchEl = e.target.closest('[data-match-id]');
                if (!teamSlot || !matchEl || teamSlot.classList.contains('empty')) return;

                const matchId = matchEl.dataset.matchId;
                const dbMatch = tournamentState.matches[matchId];
                if (dbMatch.winner) return;

                const winnerName = teamSlot.dataset.teamName;
                if (!winnerName) return;

                const teamSlots = matchEl.querySelectorAll('.team-slot');
                dbMatch.team1 = teamSlots[0].dataset.teamName;
                dbMatch.team2 = teamSlots[1].dataset.teamName;
                dbMatch.score1 = teamSlots[0].querySelector('.score-input').value;
                dbMatch.score2 = teamSlots[1].querySelector('.score-input').value;
                const summaryInput = matchEl.querySelector('.match-summary-input');
                dbMatch.summary = summaryInput ? summaryInput.value : '';

                if(dbMatch.score1 === '' || dbMatch.score2 === '') {
                    showAlert('ã‚¹ã‚³ã‚¢ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                    return;
                }
                if (parseInt(dbMatch.score1) == parseInt(dbMatch.score2)) {
                    showAlert('åŒç‚¹ã¯å…¥åŠ›ã§ãã¾ã›ã‚“ã€‚');
                    return;
                }

                tournamentState.matches[matchId] = dbMatch;
                await processMatchWin(matchId, winnerName);
            }
            if (e.target.matches('.details-btn')) {
                openDetailsModal(e.target.dataset.matchId);
            }
            if (e.target.matches('.add-row-btn')) {
                const type = e.target.dataset.type;
                const team = e.target.dataset.team;
                const table = document.querySelector(`table[data-type="${type}"][data-team="${team}"] tbody`);
                const headers = Array.from(table.parentElement.querySelectorAll('th')).map(th => th.textContent);
                const newRow = table.insertRow();
                const rowIndex = table.rows.length - 1;
                let rowHtml = '';
                headers.forEach(h => {
                    rowHtml += `<td><input type="text" value="" data-row="${rowIndex}" data-col="${h}"></td>`;
                });
                newRow.innerHTML = rowHtml;
            }
            if (e.target.matches('.retry-btn')) {
                const btn = e.target;
                const errorId = btn.dataset.errorId;
                const articleIndex = tournamentState.news.findIndex(n => n.errorId === errorId);
                if (articleIndex === -1) return;

                btn.textContent = 'ç”Ÿæˆä¸­...';
                btn.disabled = true;

                const errorContext = tournamentState.news[articleIndex].context;
                const newArticle = await generateNewsArticle(
                    errorContext.winnerName,
                    errorContext.loserName,
                    errorContext.dbMatch,
                    errorContext.matchId,
                    errorContext.nextOpponentInfo,
                    errorContext.matchSummary
                );

                tournamentState.news[articleIndex] = newArticle;
                saveState();
                renderNews(tournamentState.news);
            }
            if (e.target.matches('.news-article-btn')) {
                const index = parseInt(e.target.dataset.index, 10);
                const article = tournamentState.news[index];
                document.getElementById('modal-title').textContent = article.title;
                document.getElementById('modal-body').textContent = article.body;
                document.getElementById('modal-meta').innerHTML = `<p>${new Date(article.timestamp).toLocaleDateString('ja-JP')}</p>`;
                newsModal.classList.remove('hidden');
                newsModal.classList.add('flex');
            }
            if (e.target.matches('.newspaper-view-btn')) {
                const index = parseInt(e.target.dataset.index, 10);
                const article = tournamentState.news[index];
                if (article.newspaperHtml) {
                    newspaperModalBody.innerHTML = article.newspaperHtml;
                    newspaperModal.classList.remove('hidden');
                }
            }
        });

        document.body.addEventListener('input', (e) => {
            if (e.target.matches('.score-input')) {
                const scoreInput = e.target;
                const matchEl = scoreInput.closest('[data-match-id]');
                const teamPos = scoreInput.dataset.teamPos;
                if(!matchEl || !teamPos) return;

                const matchId = matchEl.dataset.matchId;
                const scoreKey = `score${teamPos}`;
                if(tournamentState.matches[matchId]) {
                    tournamentState.matches[matchId][scoreKey] = scoreInput.value;
                }
            } else if (e.target.matches('.match-summary-input')) {
                const matchId = e.target.dataset.matchId;
                if (tournamentState.matches[matchId]) {
                    tournamentState.matches[matchId].summary = e.target.value;
                    saveState();
                }
            }
        });
        
        function generateAutoScore(rankWinner, rankLoser) {
            const rankValues = { 'A': 5, 'B': 4, 'C': 3, 'D': 2, 'E': 1 };
            const diff = rankValues[rankWinner] - rankValues[rankLoser];
            let winnerScore, loserScore;

            if (diff >= 3) {
                winnerScore = 7 + Math.floor(Math.random() * 4); 
                loserScore = Math.floor(Math.random() * 3);
            } else if (diff === 2) {
                winnerScore = 5 + Math.floor(Math.random() * 3);
                loserScore = Math.max(0, winnerScore - (3 + Math.floor(Math.random() * 2)));
            } else if (diff === 1) {
                winnerScore = 3 + Math.floor(Math.random() * 4);
                loserScore = Math.max(0, winnerScore - (1 + Math.floor(Math.random() * 2)));
            } else {
                winnerScore = 2 + Math.floor(Math.random() * 5);
                loserScore = winnerScore - 1;
            }
            
            return [winnerScore, loserScore];
        }
        function checkTournamentProgress() {
            const skipButtons = document.querySelectorAll('[id^="skip-r"]');
            skipButtons.forEach(btn => btn.classList.add('hidden'));
        }

        // --- Initial Load & Setup ---
        async function initializeApp() {
            const savedStateJSON = localStorage.getItem('tournamentState');
            if (savedStateJSON) {
                try {
                    const lastState = JSON.parse(savedStateJSON);
                    if (lastState && lastState.tournamentYear) {
                        const confirmed = await showConfirm("å‰å›ã®ç¶šãã‹ã‚‰å†é–‹ã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆã€Œã„ã„ãˆã€ã‚’é¸æŠã™ã‚‹ã¨ã€æœ€åˆã‹ã‚‰ã€ã¾ãŸã¯ã€Œåˆã„è¨€è‘‰ã€ã§å†é–‹ã§ãã¾ã™ï¼‰");
                        if (confirmed) {
                            tournamentState = lastState;
                            renderTournament(tournamentState);
                            setupEl.classList.add('hidden');
                            tournamentDisplayEl.classList.remove('hidden');
                             
                            let playerWins = tournamentState.teamRecords[PLAYER_TEAM] ? tournamentState.teamRecords[PLAYER_TEAM].wins : 0;
                            let playerLosses = tournamentState.teamRecords[PLAYER_TEAM] ? tournamentState.teamRecords[PLAYER_TEAM].losses : 0;
                            
                            if (playerLosses === 0) {
                                highlightPlayerMatch(playerWins + 1);
                            }

                            return; 
                        }
                    }
                } catch (e) {
                    console.error("ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:", e);
                    localStorage.removeItem('tournamentState'); 
                }
            }
            
            setupEl.classList.remove('hidden');
            tournamentDisplayEl.classList.add('hidden');
            teamsTextarea.value = INITIAL_TEAM_POOL.join('\n');
            resumeBtn.classList.remove('hidden');
        }

        generateBtn.addEventListener('click', async () => {
             const savedStateJSON = localStorage.getItem('tournamentState');
            if (savedStateJSON) {
                const confirmed = await showConfirm("æ–°ã—ã„ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆã‚’é–‹å§‹ã™ã‚‹ã¨ã€ä¿å­˜ã•ã‚Œã¦ã„ã‚‹é€²è¡ŒçŠ¶æ³ã¯å¤±ã‚ã‚Œã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ");
                if (confirmed) {
                    createNewTournament(false);
                }
            } else {
                createNewTournament(false);
            }
        });

        resumeBtn.addEventListener('click', () => {
            saveLoadModal.classList.remove('hidden');
            loadTabBtn.click();
        });

        nextTournamentBtn.addEventListener('click', () => createNewTournament(true));
        
        resetBtn.addEventListener('click', async () => {
            const confirmed = await showConfirm("ã™ã¹ã¦ã®å¤§ä¼šè¨˜éŒ²ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦ã€æœ€åˆã®çŠ¶æ…‹ã«æˆ»ã—ã¾ã™ã‹ï¼Ÿ");
            if(confirmed){
                localStorage.clear();
                location.reload();
            }
        });

        saveBtn.addEventListener('click', () => {
            document.getElementById('save-code-area').classList.add('hidden');
            saveLoadModal.classList.remove('hidden');
            saveTabBtn.click();
        });
        
        // Modal close events
        modalBg.addEventListener('click', () => newsModal.classList.add('hidden'));
        modalClose.addEventListener('click', () => newsModal.classList.add('hidden'));
        document.getElementById('details-save').addEventListener('click', saveDetailedStats);
        document.getElementById('details-close').addEventListener('click', () => detailsModal.classList.add('hidden'));
        saveLoadCloseBtn.addEventListener('click', () => saveLoadModal.classList.add('hidden'));
        newspaperCloseBtn.addEventListener('click', () => newspaperModal.classList.add('hidden'));
        managerModalClose.addEventListener('click', () => {
            managerModal.classList.add('hidden');
            if (typeof nextGameAction === 'function') {
                nextGameAction();
                nextGameAction = null;
            }
        });
        gameoverResetBtn.addEventListener('click', () => {
            localStorage.clear();
            location.reload();
        });

        // Save/Load Tab Logic
        saveTabBtn.addEventListener('click', () => {
            saveTabBtn.classList.add('border-blue-500');
            saveTabBtn.classList.remove('text-gray-500');
            loadTabBtn.classList.remove('border-blue-500');
            loadTabBtn.classList.add('text-gray-500');
            saveTabContent.classList.remove('hidden');
            loadTabContent.classList.add('hidden');
        });

        loadTabBtn.addEventListener('click', () => {
            loadTabBtn.classList.add('border-blue-500');
            loadTabBtn.classList.remove('text-gray-500');
            saveTabBtn.classList.remove('border-blue-500');
            saveTabBtn.classList.add('text-gray-500');
            loadTabContent.classList.remove('hidden');
            saveTabContent.classList.add('hidden');
        });
        
        generateSaveCodeBtn.addEventListener('click', () => {
            const btn = generateSaveCodeBtn;
            btn.disabled = true;
            btn.textContent = 'ç™ºè¡Œã—ã¦ã„ã¾ã™...';

            setTimeout(() => {
                try {
                    const jsonString = JSON.stringify(tournamentState);
                    const compressed = pako.deflate(jsonString);
                    const base64 = uint8ArrayToBase64(compressed);
                    document.getElementById('save-code-output').textContent = base64;
                    document.getElementById('save-code-area').classList.remove('hidden');
                    document.getElementById('copy-feedback').textContent = '';
                } catch(e) {
                    console.error("åˆã„è¨€è‘‰ã®ç”Ÿæˆã«å¤±æ•—:", e);
                    showAlert("åˆã„è¨€è‘‰ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
                } finally {
                    btn.disabled = false;
                    btn.textContent = 'åˆã„è¨€è‘‰ã‚’ç™ºè¡Œ';
                }
            }, 50);
        });

        copySaveCodeBtn.addEventListener('click', () => {
            const code = document.getElementById('save-code-output').textContent;
            const feedback = document.getElementById('copy-feedback');
            
            const textarea = document.createElement('textarea');
            textarea.value = code;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);

            feedback.textContent = 'ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼';
            setTimeout(() => {
                feedback.textContent = '';
            }, 2000);
        });

        loadFromCodeBtn.addEventListener('click', () => {
            const btn = loadFromCodeBtn;
            btn.disabled = true;
            btn.textContent = 'èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...';

            setTimeout(() => {
                const code = document.getElementById('load-code-input').value;
                if (!code) {
                    showAlert('åˆã„è¨€è‘‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                    btn.disabled = false;
                    btn.textContent = 'ã“ã®ãƒ‡ãƒ¼ã‚¿ã§å†é–‹ã™ã‚‹';
                    return;
                }

                try {
                    const binaryString = atob(code);
                    const len = binaryString.length;
                    const bytes = new Uint8Array(len);
                    for (let i = 0; i < len; i++) {
                        bytes[i] = binaryString.charCodeAt(i);
                    }
                    const decompressedBytes = pako.inflate(bytes);
                    if (!decompressedBytes) {
                         throw new Error("Decompression failed. The save code might be corrupted.");
                    }
                    const decompressedString = new TextDecoder("utf-8").decode(decompressedBytes);
                    const loadedState = JSON.parse(decompressedString);

                    tournamentState = loadedState;
                    saveState();
                    renderTournament(tournamentState);
                    setupEl.classList.add('hidden');
                    tournamentDisplayEl.classList.remove('hidden');
                    saveLoadModal.classList.add('hidden');

                } catch (e) {
                    console.error("ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—:", e);
                    showAlert("ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚åˆã„è¨€è‘‰ãŒé–“é•ã£ã¦ã„ã‚‹ã‹ã€ãƒ‡ãƒ¼ã‚¿ãŒç ´æã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚");
                } finally {
                    btn.disabled = false;
                    btn.textContent = 'ã“ã®ãƒ‡ãƒ¼ã‚¿ã§å†é–‹ã™ã‚‹';
                }
            }, 50);
        });

        initializeApp();
    </script>
</body>
</html>